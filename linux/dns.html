<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DNS学习总结 | xixiliguo</title>
    <meta name="description" content="博客">
    <link rel="stylesheet" href="/assets/style.d1dca3a2.css">
    <link rel="modulepreload" href="/assets/app.526dca4e.js">
    <link rel="modulepreload" href="/assets/linux_dns.md.ccf3bd81.lean.js">
    
    <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6b5fd0a9><!--[--><!--]--><!--[--><span tabindex="-1" data-v-45f6ae50></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-45f6ae50> Skip to content </a><!--]--><!----><header class="VPNav" data-v-6b5fd0a9 data-v-0e356168><div class="VPNavBar has-sidebar" data-v-0e356168 data-v-8856f192><div class="container" data-v-8856f192><div class="VPNavBarTitle has-sidebar" data-v-8856f192 data-v-6a6f7ff6><a class="title" href="/" data-v-6a6f7ff6><!--[--><img class="VPImage logo" src="/img/coast.jpg" data-v-73ae1788><!--]--><!--[-->xixiliguo<!--]--></a></div><div class="content" data-v-8856f192><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-8856f192 data-v-a30758ee><span id="main-nav-aria-label" class="visually-hidden" data-v-a30758ee>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/linux/linux-common-commands.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->Linux运维<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/network/tcp.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->网络协议<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/golang/golang-exec.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->Golang笔记<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/k8s/runc.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->容器与k8s<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/algorithm/radix-tree.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->算法笔记<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/kernel/kernel-syscall-sched.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->内核分析<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/others/code_segment.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->杂项<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-8856f192 data-v-311055f2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-311055f2 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-8856f192 data-v-0562f5c0 data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8dccea88><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-8dccea88><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><!----><!--[--><!--[--><!----><div class="group" data-v-0562f5c0><div class="item appearance" data-v-0562f5c0><p class="label" data-v-0562f5c0>Appearance</p><div class="appearance-action" data-v-0562f5c0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-0562f5c0 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8856f192 data-v-6f008456><span class="container" data-v-6f008456><span class="top" data-v-6f008456></span><span class="middle" data-v-6f008456></span><span class="bottom" data-v-6f008456></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-6b5fd0a9 data-v-92b0f14a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-92b0f14a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-92b0f14a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-92b0f14a>Menu</span></button><a class="top-link" href="#" data-v-92b0f14a> Return to top </a></div><aside class="VPSidebar" data-v-6b5fd0a9 data-v-55e4c7db><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-55e4c7db><span class="visually-hidden" id="sidebar-aria-label" data-v-55e4c7db> Sidebar Navigation </span><!--[--><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>Linux运维</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/linux/atop.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>ATOP工作原理总结</span><!--]--><!----></a><a class="VPLink link" href="/linux/bandersnatch-pypi.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>使用Bandersnatch搭建私有Pypi源</span><!--]--><!----></a><a class="VPLink link" href="/linux/cloud-init.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>cloud-init学习笔记</span><!--]--><!----></a><a class="VPLink link active" href="/linux/dns.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>DNS学习总结</span><!--]--><!----></a><a class="VPLink link" href="/linux/linux-boot.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Linux Boot过程总结</span><!--]--><!----></a><a class="VPLink link" href="/linux/linux-common-commands.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Linux 下常用命令与技巧汇总</span><!--]--><!----></a><a class="VPLink link" href="/linux/shadow.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Linux /etc/shadow 文件学习笔记</span><!--]--><!----></a><a class="VPLink link" href="/linux/multi-queue.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Linux 网卡多队列介绍</span><!--]--><!----></a><a class="VPLink link" href="/linux/ntp.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>理解NTP协议</span><!--]--><!----></a><a class="VPLink link" href="/linux/yum-update.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>使用Yum 升级OS</span><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-6b5fd0a9 data-v-a4c57a06><div class="VPDoc has-sidebar" data-v-a4c57a06 data-v-79ca2460><div class="container" data-v-79ca2460><div class="aside" data-v-79ca2460><div class="aside-curtain" data-v-79ca2460></div><div class="aside-container" data-v-79ca2460><div class="aside-content" data-v-79ca2460><div class="VPDocAside" data-v-79ca2460 data-v-779d834d><!--[--><!--]--><!--[--><!--]--><!----><!--[--><!--]--><div class="spacer" data-v-779d834d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-79ca2460><div class="content-container" data-v-79ca2460><!--[--><!--]--><main class="main" data-v-79ca2460><div style="position:relative;" class="vp-doc _linux_dns" data-v-79ca2460><div><p>这里记录了自己学习DNS协议中总结和对一些问题的思考</p><h1 id="dns协议" tabindex="-1">DNS协议 <a class="header-anchor" href="#dns协议" aria-hidden="true">#</a></h1><p>DNS默认使用UDP协议,发消息到服务器的53端口. UDP不需要TCP那样三个握手建立连接. 效率更高. 简单地请求,然后收到回复.<br> 根域名有13台, 这是因为早期协议涉及时, 规定dns数据包最大512个字节(不含IP层和MAC层). 最多就只能容纳13个信息. 具体见下面文章所诉<br><a href="https://www.apnic.net/get-ip/faqs/rootservers/" target="_blank" rel="noopener noreferrer">https://www.apnic.net/get-ip/faqs/rootservers/</a><br><a href="https://miek.nl/2013/november/10/why-13-dns-root-servers/" target="_blank" rel="noopener noreferrer">https://miek.nl/2013/november/10/why-13-dns-root-servers/</a><br> 确实根域名有13个IP, 但后面每个IP并不指向一个服务器. 这里采用了BGP的任播机制, 访问IP, 路由器会路由到距离你最近的一台服务器. 这是根DNS服务器的负载均衡技术<br> 单播,多播,广播和任播技术介绍参见: <a href="https://www.hi-linux.com/posts/26571.html" target="_blank" rel="noopener noreferrer">https://www.hi-linux.com/posts/26571.html</a></p><h1 id="resolv-conf文件解析" tabindex="-1">resolv.conf文件解析 <a class="header-anchor" href="#resolv-conf文件解析" aria-hidden="true">#</a></h1><p><code>/etc/resolv.conf</code>详细配置解析参见<code>man 5 resolv.conf</code>, 它属于glibc的一部分. 如果程序发消息到DNS服务器请求域名解析,则该文件的所有配置文件不生效. 比如<code>dig</code>直接和DNS服务器交互. <code>ping,curl,wget</code>则使用<code>glibc</code>库<br> 默认timeout为5, attempts为2, 意思是在放弃该连接,尝试下一个DNS服务器前等待超时时间为5s, 尝试2遍后放弃. 其中一遍表示轮询完一遍所有的DNS服务器失败<br> 假设配置文件如下</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># cat /etc/resolv.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">options single-request-reopen</span></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> generated by /usr/sbin/dhclient-script</span></span>
<span class="line"><span style="color:#A6ACCD;">search localdomain</span></span>
<span class="line"><span style="color:#A6ACCD;">nameserver 114.114.114.117</span></span>
<span class="line"><span style="color:#A6ACCD;">nameserver 114.114.114.113</span></span>
<span class="line"></span></code></pre></div><p>下面是<code>ping www.baid1xe21.com1</code>的报文交互. 可以看到放弃两个NS后,还根据search的配置尝试使用<code>www.baid1xe21.com1.localdomain</code>获取解析</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># tcpdump -i eth0 -eennvv udp</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump: listening on eth0, link-type EN10MB </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Ethernet</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, capture size 262144 bytes</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:12.576101 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 78: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 46506, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 64</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.52434 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.117.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x270e -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x20fb</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 20589+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">36</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:17.581591 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 78: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 37849, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 64</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.55684 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.113.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x270a -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x144d</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 20589+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">36</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:22.588076 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 78: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 52914, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 64</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.52434 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.117.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x270e -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x20fb</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 20589+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">36</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:27.593191 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 78: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 47412, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 64</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.55684 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.113.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x270a -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x144d</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 20589+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">36</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:32.598796 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 90: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 60578, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 76</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.53255 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.117.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x271a -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x09f4</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 59663+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1.localdomain. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">48</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:37.605004 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 90: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 52533, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 76</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.50522 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.113.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x2716 -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x14a5</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 59663+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1.localdomain. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">48</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:42.609907 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 90: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 3384, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 76</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.53255 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.117.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x271a -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x09f4</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 59663+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1.localdomain. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">48</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:47.616265 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 90: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 52752, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 76</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.50522 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.113.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x2716 -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x14a5</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 59663+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1.localdomain. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">48</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>通过<code>strace</code>观测到的系统调用如下:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">17:38:46 close</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">                       = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000263&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 socket</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">AF_INET, SOCK_DGRAM</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">SOCK_CLOEXEC</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">SOCK_NONBLOCK, IPPROTO_IP</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 4 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000222&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 connect</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">4, {sa_family=AF_INET, sin_port=htons</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">53</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, sin_addr=inet_addr</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10.211.54.2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">}, 16</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000280&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 1 </span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, revents</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000173&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 sendto</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">4, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w\221\1\0\0\1\0\0\0\0\0\0\3www\003163\3com\vlocaldo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">..., 41, MSG_NOSIGNAL, NULL, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 41 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000147&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLIN}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 5000</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Timeout</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">5.</span><span style="color:#89DDFF;">006352&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 socket</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">AF_INET, SOCK_DGRAM</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">SOCK_CLOEXEC</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">SOCK_NONBLOCK, IPPROTO_IP</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 5 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000306&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 connect</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5, {sa_family=AF_INET, sin_port=htons</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">53</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, sin_addr=inet_addr</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10.211.54.3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">}, 16</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000243&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 1 </span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, revents</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000109&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 sendto</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w\221\1\0\0\1\0\0\0\0\0\0\3www\003163\3com\vlocaldo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">..., 41, MSG_NOSIGNAL, NULL, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 41 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000290&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLIN}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 5000</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Timeout</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">5.</span><span style="color:#89DDFF;">006234&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:56 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 1 </span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, revents</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000221&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:56 sendto</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">4, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w\221\1\0\0\1\0\0\0\0\0\0\3www\003163\3com\vlocaldo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">..., 41, MSG_NOSIGNAL, NULL, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 41 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000371&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:56 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLIN}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 5000</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Timeout</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">5.</span><span style="color:#89DDFF;">006071&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:01 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 1 </span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, revents</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000119&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:01 sendto</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w\221\1\0\0\1\0\0\0\0\0\0\3www\003163\3com\vlocaldo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">..., 41, MSG_NOSIGNAL, NULL, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 41 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000617&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:01 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLIN}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 5000</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Timeout</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">5.</span><span style="color:#89DDFF;">005939&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:06 close</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">4</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">                       = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000189&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:06 close</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">                       = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000146&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:06 open</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/share/locale/locale.alias</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">, O_RDONLY</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">O_CLOEXEC</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 4 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000120&gt;</span></span>
<span class="line"></span></code></pre></div><p>DHCP自动获取IP场景,经常会覆盖用户自己配置的参数, 可以使用类似如下的命令将配置持久化. dhcp只会更新DNS服务器,不会删除用户配置.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">RES_OPTIONS=&quot;timeout:2 attempts:3 rotate single-request-reopen&quot;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;">/etc/sysconfig/network</span></span>
<span class="line"></span></code></pre></div><p>在容器场景下,经常遇到域名解析5s超时的问题,主要是因为<code>glibc</code>下会同时并行发出请求A级记录和AAA记录的报文, 底层有时处理不了这种竞争条件,导致超时. 可通通过<code>single-request-reopen</code>来解决, 详细见如下文章:<br><a href="https://tencentcloudcontainerteam.github.io/2018/10/26/DNS-5-seconds-delay/" target="_blank" rel="noopener noreferrer">https://tencentcloudcontainerteam.github.io/2018/10/26/DNS-5-seconds-delay/</a></p><p>在查询域名时，如果域名里面<code>.</code>的个数小于 ndots 指定的数，则会根据 search 中配置的列表依次在对应域中查询，如果没有返回，则最后直接查询域名本身。 ndots 默认是1</p><p>如果大于ndtos, 先直接查询, 查询不到再在serach里的域里继续查询 假设配置如下:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">nameserver 10.232.0.3</span></span>
<span class="line"><span style="color:#A6ACCD;">search default.svc.cluster.local svc.cluster.local cluster.local</span></span>
<span class="line"><span style="color:#A6ACCD;">options ndots:5</span></span>
<span class="line"></span></code></pre></div><p>想解析的<code>kubernetes.default.svc</code>中的 . 只有2，小于5，这时会依次拼接上 search 中的地址之后再进行查询，如果都查询不到，则再查询本身。</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># host -v kubernetes.default.svc</span></span>
<span class="line"><span style="color:#A6ACCD;">Trying </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">kubernetes.default.svc.default.svc.cluster.local</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Trying </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">kubernetes.default.svc.svc.cluster.local</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Trying </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">kubernetes.default.svc.cluster.local</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"></span></code></pre></div><h1 id="dig命令使用" tabindex="-1">dig命令使用 <a class="header-anchor" href="#dig命令使用" aria-hidden="true">#</a></h1><p>查询<code>www.163.com</code>解析信息</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig www.163.com</span></span>
<span class="line"></span></code></pre></div><p>迭代查询</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig +trace www.163.com</span></span>
<span class="line"></span></code></pre></div><p>指定从DNS服务器<code>8.8.8.8</code>获取解析结果</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig @8.8.8.8 www.163.com</span></span>
<span class="line"></span></code></pre></div><p>反向解析一个ip</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig -x 114.114.114.114</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#89DDFF;font-style:italic;">&gt;&gt;</span><span style="color:#C3E88D;"> DiG 9.9.4-RedHat-9.9.4-74.el7_6.1 &lt;&lt;&gt;&gt; -x 114.114.114.114</span></span>
<span class="line"><span style="color:#C3E88D;">;; global options: +cmd</span></span>
<span class="line"><span style="color:#C3E88D;">;; Got answer:</span></span>
<span class="line"><span style="color:#C3E88D;">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 58603</span></span>
<span class="line"><span style="color:#C3E88D;">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; OPT PSEUDOSECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">; EDNS: version: 0, flags:; udp: 512</span></span>
<span class="line"><span style="color:#C3E88D;">;; QUESTION SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">;114.114.114.114.in-addr.arpa.	IN	PTR</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">114.114.114.114.in-addr.arpa. 119 IN	PTR	public1.114dns.com.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; Query time: 33 msec</span></span>
<span class="line"><span style="color:#C3E88D;">;; SERVER: 10.211.55.1#53(10.211.55.1)</span></span>
<span class="line"><span style="color:#C3E88D;">;; WHEN: Sun Oct 04 20:20:09 HKT 2020</span></span>
<span class="line"><span style="color:#C3E88D;">;; MSG SIZE  rcvd: 89</span></span>
<span class="line"></span></code></pre></div><h1 id="getaddrinfo返回的多个a记录，负载均衡失效" tabindex="-1">getaddrinfo返回的多个A记录，负载均衡失效 <a class="header-anchor" href="#getaddrinfo返回的多个a记录，负载均衡失效" aria-hidden="true">#</a></h1><p>域名经常会对应多个地址, 如下面所示, 解析www.baidu.com返回 14.215.177.39 和 14.215.177.38, 程序默认是取第一个作为最终结果. 所以DNS服务器会随机调整返回的IP列表顺序, 这样可以实现负载均衡, 叫做 round-robin-dns</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig www.baidu.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#89DDFF;font-style:italic;">&gt;&gt;</span><span style="color:#C3E88D;"> DiG 9.11.20-RedHat-9.11.20-5.el8 &lt;&lt;&gt;&gt; www.baidu.com</span></span>
<span class="line"><span style="color:#C3E88D;">;; global options: +cmd</span></span>
<span class="line"><span style="color:#C3E88D;">;; Got answer:</span></span>
<span class="line"><span style="color:#C3E88D;">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 6006</span></span>
<span class="line"><span style="color:#C3E88D;">;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; QUESTION SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">;www.baidu.com.                 IN      A</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">www.baidu.com.          831     IN      CNAME   www.a.shifen.com.</span></span>
<span class="line"><span style="color:#C3E88D;">www.a.shifen.com.       122     IN      A       14.215.177.39</span></span>
<span class="line"><span style="color:#C3E88D;">www.a.shifen.com.       122     IN      A       14.215.177.38</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; Query time: 11 msec</span></span>
<span class="line"><span style="color:#C3E88D;">;; SERVER: 192.168.3.1#53(192.168.3.1)</span></span>
<span class="line"><span style="color:#C3E88D;">;; WHEN: Sun Feb 21 21:35:18 CST 2021</span></span>
<span class="line"><span style="color:#C3E88D;">;; MSG SIZE  rcvd: 90</span></span>
<span class="line"></span></code></pre></div><p>但在一些特殊场景下, getaddrinfo的返回的IPv4列表顺序永远是固定的,即使DNS服务器返回是随机的. 这是因为getaddrinfo遵从rfc3484对返回的IP列表进行排序. 具体影响是当返回的IP与客户端的IP处于同一子网, 拥有最长前缀的排在前面. 用于比较的前缀指的是ip地址的bit值</p><p>192.168.3.20 == 11000000.10101000.00000011.00010100</p><table><thead><tr><th style="text-align:left;">本机IP</th><th style="text-align:left;">DNS服务返回</th><th style="text-align:left;">getaddrinfo返回</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">192.168.3.20 /24</td><td style="text-align:left;">11000000.10101000.00001101.00011101 192.168.13.29<br> 11000000.10101000.00001101.00011011 192.168.13.27<br> 11000000.10101000.00000011.01000101 192.168.3.69</td><td style="text-align:left;">192.168.3.69<br> 192.168.13.29<br> 192.168.13.27</td><td style="text-align:left;">只有192.168.3.69和本机IP同网段,所以它靠前,非同一子网的保持原顺序不变</td></tr><tr><td style="text-align:left;">192.168.3.20 /24</td><td style="text-align:left;">11000000.10101000.00001101.00011101 192.168.13.29<br> 11000000.10101000.00000011.01000101 192.168.3.69 <br> 11000000.10101000.00000011.00011011 192.168.3.27</td><td style="text-align:left;">192.168.3.27<br> 192.168.3.69<br> 192.168.13.29<br></td><td style="text-align:left;">同网段有3.27 和 3.69 , commonprefixlen(27, 20) 大于 commonprefixlen(69, 20), 所以27靠前. 69靠后. 非同一子网的保持原顺序不变</td></tr><tr><td style="text-align:left;">192.168.3.20 /24</td><td style="text-align:left;">11000000.10101000.00000011.00011101 192.168.3.29<br> 11000000.10101000.00000011.00011010 192.168.3.26 <br> 11000000.10101000.00000011.00011011 192.168.3.27</td><td style="text-align:left;">192.168.3.29<br> 192.168.3.26<br> 192.168.3.27<br></td><td style="text-align:left;">三个的commonprefixlen都一样, 不需要排序.按原顺序返回</td></tr><tr><td style="text-align:left;">192.168.3.20 /24</td><td style="text-align:left;">11000000.10101000.00000011.00011101 192.168.3.29<br> 11000000.10101000.00000011.00010111 192.168.3.23 <br> 11000000.10101000.00000011.00011011 192.168.3.27</td><td style="text-align:left;">192.168.3.23<br> 192.168.3.29<br> 192.168.3.27<br></td><td style="text-align:left;">23的commonprefixlen大, 所以23靠前,其他两个的最长前缀相等,顺序不变</td></tr></tbody></table><p>如下是一个简单的测试结果</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ go run a.go</span></span>
<span class="line"><span style="color:#A6ACCD;">use pure go, keep order from dns server  </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">192.168.3.29 192.168.3.23 192.168.3.27</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">use cgo, invoke getaddrinfo              </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">192.168.3.23 192.168.3.29 192.168.3.27</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p>测试代码:</p><div class="language-go"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">fmt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">io/ioutil</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">net</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">func</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	data </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#C3E88D;">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#C3E88D;">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#C3E88D;">192.168.3.29  www.abc.com</span></span>
<span class="line"><span style="color:#C3E88D;">192.168.3.23  www.abc.com</span></span>
<span class="line"><span style="color:#C3E88D;">192.168.3.27  www.abc.com</span></span>
<span class="line"><span style="color:#89DDFF;">`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	ioutil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">WriteFile</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/etc/hosts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#82AAFF;">byte</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0644</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	testCases </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]struct</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		name     </span><span style="color:#C792EA;">string</span></span>
<span class="line"><span style="color:#A6ACCD;">		preferGo </span><span style="color:#C792EA;">bool</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">use pure go, keep order from dns server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true},</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">use cgo, invoke getaddrinfo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false},</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> _</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> tc </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">range</span><span style="color:#A6ACCD;"> testCases </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		net</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">DefaultResolver</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PreferGo </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tc</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">preferGo</span></span>
<span class="line"><span style="color:#A6ACCD;">		ips</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> _ </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> net</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">LookupHost</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">www.abc.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		fmt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%-40s %v</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> tc</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ips</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#C3E88D;">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#C3E88D;">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#89DDFF;">`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	ioutil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">WriteFile</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/etc/hosts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#82AAFF;">byte</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0644</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>要想避免这种特定场景返回的ip是固定的, 可以关闭ipv6. 该问题的相关参考信息:<br><a href="https://access.redhat.com/solutions/22132" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/22132</a><br><a href="https://access.redhat.com/solutions/8709" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/8709</a><br><a href="https://gist.github.com/SpComb/c509bd064bc75151e6b41e8bc949d13f" target="_blank" rel="noopener noreferrer">https://gist.github.com/SpComb/c509bd064bc75151e6b41e8bc949d13f</a><br><a href="https://github.com/hashicorp/consul/issues/1481" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/consul/issues/1481</a><br><a href="https://github.com/weaveworks/weave/issues/1245" target="_blank" rel="noopener noreferrer">https://github.com/weaveworks/weave/issues/1245</a><br><a href="https://tools.ietf.org/rfc/rfc3484.txt" target="_blank" rel="noopener noreferrer">https://tools.ietf.org/rfc/rfc3484.txt</a><br><a href="https://www.api.rackspace.com/blog/glibc-linux-dns-round-robin-explanation/" target="_blank" rel="noopener noreferrer">https://www.api.rackspace.com/blog/glibc-linux-dns-round-robin-explanation/</a><br><a href="https://github.com/golang/go/issues/18518" target="_blank" rel="noopener noreferrer">https://github.com/golang/go/issues/18518</a></p></div></div></main><footer class="VPDocFooter" data-v-79ca2460 data-v-04568844><div class="edit-info" data-v-04568844><!----><div class="last-updated" data-v-04568844><p class="VPLastUpdated" data-v-04568844 data-v-0ce8c960>Last updated: <time datatime="2022-07-14T14:54:09.000Z" data-v-0ce8c960></time></p></div></div><div class="prev-next" data-v-04568844><div class="pager" data-v-04568844><a class="pager-link prev" href="/linux/cloud-init.html" data-v-04568844><span class="desc" data-v-04568844>Previous page</span><span class="title" data-v-04568844>cloud-init学习笔记</span></a></div><div class="has-prev pager" data-v-04568844><a class="pager-link next" href="/linux/linux-boot.html" data-v-04568844><span class="desc" data-v-04568844>Next page</span><span class="title" data-v-04568844>Linux Boot过程总结</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-6b5fd0a9 data-v-5b331722><div class="container" data-v-5b331722><p class="message" data-v-5b331722>Released under the MIT License.</p><p class="copyright" data-v-5b331722>Copyright © 2022-present xixiliguo</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"algorithm_algorithm-dfs.md\":\"a73dea67\",\"algorithm_binary-index-tree.md\":\"8bc3e51f\",\"algorithm_radix-tree.md\":\"6b75afb6\",\"algorithm_segment-tree.md\":\"c689b78e\",\"algorithm_unionfind.md\":\"a646711f\",\"golang_golang-exec.md\":\"357621ac\",\"golang_strings-algorithm-golang.md\":\"57a20191\",\"index.md\":\"27757f36\",\"k8s_runc.md\":\"09e5ae92\",\"kernel_kernel-cgroup-namespace.md\":\"4a81fd3c\",\"kernel_kernel-crash.md\":\"27a485e9\",\"kernel_kernel-irq.md\":\"0bfc9b45\",\"kernel_kernel-memory.md\":\"1c2cf851\",\"kernel_kernel-syscall-sched.md\":\"29c8373b\",\"kernel_linux-trap.md\":\"ae6473f3\",\"linux_atop.md\":\"6cfa95b0\",\"linux_bandersnatch-pypi.md\":\"dee4724b\",\"linux_cloud-init.md\":\"e0bc6141\",\"linux_dns.md\":\"ccf3bd81\",\"linux_linux-boot.md\":\"459acaa4\",\"linux_linux-common-commands.md\":\"c3e4942a\",\"linux_linux-shadow.md\":\"4d01a795\",\"linux_multi-queue.md\":\"9db1b9ad\",\"linux_ntp.md\":\"0f26af7e\",\"linux_yum-update.md\":\"67a0bf95\",\"network_libvirt-network.md\":\"90682305\",\"network_tcp.md\":\"2211909d\",\"network_tcpdump-wireshark.md\":\"a2fe5423\",\"others_code_segment.md\":\"f0f03c59\",\"others_lua-implemention-gc.md\":\"80382876\",\"others_lua-implemention-type-value.md\":\"e4816df1\"}")</script>
    <script type="module" async src="/assets/app.526dca4e.js"></script>
    
  </body>
</html>