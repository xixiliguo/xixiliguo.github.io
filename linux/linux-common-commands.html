<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux 下常用命令与技巧汇总 | xixiliguo</title>
    <meta name="description" content="博客">
    <link rel="stylesheet" href="/assets/style.d1dca3a2.css">
    <link rel="modulepreload" href="/assets/app.526dca4e.js">
    <link rel="modulepreload" href="/assets/linux_linux-common-commands.md.c3e4942a.lean.js">
    
    <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6b5fd0a9><!--[--><!--]--><!--[--><span tabindex="-1" data-v-45f6ae50></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-45f6ae50> Skip to content </a><!--]--><!----><header class="VPNav" data-v-6b5fd0a9 data-v-0e356168><div class="VPNavBar has-sidebar" data-v-0e356168 data-v-8856f192><div class="container" data-v-8856f192><div class="VPNavBarTitle has-sidebar" data-v-8856f192 data-v-6a6f7ff6><a class="title" href="/" data-v-6a6f7ff6><!--[--><img class="VPImage logo" src="/img/coast.jpg" data-v-73ae1788><!--]--><!--[-->xixiliguo<!--]--></a></div><div class="content" data-v-8856f192><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-8856f192 data-v-a30758ee><span id="main-nav-aria-label" class="visually-hidden" data-v-a30758ee>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/linux/linux-common-commands.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->Linux运维<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/network/tcp.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->网络协议<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/golang/golang-exec.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->Golang笔记<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/k8s/runc.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->容器与k8s<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/algorithm/radix-tree.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->算法笔记<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/kernel/kernel-syscall-sched.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->内核分析<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/others/code_segment.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->杂项<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-8856f192 data-v-311055f2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-311055f2 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-8856f192 data-v-0562f5c0 data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8dccea88><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-8dccea88><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><!----><!--[--><!--[--><!----><div class="group" data-v-0562f5c0><div class="item appearance" data-v-0562f5c0><p class="label" data-v-0562f5c0>Appearance</p><div class="appearance-action" data-v-0562f5c0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-0562f5c0 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8856f192 data-v-6f008456><span class="container" data-v-6f008456><span class="top" data-v-6f008456></span><span class="middle" data-v-6f008456></span><span class="bottom" data-v-6f008456></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-6b5fd0a9 data-v-92b0f14a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-92b0f14a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-92b0f14a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-92b0f14a>Menu</span></button><a class="top-link" href="#" data-v-92b0f14a> Return to top </a></div><aside class="VPSidebar" data-v-6b5fd0a9 data-v-55e4c7db><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-55e4c7db><span class="visually-hidden" id="sidebar-aria-label" data-v-55e4c7db> Sidebar Navigation </span><!--[--><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>Linux运维</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/linux/atop.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>ATOP工作原理总结</span><!--]--><!----></a><a class="VPLink link" href="/linux/bandersnatch-pypi.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>使用Bandersnatch搭建私有Pypi源</span><!--]--><!----></a><a class="VPLink link" href="/linux/cloud-init.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>cloud-init学习笔记</span><!--]--><!----></a><a class="VPLink link" href="/linux/dns.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>DNS学习总结</span><!--]--><!----></a><a class="VPLink link" href="/linux/linux-boot.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Linux Boot过程总结</span><!--]--><!----></a><a class="VPLink link active" href="/linux/linux-common-commands.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Linux 下常用命令与技巧汇总</span><!--]--><!----></a><a class="VPLink link" href="/linux/shadow.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Linux /etc/shadow 文件学习笔记</span><!--]--><!----></a><a class="VPLink link" href="/linux/multi-queue.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>Linux 网卡多队列介绍</span><!--]--><!----></a><a class="VPLink link" href="/linux/ntp.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>理解NTP协议</span><!--]--><!----></a><a class="VPLink link" href="/linux/yum-update.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>使用Yum 升级OS</span><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-6b5fd0a9 data-v-a4c57a06><div class="VPDoc has-sidebar" data-v-a4c57a06 data-v-79ca2460><div class="container" data-v-79ca2460><div class="aside" data-v-79ca2460><div class="aside-curtain" data-v-79ca2460></div><div class="aside-container" data-v-79ca2460><div class="aside-content" data-v-79ca2460><div class="VPDocAside" data-v-79ca2460 data-v-779d834d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-779d834d data-v-51e5a8ce><div class="content" data-v-51e5a8ce><div class="outline-marker" data-v-51e5a8ce></div><div class="outline-title" data-v-51e5a8ce>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-51e5a8ce><span class="visually-hidden" id="doc-outline-aria-label" data-v-51e5a8ce> Table of Contents for current page </span><ul class="root" data-v-51e5a8ce><!--[--><li style="" data-v-51e5a8ce><a class="outline-link" href="#_1-查询系统准确的启动时间" data-v-51e5a8ce>1. 查询系统准确的启动时间</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_2-查询所有进程的准确启动时间和运行时长" data-v-51e5a8ce>2. 查询所有进程的准确启动时间和运行时长</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_3-设置时间" data-v-51e5a8ce>3. 设置时间</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_4-同步os与硬件时间" data-v-51e5a8ce>4. 同步OS与硬件时间</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_5-查看硬件信息" data-v-51e5a8ce>5. 查看硬件信息</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_6-锁定文件-不被任何程序修改" data-v-51e5a8ce>6 锁定文件,不被任何程序修改</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_7-stat-查看文件详细元数据信息-特别是inode" data-v-51e5a8ce>7. stat 查看文件详细元数据信息, 特别是inode</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_8-xxd查看二进制文件" data-v-51e5a8ce>8. xxd查看二进制文件</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_9-批量修改文件名" data-v-51e5a8ce>9. 批量修改文件名</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_10-df-查询文件系统挂载点信息" data-v-51e5a8ce>10. df 查询文件系统挂载点信息</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_11-du-命令" data-v-51e5a8ce>11. du 命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_12-find删除查找到的文件" data-v-51e5a8ce>12. find删除查找到的文件</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_13-xargs-命令" data-v-51e5a8ce>13. xargs 命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_14-grep查询文本" data-v-51e5a8ce>14. grep查询文本</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_15-tail-查看文件指定行信息" data-v-51e5a8ce>15. tail 查看文件指定行信息</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_16-批量创建目录" data-v-51e5a8ce>16. 批量创建目录</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_17-echo-相关命令" data-v-51e5a8ce>17. echo 相关命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_18-nohup与标准输出-标准错误输出" data-v-51e5a8ce>18. nohup与标准输出,标准错误输出</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_19-linux模块的安装和卸载" data-v-51e5a8ce>19. Linux模块的安装和卸载</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_20-column格式化输出" data-v-51e5a8ce>20. column格式化输出</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_21-通过pid查看进程的环境变量信息" data-v-51e5a8ce>21. 通过pid查看进程的环境变量信息</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_22-通过pid查看进程对应可执行文件的绝对路径" data-v-51e5a8ce>22. 通过pid查看进程对应可执行文件的绝对路径</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_23-通过pid查看进程的当前工作目录" data-v-51e5a8ce>23. 通过pid查看进程的当前工作目录</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_24-lsof-一切皆文件" data-v-51e5a8ce>24. lsof 一切皆文件</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_25-fuser-查找访问文件系统的进程" data-v-51e5a8ce>25. fuser 查找访问文件系统的进程</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_26-dd-测试磁盘或者文件读写" data-v-51e5a8ce>26. dd 测试磁盘或者文件读写</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_27-rpm-安装-更新-卸载软件包" data-v-51e5a8ce>27. rpm 安装/更新/卸载软件包</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_28-yum-安装-更新-卸载软件包" data-v-51e5a8ce>28. yum 安装/更新/卸载软件包</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_29-解压缩命令" data-v-51e5a8ce>29. 解压缩命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_30-systemd-管理命令" data-v-51e5a8ce>30. systemd 管理命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_31-ubuntu-debian-检查已经安装好的软件包的更新日志" data-v-51e5a8ce>31. Ubuntu/Debian 检查已经安装好的软件包的更新日志</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_32-搜索含有指定字符的手册页" data-v-51e5a8ce>32. 搜索含有指定字符的手册页</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_33-快速删除大量小文件" data-v-51e5a8ce>33. 快速删除大量小文件</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_34-sysctl-管理系统参数" data-v-51e5a8ce>34. sysctl 管理系统参数</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_35-清空文件内容" data-v-51e5a8ce>35. 清空文件内容</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_36-查询系统调用" data-v-51e5a8ce>36. 查询系统调用</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_37-查看磁盘uuid和文件系统类型" data-v-51e5a8ce>37. 查看磁盘uuid和文件系统类型</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_38-创建软连接" data-v-51e5a8ce>38. 创建软连接</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_39-history查看历史记录" data-v-51e5a8ce>39. history查看历史记录</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_40-查看进程的父子调用关系" data-v-51e5a8ce>40. 查看进程的父子调用关系</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_41-rsync文件" data-v-51e5a8ce>41. rsync文件</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_42-查询的动态库链接信息" data-v-51e5a8ce>42. 查询的动态库链接信息</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_43-查询ascii编码表" data-v-51e5a8ce>43. 查询ascii编码表</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_44-iptable-内置防火墙" data-v-51e5a8ce>44. iptable 内置防火墙</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_45-tcpdump-抓包" data-v-51e5a8ce>45. tcpdump 抓包</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_46-dns查询工具" data-v-51e5a8ce>46. DNS查询工具</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_47-ntp时间同步" data-v-51e5a8ce>47. NTP时间同步</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_48-netstat查询网络连接信息" data-v-51e5a8ce>48. netstat查询网络连接信息</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_49-ethtool-网卡查询工具" data-v-51e5a8ce>49. ethtool 网卡查询工具</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_50-ip-网络维护" data-v-51e5a8ce>50. ip 网络维护</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_51-who-查看当前登录用户" data-v-51e5a8ce>51. who 查看当前登录用户</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_52-使用iftop查看主机实时网络流量" data-v-51e5a8ce>52. 使用iftop查看主机实时网络流量</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_53-bash相关环境变量" data-v-51e5a8ce>53. Bash相关环境变量</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_54-查本机的公网ip" data-v-51e5a8ce>54. 查本机的公网IP</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_55-查询linux系统的一些限制信息" data-v-51e5a8ce>55. 查询linux系统的一些限制信息</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_56-判断虚拟化类型的n种方法" data-v-51e5a8ce>56. 判断虚拟化类型的N种方法</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_57-cpu信息解读" data-v-51e5a8ce>57. cpu信息解读</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_58-taskset指定进程的cpu亲和性" data-v-51e5a8ce>58. taskset指定进程的CPU亲和性</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_59-linux系统最大文件数量" data-v-51e5a8ce>59. Linux系统最大文件数量</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_60-ss-查询socket连接信息" data-v-51e5a8ce>60. ss 查询socket连接信息</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_61-消除用户被锁的错误登录记录" data-v-51e5a8ce>61. 消除用户被锁的错误登录记录</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_62-估计rss总和的大小" data-v-51e5a8ce>62. 估计RSS总和的大小</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_63-文件系统修复" data-v-51e5a8ce>63. 文件系统修复</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_64-非交互式修改密码" data-v-51e5a8ce>64. 非交互式修改密码</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_66-udev管理" data-v-51e5a8ce>66. udev管理</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_67-一条命令启动web服务器" data-v-51e5a8ce>67. 一条命令启动web服务器</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_68-dpkg-apt-get包管理命令" data-v-51e5a8ce>68. dpkg,apt-get包管理命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_69-主机安全入侵盘查" data-v-51e5a8ce>69. 主机安全入侵盘查</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_70-top命令" data-v-51e5a8ce>70. top命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_71-ping命令" data-v-51e5a8ce>71. ping命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_72-ping和curl常见的网络报错" data-v-51e5a8ce>72. ping和curl常见的网络报错</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_73-一些常用的内存统计命令" data-v-51e5a8ce>73. 一些常用的内存统计命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_74-不同os的文件编码" data-v-51e5a8ce>74. 不同OS的文件编码</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_75-一些shell循环命令" data-v-51e5a8ce>75. 一些shell循环命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_76-dhcp持续请求配置" data-v-51e5a8ce>76. dhcp持续请求配置</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_77-解析-proc-pid-status里关于信号的字段" data-v-51e5a8ce>77. 解析/proc/[pid]/status里关于信号的字段</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_78-审计谁杀了进程" data-v-51e5a8ce>78. 审计谁杀了进程</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_79-修改字符集的命令" data-v-51e5a8ce>79. 修改字符集的命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_80-bash脚本的退出码" data-v-51e5a8ce>80. bash脚本的退出码</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_81-模拟不断增加内存致使触发oom的程序" data-v-51e5a8ce>81. 模拟不断增加内存致使触发oom的程序</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_82-vi实现十六进制编辑功能" data-v-51e5a8ce>82. vi实现十六进制编辑功能</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_83-iproute软件包里的一些常用命令" data-v-51e5a8ce>83. iproute软件包里的一些常用命令</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_84-链接跟踪" data-v-51e5a8ce>84. 链接跟踪</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_85-一些汇编语法" data-v-51e5a8ce>85. 一些汇编语法</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_86-使用crash分析内核coredump的一些文章" data-v-51e5a8ce>86. 使用crash分析内核coredump的一些文章</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_87-linux内核模块相关" data-v-51e5a8ce>87. Linux内核模块相关</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_88-ssh连接保活配置" data-v-51e5a8ce>88. ssh连接保活配置</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_89-使用auditd审计功能" data-v-51e5a8ce>89. 使用auditd审计功能</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_90-分析磁盘性能" data-v-51e5a8ce>90. 分析磁盘性能</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_91-grub相关问题" data-v-51e5a8ce>91. Grub相关问题</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_92-slab相关的知识" data-v-51e5a8ce>92. SLAB相关的知识</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_93-nfs相关的知识" data-v-51e5a8ce>93. nfs相关的知识</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_94-fork创建进程时的几个报错说明" data-v-51e5a8ce>94. fork创建进程时的几个报错说明</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-779d834d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-79ca2460><div class="content-container" data-v-79ca2460><!--[--><!--]--><main class="main" data-v-79ca2460><div style="position:relative;" class="vp-doc _linux_linux-common-commands" data-v-79ca2460><div><h1 id="linux-下常用命令与技巧汇总" tabindex="-1">Linux 下常用命令与技巧汇总 <a class="header-anchor" href="#linux-下常用命令与技巧汇总" aria-hidden="true">#</a></h1><p>收集自己常用到的linux命令与技巧,方便后续查找.不定期更新.</p><h2 id="_1-查询系统准确的启动时间" tabindex="-1">1. 查询系统准确的启动时间 <a class="header-anchor" href="#_1-查询系统准确的启动时间" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">date -d </span><span style="color:#89DDFF;">&quot;$(</span><span style="color:#C3E88D;">awk -F. </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{print $1}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> /proc/uptime</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;"> second ago</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> +</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%Y-%m-%d %H:%M:%S</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-01-17 22:27:55</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">who -b</span></span>
<span class="line"><span style="color:#A6ACCD;">         system boot  2018-01-17 22:27</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">uptime -s</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-09-04 00:40:58</span></span>
<span class="line"></span></code></pre></div><h2 id="_2-查询所有进程的准确启动时间和运行时长" tabindex="-1">2. 查询所有进程的准确启动时间和运行时长 <a class="header-anchor" href="#_2-查询所有进程的准确启动时间和运行时长" aria-hidden="true">#</a></h2><p>-e 表示查询所有进程<br> -o 表示按指定的格式输出<br> lstart 为进程启动时间<br> etime可以显示已经运行了多长时间<br> args 为具体的命令行参数</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ps -e -o pid,lstart,etime,args</span></span>
<span class="line"></span></code></pre></div><p><code>ps -efL</code> 加 <code>-L</code> 则显示线程</p><h2 id="_3-设置时间" tabindex="-1">3. 设置时间 <a class="header-anchor" href="#_3-设置时间" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">date -s </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dd/mm/yyyy hh:mm:ss</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>也可以在centos7下使用</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">timedatectl set-time </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2012-10-30 18:17:16</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h2 id="_4-同步os与硬件时间" tabindex="-1">4. 同步OS与硬件时间 <a class="header-anchor" href="#_4-同步os与硬件时间" aria-hidden="true">#</a></h2><p>将OS系统时间同步到硬件(RTC)</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">hwclock –-systohc</span></span>
<span class="line"></span></code></pre></div><p>将硬件时间同步到OS</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">hwclock --hctosys</span></span>
<span class="line"></span></code></pre></div><h2 id="_5-查看硬件信息" tabindex="-1">5. 查看硬件信息 <a class="header-anchor" href="#_5-查看硬件信息" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">lscpu               </span><span style="color:#676E95;font-style:italic;">#查看CPU信息</span></span>
<span class="line"><span style="color:#A6ACCD;">lspci               </span><span style="color:#676E95;font-style:italic;">#查看PCI信息</span></span>
<span class="line"><span style="color:#A6ACCD;">lsusb               </span><span style="color:#676E95;font-style:italic;">#查看外设USB</span></span>
<span class="line"><span style="color:#A6ACCD;">lsscsi              </span><span style="color:#676E95;font-style:italic;">#查看SCSI设备</span></span>
<span class="line"><span style="color:#A6ACCD;">lsblk               </span><span style="color:#676E95;font-style:italic;">#查看块设备</span></span>
<span class="line"><span style="color:#A6ACCD;">dmidecode -t memory </span><span style="color:#676E95;font-style:italic;">#查内存槽位信息. 不跟 -t , 查全量processor, Memory, BIOS</span></span>
<span class="line"></span></code></pre></div><h2 id="_6-锁定文件-不被任何程序修改" tabindex="-1">6 锁定文件,不被任何程序修改 <a class="header-anchor" href="#_6-锁定文件-不被任何程序修改" aria-hidden="true">#</a></h2><p>chattr 可以改变文件扩展属性, <code>chattr +i</code> 可以防止任何程序修改该文件. 即使有root权限.<br> 常用于锁定dns配置,防止dhcp程序自动修改. <code>lsattr</code> 查看当前的扩展属性. <code>man chattr</code> 查看所有参数含义.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">chattr +i /etc/resolv.conf</span></span>
<span class="line"></span></code></pre></div><h2 id="_7-stat-查看文件详细元数据信息-特别是inode" tabindex="-1">7. stat 查看文件详细元数据信息, 特别是inode <a class="header-anchor" href="#_7-stat-查看文件详细元数据信息-特别是inode" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ stat messages</span></span>
<span class="line"><span style="color:#A6ACCD;">  File: ‘messages’</span></span>
<span class="line"><span style="color:#A6ACCD;">  Size: 0         	Blocks: 0          IO Block: 4096   regular empty file</span></span>
<span class="line"><span style="color:#A6ACCD;">Device: fd01h/64769d	Inode: 528438      Links: 1</span></span>
<span class="line"><span style="color:#A6ACCD;">Access: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0600/-rw-------</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  Uid: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">    0/    root</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">   Gid: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">    0/    root</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">Context: system_u:object_r:var_log_t:s0</span></span>
<span class="line"><span style="color:#A6ACCD;">Access: 2018-01-14 21:32:01.977218590 +0800</span></span>
<span class="line"><span style="color:#A6ACCD;">Modify: 2018-01-14 21:32:01.977218590 +0800</span></span>
<span class="line"><span style="color:#A6ACCD;">Change: 2018-01-14 21:32:01.977218590 +0800</span></span>
<span class="line"><span style="color:#A6ACCD;"> Birth: -</span></span>
<span class="line"></span></code></pre></div><h2 id="_8-xxd查看二进制文件" tabindex="-1">8. xxd查看二进制文件 <a class="header-anchor" href="#_8-xxd查看二进制文件" aria-hidden="true">#</a></h2><p>-s 指定起始位置(不指定则从0开始), -l 指定打印多少个字节</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">xxd  -s 1 -l 5 /etc/hosts</span></span>
<span class="line"></span></code></pre></div><p>当将js,或其他文本类信息嵌入到C程序时, <code>xxd -i</code> 非常实用.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ xxd a.js</span></span>
<span class="line"><span style="color:#A6ACCD;">0000000: 7661 7220 6120 3d20 310a                 var a = 1.</span></span>
<span class="line"><span style="color:#A6ACCD;">$ xxd -i a.js</span></span>
<span class="line"><span style="color:#A6ACCD;">unsigned char a_js</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> = </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  0x76, 0x61, 0x72, 0x20, 0x61, 0x20, 0x3d, 0x20, 0x31, 0x0a</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">unsigned int a_js_len = 10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="_9-批量修改文件名" tabindex="-1">9. 批量修改文件名 <a class="header-anchor" href="#_9-批量修改文件名" aria-hidden="true">#</a></h2><p>用法:<code>rename 原字符串 目标字符串 文件</code><br> 含义:<br> 原字符串：将文件名需要替换的字符串；<br> 目标字符串：将文件名中含有的原字符替换成目标字符串；<br> 文件：指定要改变文件名的文件列</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rename支持通配符</span></span>
<span class="line"><span style="color:#A6ACCD;">?    可替代单个字符</span></span>
<span class="line"><span style="color:#A6ACCD;">*    可替代多个字符</span></span>
<span class="line"><span style="color:#A6ACCD;">[charset]    可替代charset集中的任意单个字符</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>将所有已<code>yum</code>开头的文件的后缀名从<code>.yumtx</code>改为<code>.txt</code></p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rename .yumtx .txt yum</span><span style="color:#89DDFF;">*</span></span>
<span class="line"></span></code></pre></div><h2 id="_10-df-查询文件系统挂载点信息" tabindex="-1">10. df 查询文件系统挂载点信息 <a class="header-anchor" href="#_10-df-查询文件系统挂载点信息" aria-hidden="true">#</a></h2><p><code>-h</code> 使容量的大小显示更人性化 <code>-T</code> 显示文件系统类型</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ df -hT</span></span>
<span class="line"><span style="color:#A6ACCD;">Filesystem                   Type      Size  Used Avail Use% Mounted on</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_root ext4       50G  8.0G   39G  18% /</span></span>
<span class="line"><span style="color:#A6ACCD;">devtmpfs                     devtmpfs  484M     0  484M   0% /dev</span></span>
<span class="line"><span style="color:#A6ACCD;">tmpfs                        tmpfs     495M     0  495M   0% /dev/shm</span></span>
<span class="line"><span style="color:#A6ACCD;">tmpfs                        tmpfs     495M  460K  494M   1% /run</span></span>
<span class="line"><span style="color:#A6ACCD;">tmpfs                        tmpfs     495M     0  495M   0% /sys/fs/cgroup</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/sda1                    ext4      477M  234M  215M  53% /boot</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_home ext4       12G   41M   11G   1% /home</span></span>
<span class="line"><span style="color:#A6ACCD;">tmpfs                        tmpfs      99M     0   99M   0% /run/user/0</span></span>
<span class="line"></span></code></pre></div><p><code>-i</code> 显示inode容量</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ df -hi</span></span>
<span class="line"><span style="color:#A6ACCD;">Filesystem                   Inodes IUsed IFree IUse% Mounted on</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_root   3.2M  170K  3.0M    6% /</span></span>
<span class="line"><span style="color:#A6ACCD;">devtmpfs                       121K   389  121K    1% /dev</span></span>
<span class="line"><span style="color:#A6ACCD;">tmpfs                          124K     1  124K    1% /dev/shm</span></span>
<span class="line"><span style="color:#A6ACCD;">tmpfs                          124K   498  124K    1% /run</span></span>
<span class="line"><span style="color:#A6ACCD;">tmpfs                          124K    16  124K    1% /sys/fs/cgroup</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/sda1                      126K   358  125K    1% /boot</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_home   740K    31  740K    1% /home</span></span>
<span class="line"><span style="color:#A6ACCD;">tmpfs                          124K     1  124K    1% /run/user/0</span></span>
<span class="line"></span></code></pre></div><h2 id="_11-du-命令" tabindex="-1">11. du 命令 <a class="header-anchor" href="#_11-du-命令" aria-hidden="true">#</a></h2><p>单位是KB 如下获取/tmp下所有文件的大小, 并按降序排列</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">du -xs /tmp/</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> sort -rn -k1</span></span>
<span class="line"><span style="color:#A6ACCD;">8	systemd-private-415928f8a9ee431abb4fdb7f6265aa87-chronyd.service-uw9sq7</span></span>
<span class="line"><span style="color:#A6ACCD;">4	</span><span style="color:#82AAFF;">test</span></span>
<span class="line"><span style="color:#A6ACCD;">4	empty</span></span>
<span class="line"><span style="color:#A6ACCD;">4	a.tar.gz</span></span>
<span class="line"></span></code></pre></div><h2 id="_12-find删除查找到的文件" tabindex="-1">12. find删除查找到的文件 <a class="header-anchor" href="#_12-find删除查找到的文件" aria-hidden="true">#</a></h2><p>find命令经常会用到, <code>-type f</code>表示只返回文件, <code>-exec</code> 可将已找到的结果作为标准输入执行其他命令.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">find </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">PATH</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> -type f -exec rm {} \;    </span><span style="color:#676E95;font-style:italic;"># 删除查找到的文件, 将 path 改为实际要查找的目录</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">find </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">PATH</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">option</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">action</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">-mtime n </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> n为数字，意思为在n天之前的“一天内”被更改过的文件；  </span></span>
<span class="line"><span style="color:#A6ACCD;">-mtime +n </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> 列出在n天之前（不含n天本身）被更改过的文件名；  </span></span>
<span class="line"><span style="color:#A6ACCD;">-mtime -n </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> 列出在n天之内（含n天本身）被更改过的文件名；  </span></span>
<span class="line"><span style="color:#A6ACCD;">-newer file </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> 列出比file还要新的文件名  </span></span>
<span class="line"><span style="color:#A6ACCD;">例如：  </span></span>
<span class="line"><span style="color:#A6ACCD;">find /root -mtime 0 </span><span style="color:#676E95;font-style:italic;"># 在当前目录下查找今天之内有改动的文件  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">与文件权限及名称有关的参数：  </span></span>
<span class="line"><span style="color:#A6ACCD;">-name filename ：找出文件名为filename的文件  </span></span>
<span class="line"><span style="color:#A6ACCD;">-size </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">+-</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">SIZE ：找出比SIZE还要大（+）或小（-）的文件  </span></span>
<span class="line"><span style="color:#A6ACCD;">-tpye TYPE ：查找文件的类型为TYPE的文件，TYPE的值主要有：一般文件（f)、设备文件（b、c）、  </span></span>
<span class="line"><span style="color:#A6ACCD;">             目录（d）、连接文件（l）、socket（s）、FIFO管道文件（p）；  </span></span>
<span class="line"><span style="color:#A6ACCD;">-perm mode ：查找文件权限刚好等于mode的文件，mode用数字表示，如0755；  </span></span>
<span class="line"><span style="color:#A6ACCD;">-perm -mode ：查找文件权限必须要全部包括mode权限的文件，mode用数字表示  </span></span>
<span class="line"><span style="color:#A6ACCD;">-perm +mode ：查找文件权限包含任一mode的权限的文件，mode用数字表示  </span></span>
<span class="line"><span style="color:#A6ACCD;">例如：  </span></span>
<span class="line"><span style="color:#A6ACCD;">find / -name passwd </span><span style="color:#676E95;font-style:italic;"># 查找文件名为passwd的文件  </span></span>
<span class="line"><span style="color:#A6ACCD;">find </span><span style="color:#82AAFF;">.</span><span style="color:#A6ACCD;"> -perm 0755 </span><span style="color:#676E95;font-style:italic;"># 查找当前目录中文件权限的0755的文件  </span></span>
<span class="line"><span style="color:#A6ACCD;">find </span><span style="color:#82AAFF;">.</span><span style="color:#A6ACCD;"> -size +12k </span><span style="color:#676E95;font-style:italic;"># 查找当前目录中大于12KB的文件，注意c表示byte  </span></span>
<span class="line"></span></code></pre></div><h2 id="_13-xargs-命令" tabindex="-1">13. xargs 命令 <a class="header-anchor" href="#_13-xargs-命令" aria-hidden="true">#</a></h2><p>该命令可以将一个命令的输出作为参数传递给另一个命令。<br> 区别于管道符<code>|</code>是将将输出作为另一个命令的标准输入传递.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">find /tmp -name </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">.png -type f </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> xargs tar -cvzf images.tar.gz</span></span>
<span class="line"></span></code></pre></div><p>默认是将内容放到参数的最后面, 如果要放到指定位置,需要使用 <code>-i</code> 和 <code>{}</code><br> 如下所示，将第一个命令的输出放到<code>{}</code>出现的位置</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ls /etc/</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">.conf </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> xargs -i cp {} /home/likegeeks/Desktop/out</span></span>
<span class="line"></span></code></pre></div><h2 id="_14-grep查询文本" tabindex="-1">14. grep查询文本 <a class="header-anchor" href="#_14-grep查询文本" aria-hidden="true">#</a></h2><p>在文件中查找字符串(不区分大小写)</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">grep -i </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">the</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> /etc/hosts</span></span>
<span class="line"></span></code></pre></div><p>输出成功匹配的行，以及该行之后的三行. -B 表示前三行. -C 指前后三行</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">grep -A 3 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> /etc/hosts</span></span>
<span class="line"></span></code></pre></div><p>在一个文件夹中递归查询包含指定字符串的文件</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">grep -r </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> /etc</span></span>
<span class="line"></span></code></pre></div><p>查找不包含 127 的所有行</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">grep -v </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> /etc/hosts</span></span>
<span class="line"></span></code></pre></div><p>递归搜索时忽略二进制文件,加参数<code>-I</code></p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">grep -r </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> -I /etc</span></span>
<span class="line"></span></code></pre></div><h2 id="_15-tail-查看文件指定行信息" tabindex="-1">15. tail 查看文件指定行信息 <a class="header-anchor" href="#_15-tail-查看文件指定行信息" aria-hidden="true">#</a></h2><p>显示最后3行记录</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ tail -3 /var/log/yum.log-20180101</span></span>
<span class="line"><span style="color:#A6ACCD;">Dec 10 00:35:55 Installed: libvirt-debuginfo-3.2.0-14.el7_4.3.x86_64</span></span>
<span class="line"><span style="color:#A6ACCD;">Dec 10 18:52:40 Installed: cloud-init-0.7.9-9.el7.centos.2.x86_64</span></span>
<span class="line"><span style="color:#A6ACCD;">Dec 10 19:50:30 Erased: cloud-init-0.7.9-9.el7.centos.2.x86_64</span></span>
<span class="line"></span></code></pre></div><p>从第770行开始显示</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ tail -n +770 /var/log/yum.log-20180101</span></span>
<span class="line"><span style="color:#A6ACCD;">Dec 10 18:52:40 Installed: cloud-init-0.7.9-9.el7.centos.2.x86_64</span></span>
<span class="line"><span style="color:#A6ACCD;">Dec 10 19:50:30 Erased: cloud-init-0.7.9-9.el7.centos.2.x86_64</span></span>
<span class="line"></span></code></pre></div><h2 id="_16-批量创建目录" tabindex="-1">16. 批量创建目录 <a class="header-anchor" href="#_16-批量创建目录" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir -p new_folder/{folder_1,folder_2,folder_3,folder_4,folder_5}</span></span>
<span class="line"></span></code></pre></div><h2 id="_17-echo-相关命令" tabindex="-1">17. echo 相关命令 <a class="header-anchor" href="#_17-echo-相关命令" aria-hidden="true">#</a></h2><p>显示当前使用哪个shell</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">-bash</span></span>
<span class="line"></span></code></pre></div><p>显示最近一个命令执行的结果码</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">0</span></span>
<span class="line"></span></code></pre></div><h2 id="_18-nohup与标准输出-标准错误输出" tabindex="-1">18. nohup与标准输出,标准错误输出 <a class="header-anchor" href="#_18-nohup与标准输出-标准错误输出" aria-hidden="true">#</a></h2><p><code>nohup</code>配和<code>&amp;</code>可以让进程在后台运行, 如果没有显示指定, 默认将标准输出和错误输出重定向到 nohup.out<br><code>1&gt;/dev/null</code> 首先表示标准输出重定向到空设备文件，也就是不输出任何信息到终端，不显示任何信息<br><code>2&gt;&amp;1</code> 表示标准错误输出重定向等同于标准输出，因为之前标准输出已经重定向到了空设备文件，所以标准错误输出也重定向到空设备文件<br> 常用使用方式为:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">nohup COMMAND  </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">output.log </span><span style="color:#89DDFF;">2&gt;&amp;1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span></span>
<span class="line"></span></code></pre></div><h2 id="_19-linux模块的安装和卸载" tabindex="-1">19. Linux模块的安装和卸载 <a class="header-anchor" href="#_19-linux模块的安装和卸载" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">lsmod                               </span><span style="color:#676E95;font-style:italic;">#显示当前装入的内核模块</span></span>
<span class="line"><span style="color:#A6ACCD;">modinfo module_name                 </span><span style="color:#676E95;font-style:italic;">#显示模块信息</span></span>
<span class="line"><span style="color:#A6ACCD;">modprobe -c                         </span><span style="color:#676E95;font-style:italic;">#显示模块的配置信息       </span></span>
<span class="line"><span style="color:#A6ACCD;">modprobe --show-depends module_name </span><span style="color:#676E95;font-style:italic;">#显示模块的依赖信息</span></span>
<span class="line"><span style="color:#A6ACCD;">modprobe module_name                </span><span style="color:#676E95;font-style:italic;">#手动加载模块</span></span>
<span class="line"><span style="color:#A6ACCD;">rmmod module_name                   </span><span style="color:#676E95;font-style:italic;">#卸载模块</span></span>
<span class="line"></span></code></pre></div><p>systemd 读取 /etc/modules-load.d/ 中的配置加载额外的内核模块。配置文件名称通常为 <code>/etc/modules-load.d/&lt;program&gt;.conf</code>。如：</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ cat /etc/modules-load.d/bonding.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">bonding</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>使用 /etc/modprobe.d/中的文件来配置传递参数，如:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ /etc/modprobe.d/bonding.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">options bonding mode=1</span></span>
<span class="line"></span></code></pre></div><p>别名</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ cat /etc/modprobe.d/myalias.conf</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Lets you use &#39;mymod&#39; in MODULES, instead of &#39;really_long_module_name&#39;</span></span>
<span class="line"><span style="color:#82AAFF;">alias</span><span style="color:#A6ACCD;"> mymod really_long_module_name</span></span>
<span class="line"></span></code></pre></div><p>如果模块直接编译进内核，也可以通过启动管理器(GRUB, LILO 或 Syslinux)的内核行加入参数： <code>modname.parametername=parametercontents</code></p><p>列出直接编译到内核的模块列表</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ cat /lib/modules/</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">uname -r</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/modules.builtin</span></span>
<span class="line"><span style="color:#A6ACCD;">kernel/lib/zlib_deflate/zlib_deflate.ko</span></span>
<span class="line"><span style="color:#A6ACCD;">kernel/lib/zlib_inflate/zlib_inflate.ko</span></span>
<span class="line"><span style="color:#A6ACCD;">kernel/lib/crc16.ko</span></span>
<span class="line"><span style="color:#A6ACCD;">kernel/lib/crc32.ko</span></span>
<span class="line"></span></code></pre></div><h2 id="_20-column格式化输出" tabindex="-1">20. column格式化输出 <a class="header-anchor" href="#_20-column格式化输出" aria-hidden="true">#</a></h2><p>可以让一些命令的输出看起来更舒服些. 例如<code>blkid</code>,<code>mount</code>,<code>cat /etc/fstab</code>.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ blkid</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/sda1: UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">04f8e14d-906d-475a-bacc-7d4be966f670</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ext4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/sda2: UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8pXbJg-c7bG-CzS4-Xs9Y-SdBD-TYOJ-0r9hgF</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">LVM2_member</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_swap: UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">c058935d-34e0-403c-82f6-435b1c8194ce</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">swap</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_root: UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">e9fe20ee-5d6f-4610-98ca-7cbed5d012ad</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ext4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_home: UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">43578ba0-a809-4274-931d-b92f881196ad</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ext4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">$ blkid </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> column -t</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/sda1:                     UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">04f8e14d-906d-475a-bacc-7d4be966f670</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">    TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ext4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/sda2:                     UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8pXbJg-c7bG-CzS4-Xs9Y-SdBD-TYOJ-0r9hgF</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">LVM2_member</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_swap:  UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">c058935d-34e0-403c-82f6-435b1c8194ce</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">    TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">swap</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_root:  UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">e9fe20ee-5d6f-4610-98ca-7cbed5d012ad</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">    TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ext4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/mapper/VolGroup-lv_home:  UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">43578ba0-a809-4274-931d-b92f881196ad</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">    TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ext4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p><code>-s </code>参数指定可以指定分隔符. 默认是空格</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ grep -E </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sshd|qemu</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> /etc/passwd </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> column -t -s:</span></span>
<span class="line"><span style="color:#A6ACCD;">sshd  x  74   74   Privilege-separated SSH  /var/empty/sshd  /sbin/nologin</span></span>
<span class="line"><span style="color:#A6ACCD;">qemu  x  107  107  qemu user                /                /sbin/nologin</span></span>
<span class="line"></span></code></pre></div><h2 id="_21-通过pid查看进程的环境变量信息" tabindex="-1">21. 通过pid查看进程的环境变量信息 <a class="header-anchor" href="#_21-通过pid查看进程的环境变量信息" aria-hidden="true">#</a></h2><p>使用strings, 可以格式化打印</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ strings /proc/1158/environ</span></span>
<span class="line"><span style="color:#A6ACCD;">LANG=en_US.UTF-8</span></span>
<span class="line"><span style="color:#A6ACCD;">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</span></span>
<span class="line"><span style="color:#A6ACCD;">NOTIFY_SOCKET=/run/systemd/notify</span></span>
<span class="line"><span style="color:#A6ACCD;">SSH_USE_STRONG_RNG=0</span></span>
<span class="line"></span></code></pre></div><h2 id="_22-通过pid查看进程对应可执行文件的绝对路径" tabindex="-1">22. 通过pid查看进程对应可执行文件的绝对路径 <a class="header-anchor" href="#_22-通过pid查看进程对应可执行文件的绝对路径" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">readlink /proc/</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">pid</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">/exe</span></span>
<span class="line"></span></code></pre></div><h2 id="_23-通过pid查看进程的当前工作目录" tabindex="-1">23. 通过pid查看进程的当前工作目录 <a class="header-anchor" href="#_23-通过pid查看进程的当前工作目录" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">pwdx </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">pid</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><h2 id="_24-lsof-一切皆文件" tabindex="-1">24. lsof 一切皆文件 <a class="header-anchor" href="#_24-lsof-一切皆文件" aria-hidden="true">#</a></h2><p><code>-p [PID]</code> 只显示该进程打开的所有文件. 不带参数显示所有已打开的文件<br><code>-d</code> 对<code>FD</code>有效, 用于筛选文件列表. <code>^txt</code> 显示除txt 其他所有类型的文件. <code>1</code> 显示所有fd为1的文件. 可以使用<code>,</code>逗号连接多个选择<br><code>-a</code> 表示两个参数都必须满足 (AND)。如果没有 -a 标志，缺省的情况是显示匹配任何一个参数 (OR) 的文件<br><code>-n</code> 阻止网络地址转换<br><code>-P</code> 阻止端口号到端口名的转换<br><code>-i protocol:@ip:port</code> protocol 包括 tcp 和 udp. 显示符合该地址的文件列表 <code>-u s</code> s为用户名或者用户ID, 选择该用户下的文件</p><p><code>lsof [name]</code><br> name是 mount point或者文件系统对应的设备文件, 则显示在该文件系统上打开的所有文件列表<br> name是 文件夹(非mount point), 则显示所有将该文件夹作为正常文件打开的列表. 例如 cwd, rtd. 如果 <code>+d</code> 打印所有在该目录下已打开的文件,但不递归查找子目录. <code>+D </code>则允许递归查找</p><p>谁在使用 /var/log/audit/audit.log</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ lsof /var/log/audit/audit.log</span></span>
<span class="line"><span style="color:#A6ACCD;">COMMAND PID USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME</span></span>
<span class="line"><span style="color:#A6ACCD;">auditd  669 root    5w   REG  253,1  2027785 524474 /var/log/audit/audit.log</span></span>
<span class="line"></span></code></pre></div><p>显示文件系统<code>/</code>下所有已打开的文件列表. 和<code>fuser /</code>效果一样</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ lsof /</span></span>
<span class="line"></span></code></pre></div><p>所有在/var下已打开的文件</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ lsof +D /var/spool/</span></span>
<span class="line"><span style="color:#A6ACCD;">COMMAND  PID    USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME</span></span>
<span class="line"><span style="color:#A6ACCD;">master  1297    root  cwd    DIR  253,1     4096 524402 /var/spool/postfix</span></span>
<span class="line"><span style="color:#A6ACCD;">master  1297    root   10uW  REG  253,1       33 524591 /var/spool/postfix/pid/master.pid</span></span>
<span class="line"><span style="color:#A6ACCD;">qmgr    1301 postfix  cwd    DIR  253,1     4096 524402 /var/spool/postfix</span></span>
<span class="line"><span style="color:#A6ACCD;">pickup  4178 postfix  cwd    DIR  253,1     4096 524402 /var/spool/postfix</span></span>
<span class="line"></span></code></pre></div><p>列出tcpdump这个用户打开的所有文件</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ lsof -u tcpdump</span></span>
<span class="line"><span style="color:#A6ACCD;">COMMAND   PID    USER   FD   TYPE DEVICE SIZE/OFF    NODE NAME</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  cwd    DIR  253,1     4096 2752513 /root</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  rtd    DIR  253,1     4096       2 /</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  txt    REG  253,1   929928 1323976 /usr/sbin/tcpdump</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  mem    REG  253,1    62184 1328951 /usr/lib64/libnss_files-2.17.so</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  mem    REG    0,7           231120 socket:</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">231120</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">stat: No such file or directory</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  mem    REG  253,1    90664 1311459 /usr/lib64/libz.so.1.2.7</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  mem    REG  253,1    19776 1328757 /usr/lib64/libdl-2.17.so</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  mem    REG  253,1  2127336 1314561 /usr/lib64/libc-2.17.so</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  mem    REG  253,1   266496 1312167 /usr/lib64/libpcap.so.1.5.3</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  mem    REG  253,1  2512448 1312014 /usr/lib64/libcrypto.so.1.0.2k</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  mem    REG  253,1    23968 1311919 /usr/lib64/libcap-ng.so.0.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump  mem    REG  253,1   164264 1311451 /usr/lib64/ld-2.17.so</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump    0u   CHR  136,1      0t0       4 /dev/pts/1</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump    1u   CHR  136,1      0t0       4 /dev/pts/1</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump    2u   CHR  136,1      0t0       4 /dev/pts/1</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump    3u  pack 231120      0t0     ALL type=SOCK_RAW</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump 17905 tcpdump    4w   REG  253,1   864256 2756467 /root/abc2</span></span>
<span class="line"></span></code></pre></div><h2 id="_25-fuser-查找访问文件系统的进程" tabindex="-1">25. fuser 查找访问文件系统的进程 <a class="header-anchor" href="#_25-fuser-查找访问文件系统的进程" aria-hidden="true">#</a></h2><p><code>-v</code> 显示具体的进程名和用户</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ fuser -v /</span></span>
<span class="line"><span style="color:#A6ACCD;">                     USER        PID ACCESS COMMAND</span></span>
<span class="line"><span style="color:#A6ACCD;">/:                   root     kernel mount /</span></span>
<span class="line"><span style="color:#A6ACCD;">                     root          1 .rc.. systemd</span></span>
<span class="line"><span style="color:#A6ACCD;">                     root          2 .rc.. kthreadd</span></span>
<span class="line"><span style="color:#A6ACCD;">                     root          3 .rc.. ksoftirqd/0</span></span>
<span class="line"><span style="color:#A6ACCD;">                     root          5 .rc.. kworker/0:0H</span></span>
<span class="line"></span></code></pre></div><p><code>-k</code> kill掉访问该文件系统的所有进程.慎用. 先使用上述命令查询</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">fuser -k /</span></span>
<span class="line"></span></code></pre></div><h2 id="_26-dd-测试磁盘或者文件读写" tabindex="-1">26. dd 测试磁盘或者文件读写 <a class="header-anchor" href="#_26-dd-测试磁盘或者文件读写" aria-hidden="true">#</a></h2><p>高危命令, <code>of</code>一定要指向正确的文件, 不要指 <code>/</code>, <code>/dev/vda</code>, <code>/dev/vda1</code>等系统重要设备.<br> 该命令要在测试环境验证充分.<br><code>if</code> 表示从哪个设备/文件读<br><code>of</code> 表示写到哪个设备/文件<br><code>bs</code> 表示一次读写多少字节. 也可以使用 1K, 1M这样带单位的<br><code>count</code> 表示最多读写多少次. 总的读写量为 <code>bs * count</code><br><code>/dev/zero</code> 可以无限读取<code>\0</code></p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">dd if=/dev/zero of=/tmp/abc.txt bs=1M count=10</span></span>
<span class="line"></span></code></pre></div><h2 id="_27-rpm-安装-更新-卸载软件包" tabindex="-1">27. rpm 安装/更新/卸载软件包 <a class="header-anchor" href="#_27-rpm-安装-更新-卸载软件包" aria-hidden="true">#</a></h2><p>查询系统已安装的所有软件包</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -qa</span></span>
<span class="line"></span></code></pre></div><p>查询某个文件所属的软件包名. 文件必须是绝对路径</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -qf /etc/ssh/sshd_config</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -qf </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">which strace</span><span style="color:#89DDFF;">`</span></span>
<span class="line"></span></code></pre></div><p>查询包所含有的文件</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -ql strace</span></span>
<span class="line"></span></code></pre></div><p>查询包里的配置文件</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -qc openssh-server</span></span>
<span class="line"></span></code></pre></div><p>查询包里的文档</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -qd openssh-server</span></span>
<span class="line"></span></code></pre></div><p>查询软件包里的脚本信息</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ rpm -q --scripts openssh-server</span></span>
<span class="line"><span style="color:#A6ACCD;">preinstall scriptlet </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">using /bin/sh</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">getent group sshd </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> groupadd -g 74 -r sshd </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">getent passwd sshd </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> \</span></span>
<span class="line"><span style="color:#A6ACCD;">  useradd -c </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Privilege-separated SSH</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> -u 74 -g sshd \</span></span>
<span class="line"><span style="color:#A6ACCD;">  -s /sbin/nologin -r -d /var/empty/sshd sshd </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#A6ACCD;"> /dev/null </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">postinstall scriptlet </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">using /bin/sh</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#89DDFF;">-eq</span><span style="color:#A6ACCD;"> 1 </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;"># Initial installation</span></span>
<span class="line"><span style="color:#A6ACCD;">        systemctl preset sshd.service sshd.socket </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null </span><span style="color:#89DDFF;">2&gt;&amp;1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"><span style="color:#A6ACCD;">preuninstall scriptlet </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">using /bin/sh</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#89DDFF;">-eq</span><span style="color:#A6ACCD;"> 0 </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;"># Package removal, not upgrade</span></span>
<span class="line"><span style="color:#A6ACCD;">        systemctl --no-reload disable sshd.service sshd.socket </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /dev/null </span><span style="color:#89DDFF;">2&gt;&amp;1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        systemctl stop sshd.service sshd.socket </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /dev/null </span><span style="color:#89DDFF;">2&gt;&amp;1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"><span style="color:#A6ACCD;">postuninstall scriptlet </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">using /bin/sh</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">systemctl daemon-reload </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null </span><span style="color:#89DDFF;">2&gt;&amp;1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#89DDFF;">-ge</span><span style="color:#A6ACCD;"> 1 </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;"># Package upgrade, not uninstall</span></span>
<span class="line"><span style="color:#A6ACCD;">        systemctl try-restart sshd.service </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null </span><span style="color:#89DDFF;">2&gt;&amp;1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"></span></code></pre></div><p>查询包,自定义输出的格式和地段</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -qa --queryformat </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%-35{NAME} %{VERSION} %{RELEASE} %{INSTALLTIME:date}\n</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">jzlib                               1.1.1 6.el7 Thu 27 Jun 2019 11:30:01 AM HKT</span></span>
<span class="line"><span style="color:#A6ACCD;">nss                                 3.36.0 7.1.el7_6 Tue 11 Jun 2019 11:13:42 PM HKT</span></span>
<span class="line"><span style="color:#A6ACCD;">hamcrest                            1.3 6.el7 Thu 27 Jun 2019 11:30:01 AM HKT</span></span>
<span class="line"><span style="color:#A6ACCD;">dhcp-libs                           4.2.5 68.el7.centos.1 Tue 11 Jun 2019 11:13:43 PM HKT</span></span>
<span class="line"></span></code></pre></div><p>查询当前包的changelog. 常用于查看已解决的CVE列表</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -q --changelog openssh-server</span></span>
<span class="line"></span></code></pre></div><p>查询包所能提供的CAPABILITY</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -q --provides glibc</span></span>
<span class="line"></span></code></pre></div><p>查询哪些包依赖某个CAPABILITY</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -q --whatrequires </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">CAPABILITY</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p>查询包所依赖的CAPABILITY</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -q -R glibc</span></span>
<span class="line"></span></code></pre></div><p>查询包所有提供的CAPABILITY</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -q --whatprovides </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">CAPABILITY</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p>校验当前包与原始状态的差别.<br> 5 -- MD5 校验和<br> S -- 文件长度<br> L -- 符号链接<br> T -- 文件修改日期<br> D -- 设备<br> U -- 用户<br> G -- 用户组<br> M -- 模式 (包含许可和文件类型)<br> ? -- 不可读文件<br> 如下标志文件的md5, 文件长度, 修改日志有变化</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ rpm  -V openssh-server</span></span>
<span class="line"><span style="color:#A6ACCD;">S.5....T.  c /etc/ssh/sshd_config</span></span>
<span class="line"></span></code></pre></div><p>安装本地包 <code>-vh</code> 获得一个详细的安装进程 <code>--nodeps</code> 忽略依赖关系</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -ivh abc.rpm</span></span>
<span class="line"></span></code></pre></div><p>卸载包</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -e abc.rpm</span></span>
<span class="line"></span></code></pre></div><p>升级包</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -Uvh abc.rpm</span></span>
<span class="line"></span></code></pre></div><p>查询本地包的信息,要加<code>-p</code></p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm -ql -p abc.rpm</span></span>
<span class="line"></span></code></pre></div><h2 id="_28-yum-安装-更新-卸载软件包" tabindex="-1">28. yum 安装/更新/卸载软件包 <a class="header-anchor" href="#_28-yum-安装-更新-卸载软件包" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">yum install a            </span><span style="color:#676E95;font-style:italic;">#安装软件包a   (加上-y选项，可以在安装软件包时，不弹出是否继续的提示)</span></span>
<span class="line"><span style="color:#A6ACCD;">yum install xxx --downloadonly --downloaddir=/xxx  </span><span style="color:#676E95;font-style:italic;">#只下载,不安装.</span></span>
<span class="line"><span style="color:#A6ACCD;">yum reinstall xxx        </span><span style="color:#676E95;font-style:italic;">#重装</span></span>
<span class="line"><span style="color:#A6ACCD;">yum remove a             </span><span style="color:#676E95;font-style:italic;">#卸载软件包a</span></span>
<span class="line"><span style="color:#A6ACCD;">yum groups list          </span><span style="color:#676E95;font-style:italic;">#查看已安装的软件组和可用的软件组</span></span>
<span class="line"><span style="color:#A6ACCD;">yum groups  install </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Basic Web Server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#安装软件组</span></span>
<span class="line"><span style="color:#A6ACCD;">yum groups remove </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Basic Web Server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;">#卸载软件组</span></span>
<span class="line"><span style="color:#A6ACCD;">yum info a               </span><span style="color:#676E95;font-style:italic;">#查看软件包a的相关信息，如大小，版本等...</span></span>
<span class="line"><span style="color:#A6ACCD;">yum update a             </span><span style="color:#676E95;font-style:italic;">#更新软件包a</span></span>
<span class="line"><span style="color:#A6ACCD;">yum update               </span><span style="color:#676E95;font-style:italic;">#整体更新所有可更新的软件包</span></span>
<span class="line"><span style="color:#A6ACCD;">yum provides 文件或目录    </span><span style="color:#676E95;font-style:italic;">#查看文件由哪个rpm包提供的</span></span>
<span class="line"><span style="color:#A6ACCD;">yum search tree          </span><span style="color:#676E95;font-style:italic;">#从仓库中搜索关键词为tree的包</span></span>
<span class="line"><span style="color:#A6ACCD;">yum </span><span style="color:#82AAFF;">history</span><span style="color:#A6ACCD;">              </span><span style="color:#676E95;font-style:italic;">#查看yum运行历史记录</span></span>
<span class="line"></span></code></pre></div><blockquote><p>查找某个文件属于哪个包的方法有:<br> 如果文件已经安装在本机, 则<code>rpm -qf xxx</code><br> 如果文件没有在本机安装, 则<code>yum provides XXX</code> XXX 可以是文件名, 也可以使用glob这样的通配符去查找<br> 比如安装某rpm包, 提示文件没找到, 则可以使用 <code>yum provices xxx</code>. 比如文件名为 abc.txt, 用<code>yum provides *abc.txt</code>去查找</p></blockquote><p>查询当前在repo里指定包的所有可用版本, 可用于升级到特定版本. <code>yum update systemd</code>默认升级到最新版</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ yum list --showduplicates systemd</span></span>
<span class="line"><span style="color:#A6ACCD;">Installed Packages</span></span>
<span class="line"><span style="color:#A6ACCD;">systemd.x86_64                  219-42.el7_4.1                  @updates</span></span>
<span class="line"><span style="color:#A6ACCD;">Available Packages</span></span>
<span class="line"><span style="color:#A6ACCD;">systemd.x86_64                  219-42.el7                      base</span></span>
<span class="line"><span style="color:#A6ACCD;">systemd.x86_64                  219-42.el7_4.1                  updates</span></span>
<span class="line"><span style="color:#A6ACCD;">systemd.x86_64                  219-42.el7_4.4                  updates</span></span>
<span class="line"></span></code></pre></div><p>升级指定包到特定的版本</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">yum install systemd-219-42.el7_4.4</span></span>
<span class="line"></span></code></pre></div><p>具体查看某次事务中安装,更新,删除的包列表</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ yum </span><span style="color:#82AAFF;">history</span><span style="color:#A6ACCD;"> info 307</span></span>
<span class="line"><span style="color:#A6ACCD;">Loaded plugins: auto-update-debuginfo, fastestmirror</span></span>
<span class="line"><span style="color:#A6ACCD;">Transaction ID </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> 307</span></span>
<span class="line"><span style="color:#A6ACCD;">Begin </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> Sat Dec  9 20:24:11 2017</span></span>
<span class="line"><span style="color:#A6ACCD;">Begin rpmdb    </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> 700:b36eb7acc22b3ab4b107097d0b740dc6bfd84a58</span></span>
<span class="line"><span style="color:#A6ACCD;">End </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;">       </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;">            20:24:12 2017 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">1 seconds</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">End rpmdb      </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> 701:df2089f95d28d6f1f19561b39352bf3dd7a98c75</span></span>
<span class="line"><span style="color:#A6ACCD;">User           </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> root </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">root</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">Return-Code    </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> Success</span></span>
<span class="line"><span style="color:#A6ACCD;">Command Line   </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> install qemu-kvm</span></span>
<span class="line"><span style="color:#A6ACCD;">Transaction performed with:</span></span>
<span class="line"><span style="color:#A6ACCD;">    Installed     rpm-4.11.3-25.el7.x86_64                      @base</span></span>
<span class="line"><span style="color:#A6ACCD;">    Installed     yum-3.4.3-154.el7.centos.noarch               @base</span></span>
<span class="line"><span style="color:#A6ACCD;">    Installed     yum-plugin-fastestmirror-1.1.31-42.el7.noarch @base</span></span>
<span class="line"><span style="color:#A6ACCD;">Packages Altered:</span></span>
<span class="line"><span style="color:#A6ACCD;">    Updated qemu-img-10:1.5.3-141.el7_4.2.x86_64        @updates</span></span>
<span class="line"><span style="color:#A6ACCD;">    Update           10:1.5.3-141.el7_4.4.x86_64        @updates</span></span>
<span class="line"><span style="color:#A6ACCD;">    Install qemu-kvm-10:1.5.3-141.el7_4.4.x86_64        @updates</span></span>
<span class="line"><span style="color:#A6ACCD;">    Updated qemu-kvm-common-10:1.5.3-141.el7_4.2.x86_64 @updates</span></span>
<span class="line"><span style="color:#A6ACCD;">    Update                  10:1.5.3-141.el7_4.4.x86_64 @updates</span></span>
<span class="line"><span style="color:#82AAFF;">history</span><span style="color:#A6ACCD;"> info</span></span>
<span class="line"></span></code></pre></div><p>查询某个软件包的所有历史变更记录</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ yum </span><span style="color:#82AAFF;">history</span><span style="color:#A6ACCD;"> list  cloud-init</span></span>
<span class="line"><span style="color:#A6ACCD;">Loaded plugins: auto-update-debuginfo, fastestmirror</span></span>
<span class="line"><span style="color:#A6ACCD;">ID     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Command line             </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Date and </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Action</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Altered</span></span>
<span class="line"><span style="color:#A6ACCD;">-------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">   312 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> erase cloud-init         </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> 2018-01-11 00:07 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Erase          </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    1</span></span>
<span class="line"><span style="color:#A6ACCD;">   311 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> install cloud-init       </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> 2018-01-11 00:01 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Install        </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    1</span></span>
<span class="line"><span style="color:#A6ACCD;">   310 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> erase cloud-init         </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> 2017-12-10 19:50 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Erase          </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    1</span></span>
<span class="line"><span style="color:#A6ACCD;">   309 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> install cloud-init       </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> 2017-12-10 18:52 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Install        </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    1</span></span>
<span class="line"><span style="color:#A6ACCD;">   306 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> erase cloud-init         </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> 2017-12-09 13:09 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Erase          </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    1</span></span>
<span class="line"><span style="color:#A6ACCD;">   301 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> install cloud-init       </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> 2017-10-14 11:49 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> Install        </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    5</span></span>
<span class="line"><span style="color:#82AAFF;">history</span><span style="color:#A6ACCD;"> list</span></span>
<span class="line"></span></code></pre></div><p>查询包的依赖关系</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ yum deplist strace</span></span>
<span class="line"><span style="color:#A6ACCD;">package: strace.x86_64 4.12-4.el7</span></span>
<span class="line"><span style="color:#A6ACCD;">  dependency: /bin/sh</span></span>
<span class="line"><span style="color:#A6ACCD;">   provider: bash.x86_64 4.2.46-29.el7_4</span></span>
<span class="line"><span style="color:#A6ACCD;">  dependency: libc.so.6</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">GLIBC_2.15</span><span style="color:#89DDFF;">)(</span><span style="color:#A6ACCD;">64bit</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   provider: glibc.x86_64 2.17-196.el7_4.2</span></span>
<span class="line"><span style="color:#A6ACCD;">  dependency: </span><span style="color:#82AAFF;">libgcc_s.so.1</span><span style="color:#89DDFF;">()(</span><span style="color:#A6ACCD;">64bit</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   provider: libgcc.x86_64 4.8.5-16.el7_4.1</span></span>
<span class="line"><span style="color:#A6ACCD;">  dependency: libgcc_s.so.1</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">GCC_3.0</span><span style="color:#89DDFF;">)(</span><span style="color:#A6ACCD;">64bit</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   provider: libgcc.x86_64 4.8.5-16.el7_4.1</span></span>
<span class="line"><span style="color:#A6ACCD;">  dependency: libgcc_s.so.1</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">GCC_3.3.1</span><span style="color:#89DDFF;">)(</span><span style="color:#A6ACCD;">64bit</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   provider: libgcc.x86_64 4.8.5-16.el7_4.1</span></span>
<span class="line"><span style="color:#A6ACCD;">  dependency: rtld</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">GNU_HASH</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   provider: glibc.x86_64 2.17-196.el7_4.2</span></span>
<span class="line"><span style="color:#A6ACCD;">   provider: glibc.i686 2.17-196.el7_4.2</span></span>
<span class="line"></span></code></pre></div><h2 id="_29-解压缩命令" tabindex="-1">29. 解压缩命令 <a class="header-anchor" href="#_29-解压缩命令" aria-hidden="true">#</a></h2><p>tar.gz</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">tar -xzvf abc.tar.gz               </span><span style="color:#676E95;font-style:italic;">#解压缩</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -xzvf abc.tar.gz -C /path      </span><span style="color:#676E95;font-style:italic;">#解压缩到制动的path目录下</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -tzvf abc.tar.gz               </span><span style="color:#676E95;font-style:italic;">#不解压,只查看文件列表</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -czvf abc.tar.gz a.txt b.txt   </span><span style="color:#676E95;font-style:italic;">#将 a.txt 和 b.txt 压缩为 abc.tar.gz</span></span>
<span class="line"></span></code></pre></div><p>.gz</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">gzip -d FileName.gz      </span><span style="color:#676E95;font-style:italic;">#解压</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip FileName            </span><span style="color:#676E95;font-style:italic;">#压缩</span></span>
<span class="line"></span></code></pre></div><p>.bz .bz2</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">bzip2 -d FileName.bz2    </span><span style="color:#676E95;font-style:italic;">#解压</span></span>
<span class="line"></span></code></pre></div><p>.tar.bz .tar.bz2</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">tar jxvf FileName.tar.bz2 </span><span style="color:#676E95;font-style:italic;">#解压</span></span>
<span class="line"></span></code></pre></div><p>.Z</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">uncompress FileName.Z    </span><span style="color:#676E95;font-style:italic;">#解压</span></span>
<span class="line"><span style="color:#A6ACCD;">compress FileName        </span><span style="color:#676E95;font-style:italic;">#压缩</span></span>
<span class="line"></span></code></pre></div><p>.zip</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">unzip FileName.zip       </span><span style="color:#676E95;font-style:italic;">#解压</span></span>
<span class="line"><span style="color:#A6ACCD;">zip FileName.zip DirName </span><span style="color:#676E95;font-style:italic;">#压缩</span></span>
<span class="line"></span></code></pre></div><p>.rar</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rar x FileName.rar                </span><span style="color:#676E95;font-style:italic;">#解压</span></span>
<span class="line"><span style="color:#A6ACCD;">rar a FileName.rar DirName        </span><span style="color:#676E95;font-style:italic;">#压缩</span></span>
<span class="line"></span></code></pre></div><p>.rpm</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rpm2cpio FileName.rpm </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> cpio -div   </span><span style="color:#676E95;font-style:italic;">#解包</span></span>
<span class="line"></span></code></pre></div><p>.deb</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ar p FileName.deb data.tar.gz </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> tar -xzvf  </span><span style="color:#676E95;font-style:italic;">#解包</span></span>
<span class="line"></span></code></pre></div><h2 id="_30-systemd-管理命令" tabindex="-1">30. systemd 管理命令 <a class="header-anchor" href="#_30-systemd-管理命令" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">systemctl    -t </span><span style="color:#82AAFF;">help</span><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;">#列出所有的单元类型</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl --type </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">unit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;">#查看指定单元类型的状况, 替换 unit 为 &quot;mount&quot;, &quot;service&quot;, &quot;socket&quot;等</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl --failed              </span><span style="color:#676E95;font-style:italic;">#查看所有加载失败的单元信息</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl status sshd           </span><span style="color:#676E95;font-style:italic;">#查看sshd服务单元状况</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl start sshd            </span><span style="color:#676E95;font-style:italic;">#启动sshd服务单元</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl stop sshd             </span><span style="color:#676E95;font-style:italic;">#停止sshd服务单元</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl restart sshd          </span><span style="color:#676E95;font-style:italic;">#重启sshd服务单元</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl </span><span style="color:#82AAFF;">enable</span><span style="color:#A6ACCD;"> sshd           </span><span style="color:#676E95;font-style:italic;">#配置sshd服务单元开机自动启动</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl disable sshd          </span><span style="color:#676E95;font-style:italic;">#配置sshd服务单元开机不启动</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl reload sshd           </span><span style="color:#676E95;font-style:italic;">#重新加载sshd服务单元的配置文件</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl mask sshd             </span><span style="color:#676E95;font-style:italic;">#彻底屏蔽sshd服务单元</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl unmask sshd           </span><span style="color:#676E95;font-style:italic;">#取消屏蔽sshd服务单元</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl list-units            </span><span style="color:#676E95;font-style:italic;">#列出当前所有的单元, 这是 systemctl 的默认命令</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl get-default           </span><span style="color:#676E95;font-style:italic;">#查看系统默认启动的Target</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl set-default multi-user.target  </span><span style="color:#676E95;font-style:italic;"># 设置系统默认的target为 多用户模式</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl list-dependencies multi-user.target  </span><span style="color:#676E95;font-style:italic;">#查看该target下所有的unit</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl list-dependencies sshd   </span><span style="color:#676E95;font-style:italic;"># 查看一个service所依赖的所有unit</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl list-dependencies --reverse sshd   </span><span style="color:#676E95;font-style:italic;"># 查看哪个unit依赖该服务</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl list-dependencies --before sshd   </span><span style="color:#676E95;font-style:italic;"># 查看所有unit after sshd, 也就是 sshd 配置里的before=</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl list-dependencies --after sshd   </span><span style="color:#676E95;font-style:italic;"># 查看所有unit before sshd</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl cat sshd              </span><span style="color:#676E95;font-style:italic;">#查看service的配置文件</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl show sshd             </span><span style="color:#676E95;font-style:italic;">#查看service的配置参数, 不带 service则显示默认的配置. 可用来查询nofile, noproc等限制资源参数</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl list-jobs             </span><span style="color:#676E95;font-style:italic;">#查看有哪些job仍在运行或者等待运行</span></span>
<span class="line"></span></code></pre></div><blockquote><p>/etc/security/limits.conf无法设置systemd服务的资源限制. 参见:<br><a href="http://smilejay.com/2016/06/centos-7-systemd-conf-limits/" target="_blank" rel="noopener noreferrer">http://smilejay.com/2016/06/centos-7-systemd-conf-limits/</a></p></blockquote><p>列出当前旧的LSB脚本</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ systemctl </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> grep LSB</span></span>
<span class="line"><span style="color:#A6ACCD;">  network.service       loaded active running   LSB: Bring up/down networking</span></span>
<span class="line"><span style="color:#A6ACCD;">  prl-x11.service       loaded active exited    LSB: Autostart script </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> Parallels service</span></span>
<span class="line"><span style="color:#A6ACCD;">  prltoolsd.service     loaded active running   LSB: Autostart script </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> guest tools service.</span></span>
<span class="line"></span></code></pre></div><p>查询systemd 版本</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ systemctl --version</span></span>
<span class="line"><span style="color:#A6ACCD;">systemd 219</span></span>
<span class="line"><span style="color:#A6ACCD;">+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ -LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN</span></span>
<span class="line"></span></code></pre></div><p>查看启动耗时</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ systemd-analyze</span></span>
<span class="line"><span style="color:#A6ACCD;">Startup finished </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> 579ms </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">kernel</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> + 2.964s </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">initrd</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> + 8.899s </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">userspace</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 12.442s</span></span>
<span class="line"></span></code></pre></div><p>查看每个服务的启动耗时,并打印TOP5</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ systemd-analyze blame </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> head -5</span></span>
<span class="line"><span style="color:#A6ACCD;">          4.949s NetworkManager-wait-online.service</span></span>
<span class="line"><span style="color:#A6ACCD;">          3.379s network.service</span></span>
<span class="line"><span style="color:#A6ACCD;">           987ms postfix.service</span></span>
<span class="line"><span style="color:#A6ACCD;">           656ms dev-mapper-VolGroup\x2dlv_root.device</span></span>
<span class="line"><span style="color:#A6ACCD;">           591ms lvm2-monitor.service</span></span>
<span class="line"></span></code></pre></div><p>打印最耗时的一条启动链, 后面跟指定的service, 则打印该服务的启动链</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ systemd-analyze critical-chain</span></span>
<span class="line"><span style="color:#A6ACCD;">The </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> after the unit is active or started is printed after the </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> character.</span></span>
<span class="line"><span style="color:#A6ACCD;">The </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> the unit takes to start is printed after the </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">+</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> character.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">multi-user.target @8.863s</span></span>
<span class="line"><span style="color:#A6ACCD;">└─postfix.service @7.864s +987ms</span></span>
<span class="line"><span style="color:#A6ACCD;">  └─network.target @7.856s</span></span>
<span class="line"><span style="color:#A6ACCD;">    └─NetworkManager.service @2.459s +64ms</span></span>
<span class="line"><span style="color:#A6ACCD;">      └─network-pre.target @2.458s</span></span>
<span class="line"><span style="color:#A6ACCD;">        └─firewalld.service @1.934s +523ms</span></span>
<span class="line"><span style="color:#A6ACCD;">          └─polkit.service @1.724s +203ms</span></span>
<span class="line"><span style="color:#A6ACCD;">            └─basic.target @1.721s</span></span>
<span class="line"><span style="color:#A6ACCD;">              └─sockets.target @1.721s</span></span>
<span class="line"><span style="color:#A6ACCD;">                └─iscsiuio.socket @1.721s</span></span>
<span class="line"><span style="color:#A6ACCD;">                  └─sysinit.target @1.709s</span></span>
<span class="line"><span style="color:#A6ACCD;">                    └─systemd-update-utmp.service @1.700s +8ms</span></span>
<span class="line"><span style="color:#A6ACCD;">                      └─auditd.service @1.426s +272ms</span></span>
<span class="line"><span style="color:#A6ACCD;">                        └─systemd-tmpfiles-setup.service @1.358s +58ms</span></span>
<span class="line"><span style="color:#A6ACCD;">                          └─rhel-import-state.service @1.303s +52ms</span></span>
<span class="line"><span style="color:#A6ACCD;">                            └─local-fs.target @1.299s</span></span>
<span class="line"><span style="color:#A6ACCD;">                              └─home.mount @1.283s +15ms</span></span>
<span class="line"><span style="color:#A6ACCD;">                                └─systemd-fsck@dev-mapper-VolGroup\x2dlv_home.service @1.266s +14ms</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  └─dev-mapper-VolGroup\x2dlv_home.device @1.265s</span></span>
<span class="line"></span></code></pre></div><p>生成启动瀑布图, 使用chrome浏览器打开 a.svg. 分析启动性能更加直观</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">systemd-analyze plot </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">a.svg</span></span>
<span class="line"></span></code></pre></div><p>启动瀑布图<br><img src="/img/systemd_plot.svg" alt="启动瀑布图"></p><p>journalctl 相关操作</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">journalctl                       </span><span style="color:#676E95;font-style:italic;"># 查看所有日志（默认情况下 ，显示所有可以查看的日志）</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl -k                    </span><span style="color:#676E95;font-style:italic;"># 查看内核日志（不显示应用日志）</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl -b                    </span><span style="color:#676E95;font-style:italic;"># 查看系统本次启动的日志                 </span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl -b -1                 </span><span style="color:#676E95;font-style:italic;"># 查看上一次启动的日志（需更改设置）</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl -f               </span><span style="color:#676E95;font-style:italic;"># 实时滚动显示最新日志</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl /usr/lib/systemd/systemd </span><span style="color:#676E95;font-style:italic;"># 查看指定可执行文件的日志, 必须指定绝对路径</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl _PID=1                </span><span style="color:#676E95;font-style:italic;"># 查看指定进程的日志</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl -u sshd               </span><span style="color:#676E95;font-style:italic;"># 查看某个 Unit 的日志</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl --disk-usage          </span><span style="color:#676E95;font-style:italic;"># 显示日志占据的硬盘空间</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl --list-boots          </span><span style="color:#676E95;font-style:italic;"># 显示每次启动的id和时间</span></span>
<span class="line"></span></code></pre></div><p>查看指定时间的日志</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">journalctl --since </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2012-10-30 18:17:16</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl --since </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2020-10-01</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl --since </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">20 min ago</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl --since </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-5m</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl --since </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-5d</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl --since yesterday</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl --since </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2015-01-10</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> --until </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2015-01-11 03:00</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">journalctl --since 09:00 --until </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1 hour ago</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>时间格式可参考<code>man journalctl</code>或者<code>man 7 systemd.time</code></p><h2 id="_31-ubuntu-debian-检查已经安装好的软件包的更新日志" tabindex="-1">31. Ubuntu/Debian 检查已经安装好的软件包的更新日志 <a class="header-anchor" href="#_31-ubuntu-debian-检查已经安装好的软件包的更新日志" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">zless /usr/share/doc/</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">package -name</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/changelog.Debian.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">zless /usr/share/doc/</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">package -name</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/changelog.gz</span></span>
<span class="line"></span></code></pre></div><h2 id="_32-搜索含有指定字符的手册页" tabindex="-1">32. 搜索含有指定字符的手册页 <a class="header-anchor" href="#_32-搜索含有指定字符的手册页" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ man -k logrotate</span></span>
<span class="line"><span style="color:#A6ACCD;">dh_installlogrotate </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> - install logrotate config files</span></span>
<span class="line"><span style="color:#A6ACCD;">logrotate </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">8</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> - rotates, compresses, and mails system logs</span></span>
<span class="line"><span style="color:#A6ACCD;">logrotate.conf </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> - rotates, compresses, and mails system logs</span></span>
<span class="line"></span></code></pre></div><h2 id="_33-快速删除大量小文件" tabindex="-1">33. 快速删除大量小文件 <a class="header-anchor" href="#_33-快速删除大量小文件" aria-hidden="true">#</a></h2><p>使用<code>rsync</code>, 速度快但占用大量IO, 业务量低时使用. 高危命令</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir empty_dir</span></span>
<span class="line"><span style="color:#A6ACCD;">rsync -a --delete empty_dir/    yourdirectory/</span></span>
<span class="line"></span></code></pre></div><p>使用<code>find</code>, 速度慢但消耗IO少. <code>rm</code>会遇到<code>Argument list too long</code>报错</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">find /tmp -type f -exec rm {} \;      </span><span style="color:#676E95;font-style:italic;">#删除/tmp目录下所有文件</span></span>
<span class="line"></span></code></pre></div><h2 id="_34-sysctl-管理系统参数" tabindex="-1">34. sysctl 管理系统参数 <a class="header-anchor" href="#_34-sysctl-管理系统参数" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">sysctl -a                                       </span><span style="color:#676E95;font-style:italic;">#打印当前参数</span></span>
<span class="line"><span style="color:#A6ACCD;">sysctl -w net.ipv4.tcp_fin_timeout=30           </span><span style="color:#676E95;font-style:italic;">#实时更新一个系统参数, 高危. 要验证好</span></span>
<span class="line"><span style="color:#A6ACCD;">sysctl -p                                       </span><span style="color:#676E95;font-style:italic;">#读取/etc/sysctl.conf和 /etc/sysctl.d/下配置文件信息,使其生效  </span></span>
<span class="line"></span></code></pre></div><h2 id="_35-清空文件内容" tabindex="-1">35. 清空文件内容 <a class="header-anchor" href="#_35-清空文件内容" aria-hidden="true">#</a></h2><p>假设文件名为 abc.txt, 以下方法都可以清空该文件的内容</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> abc.txt</span></span>
<span class="line"><span style="color:#A6ACCD;">cp /dev/null abc.txt</span></span>
<span class="line"></span></code></pre></div><h2 id="_36-查询系统调用" tabindex="-1">36. 查询系统调用 <a class="header-anchor" href="#_36-查询系统调用" aria-hidden="true">#</a></h2><p>跟踪命令<code>ls -rlt</code>的系统调用, 将信息输出到<code>a.txt</code></p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">strace -ftT -o a.txt ls -rlt</span></span>
<span class="line"></span></code></pre></div><p>统计命令进行的系统调用信息</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">strace -c ls</span></span>
<span class="line"></span></code></pre></div><p>跟踪具体的进程</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">strace -p </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">pid</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p>过滤系统调用</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">strace -e trace=open ls</span></span>
<span class="line"><span style="color:#A6ACCD;">strace -e trace=open,write ls</span></span>
<span class="line"></span></code></pre></div><h2 id="_37-查看磁盘uuid和文件系统类型" tabindex="-1">37. 查看磁盘uuid和文件系统类型 <a class="header-anchor" href="#_37-查看磁盘uuid和文件系统类型" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ lsblk -f</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span></span>
<span class="line"><span style="color:#A6ACCD;">vda</span></span>
<span class="line"><span style="color:#A6ACCD;">└─vda1 ext3         32236b41-fcde-460e-8c34-ba50515b33f2 /</span></span>
<span class="line"><span style="color:#A6ACCD;">$ blkid</span></span>
<span class="line"><span style="color:#A6ACCD;">/dev/vda1: UUID=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">32236b41-fcde-460e-8c34-ba50515b33f2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> TYPE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ext3</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h2 id="_38-创建软连接" tabindex="-1">38. 创建软连接 <a class="header-anchor" href="#_38-创建软连接" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ln -s regular_file softlink          创建软连接</span></span>
<span class="line"></span></code></pre></div><h2 id="_39-history查看历史记录" tabindex="-1">39. history查看历史记录 <a class="header-anchor" href="#_39-history查看历史记录" aria-hidden="true">#</a></h2><p>如果直接执行<code>history</code>没有显示时间戳,可以使用下面的命令</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">HISTTIMEFORMAT=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%d/%m/%y %T</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">history</span></span>
<span class="line"></span></code></pre></div><h2 id="_40-查看进程的父子调用关系" tabindex="-1">40. 查看进程的父子调用关系 <a class="header-anchor" href="#_40-查看进程的父子调用关系" aria-hidden="true">#</a></h2><p><code>-p</code> 显示pid信息. {}表示线程</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ pstree -p</span></span>
<span class="line"><span style="color:#A6ACCD;">systemd</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">─┬─agetty</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">1176</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           ├─auditd</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">669</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">───{auditd}</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">670</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           ├─avahi-daemon</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">701</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">───avahi-daemon</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">720</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           ├─chronyd</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">721</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           ├─crond</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">1169</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           ├─dbus-daemon</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">702</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">───{dbus-daemon}</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">730</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           ├─dhclient</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">4673</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           ├─dnsmasq</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">1344</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">───dnsmasq</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">1345</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           ├─firewalld</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">776</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">───{firewalld}</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">952</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           ├─gssproxy</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">714</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">─┬─{gssproxy}</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">724</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           │               ├─{gssproxy}</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">725</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           │               ├─{gssproxy}</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">726</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           │               ├─{gssproxy}</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">727</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">           │               └─{gssproxy}</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">728</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="_41-rsync文件" tabindex="-1">41. rsync文件 <a class="header-anchor" href="#_41-rsync文件" aria-hidden="true">#</a></h2><p>rsync [OPTION]... SRC [SRC]... DEST<br> 在指定复制源时，路径是否有最后的 “/” 有不同的含义，例如：<br> /data ：表示将整个 /data 目录复制到目标目录<br> /data/ ：表示将 /data/ 目录中的所有内容复制到目标目录<br><code>--stats</code> : 输出文件传输的状态<br><code>--progress</code> : 输出文件传输的进度<br><code>-a</code>归档模式, 递归且保留符号链接，保留权限信息，时间戳，以及owner,group信息<br><code>-z</code> 打开压缩功能<br><code>-v</code> verbose更多打印信息<br> 本地同步</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rsync -azv /var/opt/installation/inventory/ /root/temp/</span></span>
<span class="line"></span></code></pre></div><p>从本地到远端</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">rsync -avz /root/temp/ thegeekstuff@192.168.200.10:/home/thegeekstuff/temp/</span></span>
<span class="line"></span></code></pre></div><h2 id="_42-查询的动态库链接信息" tabindex="-1">42. 查询的动态库链接信息 <a class="header-anchor" href="#_42-查询的动态库链接信息" aria-hidden="true">#</a></h2><p>查询python这个程序依赖的所有动态库</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ldd </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">which python</span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#A6ACCD;">	linux-vdso.so.1 =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x00007fffb1fb4000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	libpython2.7.so.1.0 =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /lib64/libpython2.7.so.1.0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x00007f5dee201000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	libpthread.so.0 =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /lib64/libpthread.so.0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x00007f5dedfe5000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	libdl.so.2 =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /lib64/libdl.so.2 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x00007f5dedde0000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	libutil.so.1 =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /lib64/libutil.so.1 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x00007f5dedbdd000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	libm.so.6 =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /lib64/libm.so.6 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x00007f5ded8db000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	libc.so.6 =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /lib64/libc.so.6 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x00007f5ded517000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	/lib64/ld-linux-x86-64.so.2 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0000561b940b0000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@linux /tmp/new_folder</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"></span></code></pre></div><h2 id="_43-查询ascii编码表" tabindex="-1">43. 查询ascii编码表 <a class="header-anchor" href="#_43-查询ascii编码表" aria-hidden="true">#</a></h2><p>速查编码信息</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">man ascii</span></span>
<span class="line"></span></code></pre></div><h2 id="_44-iptable-内置防火墙" tabindex="-1">44. iptable 内置防火墙 <a class="header-anchor" href="#_44-iptable-内置防火墙" aria-hidden="true">#</a></h2><p>iptables内置了4个表，即raw表、filter表、nat表和mangle表，默认操作filter表.</p><p>规则表之间的优先顺序如下：</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">     Raw      --&gt;    mangle       -&gt;        nat    --&gt;      filter</span></span>
<span class="line"><span style="color:#A6ACCD;">prerouting          prerouting          prerouting        input</span></span>
<span class="line"><span style="color:#A6ACCD;">output              postrouting         postrouting       output</span></span>
<span class="line"><span style="color:#A6ACCD;">                    input               output            forward</span></span>
<span class="line"><span style="color:#A6ACCD;">                    output</span></span>
<span class="line"><span style="color:#A6ACCD;">                    forward</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>查询表中的规则,当时打印匹配该规则的包和字节数</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -nvL</span></span>
<span class="line"></span></code></pre></div><p><code>REJECT</code> 拦阻该数据包，并返回数据包通知对方，可以返回的数据包有几个选择：ICMP port-unreachable、ICMP echo-reply 或是tcp-reset（这个数据包包会要求对方关闭联机），进行完此处理动作后，将不再比对其它规则，直接中断过滤程序。 范例如下：</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -A  INPUT -p TCP --dport 22 -j REJECT --reject-with ICMP echo-reply</span></span>
<span class="line"></span></code></pre></div><p><code>DROP</code> 丢弃数据包不予处理，进行完此处理动作后，将不再比对其它规则，直接中断过滤程序。 <code>REDIRECT</code> 将封包重新导向到另一个端口（PNAT），进行完此处理动作后，将会继续比对其它规则。这个功能可以用来实作透明代理 或用来保护web 服务器。例如：</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT--to-ports 8081</span></span>
<span class="line"></span></code></pre></div><p><code>MASQUERADE</code> 改写封包来源IP为防火墙的IP，可以指定port 对应的范围，进行完此处理动作后，直接跳往下一个规则链（mangle:postrouting）。这个功能与SNAT略有不同，当进行IP 伪装时，不需指定要伪装成哪个 IP，IP 会从网卡直接读取，当使用拨接连线时，IP 通常是由ISP公司的DHCP服务器指派的，这个时候MASQUERADE特别有用。范例如下：</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -t nat -A POSTROUTING -p TCP -j MASQUERADE --to-ports 21000-31000</span></span>
<span class="line"></span></code></pre></div><p><code>LOG</code> 将数据包相关信息纪录在 /var/log 中，详细位置请查阅 /etc/syslog.conf 配置文件，进行完此处理动作后，将会继续比对其它规则。例如：</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -A INPUT -p tcp -j LOG --log-prefix </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">input packet</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p><code>SNAT</code> 改写封包来源IP为某特定IP或IP范围，可以指定port对应的范围，进行完此处理动作后，将直接跳往下一个规则炼（mangle:postrouting）.范例如下：</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -t nat -A POSTROUTING -p tcp -o eth0 -j SNAT --to-source 192.168.10.15-192.168.10.160:2100-3200</span></span>
<span class="line"></span></code></pre></div><p><code>DNAT</code> 改写数据包包目的地 IP 为某特定 IP 或 IP 范围，可以指定 port 对应的范围，进行完此处理动作后，将会直接跳往下一个规则链（filter:input 或 filter:forward）。范例如下：</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -t nat -A PREROUTING -p tcp -d 15.45.23.67 --dport 80 -j DNAT --to-destination 192.168.10.1-192.168.10.10:80-100</span></span>
<span class="line"></span></code></pre></div><p><code>MIRROR</code> 镜像数据包，也就是将来源 IP与目的地IP对调后，将数据包返回，进行完此处理动作后，将会中断过滤程序。 <code>QUEUE</code> 中断过滤程序，将封包放入队列，交给其它程序处理。透过自行开发的处理程序，可以进行其它应用，例如：计算联机费用.......等。 <code>RETURN</code> 结束在目前规则链中的过滤程序，返回主规则链继续过滤，如果把自订规则炼看成是一个子程序，那么这个动作，就相当于提早结束子程序并返回到主程序中。 <code>MARK</code> 将封包标上某个代号，以便提供作为后续过滤的条件判断依据，进行完此处理动作后，将会继续比对其它规则。范例如下：</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -t mangle -A PREROUTING -p tcp --dport 22 -j MARK --set-mark 22</span></span>
<span class="line"></span></code></pre></div><p>清空iptables规则</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># set ACCEPT for default action</span></span>
<span class="line"><span style="color:#A6ACCD;">iptables -P INPUT ACCEPT</span></span>
<span class="line"><span style="color:#A6ACCD;">iptables -P FORWARD ACCEPT</span></span>
<span class="line"><span style="color:#A6ACCD;">iptables -P OUTPUT ACCEPT</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># flush all chains</span></span>
<span class="line"><span style="color:#A6ACCD;">iptables -F</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># delete all  user-defined chains</span></span>
<span class="line"><span style="color:#A6ACCD;">iptables -X</span></span>
<span class="line"></span></code></pre></div><p>丢弃TCP访问21端口的包</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -A INPUT -p tcp --dport 21 -j DROP</span></span>
<span class="line"></span></code></pre></div><p>加<code>--line-numbers</code>参数可以打印规则序号. 删除时用</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -nvL --line-numbers</span></span>
<span class="line"></span></code></pre></div><p>删除INPUT链里的第三个规则</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iptables -D INPUT 3</span></span>
<span class="line"></span></code></pre></div><p><a href="https://blog.csdn.net/htmlxx/article/details/51412750" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/htmlxx/article/details/51412750</a><br> 这里记录了一些常用的iptables规则操作</p><h2 id="_45-tcpdump-抓包" tabindex="-1">45. tcpdump 抓包 <a class="header-anchor" href="#_45-tcpdump-抓包" aria-hidden="true">#</a></h2><p>常用表达式:<br> 非 : ! or &quot;not&quot; (去掉双引号)<br> 且 : &amp;&amp; or &quot;and&quot;<br> 或 : || or &quot;or&quot;<br><code>-nn</code> 不转换地址和端口号 <code>-v</code> 打印详情</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">tcpdump -i eth0 -nnv</span></span>
<span class="line"></span></code></pre></div><p>抓取所有经过eth1，地址是192.168.1.1且端口号为25的所有包</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">tcpdump -i eth1 host 192.168.1.1 and port 25</span></span>
<span class="line"></span></code></pre></div><p>-c count 抓取指定数目的包后退出</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">tcpdump -i eth0 -c 1000</span></span>
<span class="line"></span></code></pre></div><p>-C file_size 循环抓包,当文件达到指定的大小后,将包写入到新文件.举例如下:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">tcpdump -i eth0 -C 1 -w abc</span></span>
<span class="line"><span style="color:#A6ACCD;">$ ls -rlt abc</span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#A6ACCD;">-rw-r--r--. 1 tcpdump tcpdump 1001078 Jan 14 23:33 abc</span></span>
<span class="line"><span style="color:#A6ACCD;">-rw-r--r--. 1 tcpdump tcpdump  647168 Jan 14 23:33 abc1</span></span>
<span class="line"></span></code></pre></div><p>抓取本机eth0网卡发往公网ip的数据包</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">tcpdump -n -i eth0 </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">not net 10.0.0.0/8 and not net 192.168.0.0/16 and not net 172.16.0.0/12</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><h2 id="_46-dns查询工具" tabindex="-1">46. DNS查询工具 <a class="header-anchor" href="#_46-dns查询工具" aria-hidden="true">#</a></h2><p>指定DNS服务器递归查</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig www.baidu.com @8.8.8.8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#89DDFF;font-style:italic;">&gt;&gt;</span><span style="color:#C3E88D;"> DiG 9.9.4-RedHat-9.9.4-51.el7 &lt;&lt;&gt;&gt; www.baidu.com @8.8.8.8</span></span>
<span class="line"><span style="color:#C3E88D;">;; global options: +cmd</span></span>
<span class="line"><span style="color:#C3E88D;">;; Got answer:</span></span>
<span class="line"><span style="color:#C3E88D;">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 4712</span></span>
<span class="line"><span style="color:#C3E88D;">;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; OPT PSEUDOSECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">; EDNS: version: 0, flags:; udp: 512</span></span>
<span class="line"><span style="color:#C3E88D;">;; QUESTION SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">;www.baidu.com.			IN	A</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">www.baidu.com.		1043	IN	CNAME	www.a.shifen.com.</span></span>
<span class="line"><span style="color:#C3E88D;">www.a.shifen.com.	218	IN	A	220.181.112.244</span></span>
<span class="line"><span style="color:#C3E88D;">www.a.shifen.com.	218	IN	A	220.181.111.188</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; Query time: 78 msec</span></span>
<span class="line"><span style="color:#C3E88D;">;; SERVER: 8.8.8.8#53(8.8.8.8)</span></span>
<span class="line"><span style="color:#C3E88D;">;; WHEN: Mon Jan 15 00:03:09 HKT 2018</span></span>
<span class="line"><span style="color:#C3E88D;">;; MSG SIZE  rcvd: 101</span></span>
<span class="line"></span></code></pre></div><p>反解析</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig -x 74.125.135.105</span></span>
<span class="line"><span style="color:#89DDFF;">;;</span><span style="color:#A6ACCD;"> QUESTION SECTION:</span></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">105.135.125.74.in-addr.arpa.   IN      PTR</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">;;</span><span style="color:#A6ACCD;"> ANSWER SECTION:</span></span>
<span class="line"><span style="color:#A6ACCD;">105.135.125.74.in-addr.arpa. 83205 IN   PTR     ni-in-f105.1e100.net.</span></span>
<span class="line"></span></code></pre></div><p>全过程迭代跟踪</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">dig +trace www.baidu.com</span></span>
<span class="line"></span></code></pre></div><h2 id="_47-ntp时间同步" tabindex="-1">47. NTP时间同步 <a class="header-anchor" href="#_47-ntp时间同步" aria-hidden="true">#</a></h2><p>ntpdate 手工校准时间, 加 <code>-q</code> 只查询, 不同步时间, 加 <code>-d</code> 打开Debug模式, 但不真正更新时间</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ntpdate ntp1.aliyun.com</span></span>
<span class="line"><span style="color:#A6ACCD;">15 Jan 23:18:51 ntpdate</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">18981</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: adjust </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> server 182.92.12.11 offset 0.000643 sec</span></span>
<span class="line"></span></code></pre></div><p>安装<code>ntpd</code>时查询ntp同步状态的命令为<code>ntpq -p</code><br> 如果使用<code>chronyd</code>(centos7默认)是命令为<code>chronyc sources -v</code></p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ chronyc sources -v</span></span>
<span class="line"><span style="color:#A6ACCD;">210 Number of sources = 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  .-- Source mode  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">^</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = server, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = peer, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = </span><span style="color:#C792EA;">local</span><span style="color:#A6ACCD;"> clock.</span></span>
<span class="line"><span style="color:#A6ACCD;"> / .- Source state </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = current synced, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">+</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = combined , </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = not combined,</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> /   </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">?</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = unreachable, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">x</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> may be </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> error, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">~</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> too variable.</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">                                                 .- xxxx </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> yyyy </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> +/- zzzz</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">      Reachability register </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">octal</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> -.           </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">  xxxx = adjusted offset,</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">      Log2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Polling interval</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> --.      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">  yyyy = measured offset,</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">                                \     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">  zzzz = estimated error.</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">                                 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">           \</span></span>
<span class="line"><span style="color:#A6ACCD;">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span></span>
<span class="line"><span style="color:#A6ACCD;">===============================================================================</span></span>
<span class="line"><span style="color:#A6ACCD;">^</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> time5.aliyun.com              2   6    37    41  +2394ns</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">+1057us</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> +/-   15ms</span></span>
<span class="line"><span style="color:#A6ACCD;">^- 120.25.115.19                 2   6    37    40  -2559us</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">-2559us</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> +/-   67ms</span></span>
<span class="line"></span></code></pre></div><h2 id="_48-netstat查询网络连接信息" tabindex="-1">48. netstat查询网络连接信息 <a class="header-anchor" href="#_48-netstat查询网络连接信息" aria-hidden="true">#</a></h2><p>查看所有tcp下监听端口, p表示打印相应的进程</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">netstat -lntp</span></span>
<span class="line"></span></code></pre></div><p>查看所有已经建立的连接</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">netstat -antp</span></span>
<span class="line"></span></code></pre></div><p>查看路由表</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">netstat -rn</span></span>
<span class="line"></span></code></pre></div><p>查看网络统计信息进程</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">netstat -s</span></span>
<span class="line"></span></code></pre></div><h2 id="_49-ethtool-网卡查询工具" tabindex="-1">49. ethtool 网卡查询工具 <a class="header-anchor" href="#_49-ethtool-网卡查询工具" aria-hidden="true">#</a></h2><p><code>-i</code> 查网卡驱动信息</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ethtool -i  eth0</span></span>
<span class="line"><span style="color:#A6ACCD;">driver: virtio_net</span></span>
<span class="line"><span style="color:#A6ACCD;">version: 1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">firmware-version:</span></span>
<span class="line"><span style="color:#A6ACCD;">expansion-rom-version:</span></span>
<span class="line"><span style="color:#A6ACCD;">bus-info: 0000:00:05.0</span></span>
<span class="line"><span style="color:#A6ACCD;">supports-statistics: no</span></span>
<span class="line"><span style="color:#A6ACCD;">supports-test: no</span></span>
<span class="line"><span style="color:#A6ACCD;">supports-eeprom-access: no</span></span>
<span class="line"><span style="color:#A6ACCD;">supports-register-dump: no</span></span>
<span class="line"><span style="color:#A6ACCD;">supports-priv-flags: no</span></span>
<span class="line"></span></code></pre></div><p>不跟参数,显示速率,全双工模式等信息(虚拟机下没有)<br> Link 为<code>yes</code>表示 网线连接正常</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ethtool eth0</span></span>
<span class="line"><span style="color:#A6ACCD;">Settings </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> eth0:</span></span>
<span class="line"><span style="color:#A6ACCD;">	Link detected: yes</span></span>
<span class="line"></span></code></pre></div><h2 id="_50-ip-网络维护" tabindex="-1">50. ip 网络维护 <a class="header-anchor" href="#_50-ip-网络维护" aria-hidden="true">#</a></h2><p>启用接口</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip link set &lt;接口名&gt; up</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>禁用接口</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip link set &lt;接口名&gt; down</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>设置接口MAC地址（设置前请先禁用接口）</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip link set &lt;接口名&gt; address &lt;值&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>设置接口MTU（设置前请先禁用接口） 例：把ens33的MTU改成9000并检查。</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># ip link show dev ens33 #修改前</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">2: ens33: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast state DOWN mode DEFAULT qlen 1000</span></span>
<span class="line"><span style="color:#A6ACCD;">    link/ether 88:32:9b:ca:3f:49 brd ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#A6ACCD;"># ip link set ens33 mtu 9000</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># ip link show dev ens33  #修改后</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">2: ens33: &lt;BROADCAST,MULTICAST&gt; mtu 9000 qdisc pfifo_fast state DOWN mode DEFAULT qlen 1000</span></span>
<span class="line"><span style="color:#A6ACCD;">    link/ether 88:32:9b:ca:3f:49 brd ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>查看网卡的详细信息, 比如是bridge还是veth等类型</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip --details link</span></span>
<span class="line"><span style="color:#A6ACCD;">ip link  show </span><span style="color:#82AAFF;">type</span><span style="color:#A6ACCD;"> bridge  </span><span style="color:#676E95;font-style:italic;">#显示所有的桥接设备</span></span>
<span class="line"></span></code></pre></div><p>下面脚本可以显示每个链路的类型, 除了以太网</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Arguments: $1: Interface (&#39;grep&#39;-regexp).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Static list of types (from `ip link help`):</span></span>
<span class="line"><span style="color:#A6ACCD;">TYPES=</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">bond bond_slave bridge dummy gre gretap ifb ip6gre ip6gretap ip6tnl ipip ipoib ipvlan macvlan macvtap nlmon sit vcan veth vlan vti vxlan tun tap</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">iface=</span><span style="color:#89DDFF;">&quot;$</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> type </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;${</span><span style="color:#A6ACCD;">TYPES</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">@</span><span style="color:#89DDFF;">]}&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">  ip link show </span><span style="color:#82AAFF;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;${</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">}&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> grep -E </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">^[0-9]+:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> cut -d </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> -f 2 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> sed </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">s|^[[:space:]]*||</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">read</span><span style="color:#A6ACCD;"> _if</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;${</span><span style="color:#A6ACCD;">_if</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">}&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">done</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> grep </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">iface</span><span style="color:#89DDFF;">}&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"></span></code></pre></div><p>查看网卡状态和对应的IP信息</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip addr</span></span>
<span class="line"></span></code></pre></div><p>给接口eth0赋予地址10.211.55.10 掩码是255.255.255.0(24代表掩码中1的个数)，广播地址是10.211.55.255</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip addr add 10.211.55.10/24 dev eth0</span></span>
<span class="line"></span></code></pre></div><p>删除eth0上的 10.211.55.10</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip addr del 10.211.55.10/24 dev eth0</span></span>
<span class="line"></span></code></pre></div><p>查看路由表信息</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ip route</span></span>
<span class="line"><span style="color:#A6ACCD;">default via 10.211.55.1 dev eth0</span></span>
<span class="line"><span style="color:#A6ACCD;">10.211.55.0/24 dev eth0 proto kernel scope link src 10.211.55.9</span></span>
<span class="line"><span style="color:#A6ACCD;">192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1</span></span>
<span class="line"></span></code></pre></div><p>查询目的地为<code>192.168.1.1</code>时选择的路由情况</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ip route get 192.168.1.1</span></span>
<span class="line"><span style="color:#A6ACCD;">192.168.1.1 via 10.211.55.1 dev eth0 src 10.211.55.9</span></span>
<span class="line"><span style="color:#A6ACCD;">    cache</span></span>
<span class="line"></span></code></pre></div><p>增加默认路由</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip route add default via 20.0.0.1</span></span>
<span class="line"></span></code></pre></div><p>策略性路由相对于传统的路由算法主要是引入了多路由表以及规则的概念。<br> 例如一个子网通过一个路由器与外界相连，路由器与外界有两条线路相连，其中一条的速度比较快，一条的速度比较慢。对于子网内的大多数用户来说对速度并没有特殊的要求，所以可以让他们用比较慢的路由；但是子网内有一些特殊的用户却是对速度的要求比较苛刻，所以他们需要使用速度比较快的路由。如果使用一张路由表上述要求是无法实现的，而如果根据源地址或其它参数，对不同的用户使用不同的路由表，这样就可以大大提高路由器的性能。<br> 优先级别越高的规则越先匹配（数值越小优先级别越高）。</p><p>系统内置3张表:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">表255 本地路由表（Local table）本地接口地址，广播地址，已及NAT地址都放在这个表。该路由表由系统自动维护，管理员不能直接修改。</span></span>
<span class="line"><span style="color:#A6ACCD;">表254 主路由表（Main table）如果没有指明路由所属的表，所有的路由都默认都放在这个表里，route）所添加的路由都会加到这个表。</span></span>
<span class="line"><span style="color:#A6ACCD;">表253 默认路由表（Default table）一般来说默认的路由都放在这张表，但是如果特别指明放的也可以是所有的网关路由。</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>查看路由规则, <code>32766</code>表示优先级, 越小优先级越高.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ip rule list</span></span>
<span class="line"><span style="color:#A6ACCD;">0:	from all lookup </span><span style="color:#C792EA;">local</span></span>
<span class="line"><span style="color:#A6ACCD;">32766:	from all lookup main</span></span>
<span class="line"><span style="color:#A6ACCD;">32767:	from all lookup default</span></span>
<span class="line"></span></code></pre></div><p>创建一个新的路由表, 原地址为<code>192.168.2.0/24</code>的消息全部路由到这张表里</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">250 test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> /etc/iproute2/rt_tables</span></span>
<span class="line"><span style="color:#A6ACCD;">$ ip rule add from 192.168.2.0/24 table </span><span style="color:#82AAFF;">test</span></span>
<span class="line"></span></code></pre></div><p>上面的配置如果要持久化, 可以将命令写入<code>/etc/rc.d/rc.local</code>, 并给该文件可执行权限. <code>chmod +x /etc/rc.d/rc.local</code></p><p>查看某一张表里的路由信息</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ip route list table main</span></span>
<span class="line"></span></code></pre></div><p>规则匹配的对象是所有的数据包，动作是选用路由表1的路由，这条规则的优先级是32800</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ip rule add from 0/0 table 1 pref 32800</span></span>
<span class="line"></span></code></pre></div><p>规则匹配的对象是IP为192.168.3.112，tos等于0x10的包，使用路由表2，这条规则的优先级是1500</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip rule add from 192.168.3.112/32 </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">tos 0x10</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> table ２ pref 1500</span></span>
<span class="line"></span></code></pre></div><p>在table test里添加一条默认路由</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ip route add default via 182.169.1.1 table </span><span style="color:#82AAFF;">test</span></span>
<span class="line"></span></code></pre></div><p>上面的规则是以源地址为关键字，作为是否匹配的依据的。除了源地址外，还可以用以下的信息：</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">from -- 源地址</span></span>
<span class="line"><span style="color:#A6ACCD;">to -- 目的地址（这里是选择规则时使用，查找路由表时也使用）</span></span>
<span class="line"><span style="color:#A6ACCD;">tos -- IP包头的TOS（type of sevice）域</span></span>
<span class="line"><span style="color:#A6ACCD;">dev -- 物理接口</span></span>
<span class="line"><span style="color:#A6ACCD;">fwmark -- 防火墙参数</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>采取的动作除了指定表，还可以指定下面的动作：</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">Table 指明所使用的表</span></span>
<span class="line"><span style="color:#A6ACCD;">Nat 透明网关</span></span>
<span class="line"><span style="color:#A6ACCD;">Action prohibit 丢弃该包，并发送 COMM.ADM.PROHIITED的ICMP信息</span></span>
<span class="line"><span style="color:#A6ACCD;">Reject 单纯丢弃该包</span></span>
<span class="line"><span style="color:#A6ACCD;">Unreachable丢弃该包，并发送 NET UNREACHABLE的ICMP信息</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>实际场景中尽量使用<code>ip rule to xxxx table xxx</code>针对目的IP指定路由表. 这样无论是收到请求后回复,或者主动发起请求都能匹配</p><p>具体的语法可参考<code>man ip-rule</code>和<code>man ip-route</code><br><a href="https://www.redhat.com/sysadmin/beginners-guide-network-troubleshooting-linux" target="_blank" rel="noopener noreferrer">https://www.redhat.com/sysadmin/beginners-guide-network-troubleshooting-linux</a><br><a href="http://www.microhowto.info/troubleshooting/troubleshooting_the_routing_table.html" target="_blank" rel="noopener noreferrer">http://www.microhowto.info/troubleshooting/troubleshooting_the_routing_table.html</a></p><p>ip netns操作<br><a href="https://www.cnblogs.com/sparkdev/p/9253409.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/sparkdev/p/9253409.html</a></p><h2 id="_51-who-查看当前登录用户" tabindex="-1">51. who 查看当前登录用户 <a class="header-anchor" href="#_51-who-查看当前登录用户" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ who</span></span>
<span class="line"><span style="color:#A6ACCD;">root     pts/0        2018-01-17 22:28 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">10.211.55.2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="_52-使用iftop查看主机实时网络流量" tabindex="-1">52. 使用iftop查看主机实时网络流量 <a class="header-anchor" href="#_52-使用iftop查看主机实时网络流量" aria-hidden="true">#</a></h2><p>类似top这样的交互式界面<br> 监控网卡的实时流量,反向解析IP,同时还显示具体每个连接接受和发送的流量<br> 注意显示流量的单位为b. 例如 <code>8Mb = 1MB</code>. 所有流量值都是 per second<br> 按<code>n</code>关闭主机名解析, 按<code>N</code>关闭端口号解析, 按<code>p</code>显示连接的端口号<br><code>iftop -f &quot;port 22&quot;</code>过滤只显示端口为22的连接的流量信息, 过滤语法跟<code>tcpdump</code>一样<br> 直接运行<code>iftop</code>, 得到如下信息:</p><blockquote><p>第一行类似刻度尺的刻度，为显示流量图形的长条作标尺用的。<br> &lt;= =&gt;这两个左右箭头，表示的是流量的方向。<br> TX：发送流量<br> RX：接收流量<br> TOTAL：总流量<br> Cumm：运行iftop到目前时间的总流量<br> peak：流量峰值<br> rates：分别表示过去 2s 10s 40s 的平均流量</p></blockquote><p><img src="/img/iftop.png" alt="iftop交互图"></p><h2 id="_53-bash相关环境变量" tabindex="-1">53. Bash相关环境变量 <a class="header-anchor" href="#_53-bash相关环境变量" aria-hidden="true">#</a></h2><p>历史信息显示时间格式<br> 如下设置后, 使用<code>history</code>就会显示具体命令的具体执行时间.<br> 可以直接将其写在 .bashrc文件里</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">HISTTIMEFORMAT=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%d/%m/%y %T </span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>PS1变量 设置登录提示符, 如下带颜色显示当前用户, 主机名和当前目录的绝对路径.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">PS1=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[\e[1;31m\u@\h \e[0;34m</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">PWD</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">\e[0m]</span><span style="color:#A6ACCD;">\\</span><span style="color:#C3E88D;">$ </span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h2 id="_54-查本机的公网ip" tabindex="-1">54. 查本机的公网IP <a class="header-anchor" href="#_54-查本机的公网ip" aria-hidden="true">#</a></h2><p>通常我们的主机都在内网, 访问互联网是都是换成公网IP后去连接的<br> 如下是查询我们主机的公网IP</p><ol><li>打开百度 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a></li><li>输出两个字符 <code>ip</code>, 敲回车</li><li>新页面显示的本机IP就是公网IP</li></ol><h2 id="_55-查询linux系统的一些限制信息" tabindex="-1">55. 查询linux系统的一些限制信息 <a class="header-anchor" href="#_55-查询linux系统的一些限制信息" aria-hidden="true">#</a></h2><p>如下文章详细列举了redhat/centos各版本操作系统的重要限制信息.<br> 比如ext4限制, 最大cpu, 最大Memory<br><a href="https://access.redhat.com/articles/rhel-limits" target="_blank" rel="noopener noreferrer">https://access.redhat.com/articles/rhel-limits</a></p><h2 id="_56-判断虚拟化类型的n种方法" tabindex="-1">56. 判断虚拟化类型的N种方法 <a class="header-anchor" href="#_56-判断虚拟化类型的n种方法" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dmidecode -s system-manufacturer</span></span>
<span class="line"><span style="color:#A6ACCD;">OpenStack Foundation</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ systemd-detect-virt</span></span>
<span class="line"><span style="color:#A6ACCD;">kvm</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ virt-what</span></span>
<span class="line"><span style="color:#A6ACCD;">kvm</span></span>
<span class="line"></span></code></pre></div><h2 id="_57-cpu信息解读" tabindex="-1">57. cpu信息解读 <a class="header-anchor" href="#_57-cpu信息解读" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ lscpu</span></span>
<span class="line"><span style="color:#A6ACCD;">Architecture:          x86_64              // 架构 </span></span>
<span class="line"><span style="color:#A6ACCD;">CPU op-mode</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:        32-bit, 64-bit      // 位数</span></span>
<span class="line"><span style="color:#A6ACCD;">Byte Order:            Little Endian       // 小端</span></span>
<span class="line"><span style="color:#A6ACCD;">CPU</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:                2                   // 逻辑cpu数</span></span>
<span class="line"><span style="color:#A6ACCD;">On-line CPU</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> list:   0,1</span></span>
<span class="line"><span style="color:#A6ACCD;">Thread</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> per core:    1                   // 一个核有一个线程. </span></span>
<span class="line"><span style="color:#A6ACCD;">Core</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> per socket:    2                   // 一个插槽有两个核</span></span>
<span class="line"><span style="color:#A6ACCD;">Socket</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:             1                   // 总共一个插槽</span></span>
<span class="line"><span style="color:#A6ACCD;">NUMA node</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:          1</span></span>
<span class="line"><span style="color:#A6ACCD;">Vendor ID:             GenuineIntel</span></span>
<span class="line"><span style="color:#A6ACCD;">CPU family:            6</span></span>
<span class="line"><span style="color:#A6ACCD;">Model:                 69</span></span>
<span class="line"><span style="color:#A6ACCD;">Model name:            Intel</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> Core</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">TM</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> i5-4260U CPU @ 1.40GHz</span></span>
<span class="line"><span style="color:#A6ACCD;">Stepping:              1</span></span>
<span class="line"><span style="color:#A6ACCD;">CPU MHz:               2000.000</span></span>
<span class="line"><span style="color:#A6ACCD;">BogoMIPS:              4000.00</span></span>
<span class="line"><span style="color:#A6ACCD;">Hypervisor vendor:     KVM                 // 虚拟化类型</span></span>
<span class="line"><span style="color:#A6ACCD;">Virtualization type:   full                // 全虚拟化</span></span>
<span class="line"><span style="color:#A6ACCD;">L1d cache:             32K</span></span>
<span class="line"><span style="color:#A6ACCD;">L1i cache:             32K</span></span>
<span class="line"><span style="color:#A6ACCD;">L2 cache:              256K</span></span>
<span class="line"><span style="color:#A6ACCD;">L3 cache:              3072K</span></span>
<span class="line"><span style="color:#A6ACCD;">NUMA node0 CPU</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:     0,1</span></span>
<span class="line"><span style="color:#A6ACCD;">............</span></span>
<span class="line"></span></code></pre></div><h2 id="_58-taskset指定进程的cpu亲和性" tabindex="-1">58. taskset指定进程的CPU亲和性 <a class="header-anchor" href="#_58-taskset指定进程的cpu亲和性" aria-hidden="true">#</a></h2><p>返回的mask为十六进制, 3 代表 0x11 即绑定在cpu 0 和 1 上面. 最低位代表第一个cpu<br> taskset -p pid 返回pid对应进程当前的亲和性</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ taskset -p 691</span></span>
<span class="line"><span style="color:#A6ACCD;">pid 691</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">s current affinity mask: 3</span></span>
<span class="line"></span></code></pre></div><p><code>taskset -p mask pid</code>设置进程的cpu亲和性<br> 也可以使用数字代替mask, 比如 <code>taskset -c 0,1 -p 1</code> 表示为pid为1的进程绑定cpu0和1</p><p><code>taskset 1 ls</code> 执行ls命令是直接绑定到cpu0上.</p><p><code>/proc/[pid]/status</code>也可以查询, 举例:</p><blockquote><p>Cpus_allowed: 3<br> Cpus_allowed_list: 0-1<br> 解释:<br> Cpus_allowed:3指出该进程可以使用CPU的亲和性掩码,因为我们指定为两块CPU,所以这里就是3,如果该进程指定为4个CPU(如果有话),这里就是F(1111).<br> Cpus_allowed_list:0-1指出该进程可以使用CPU的列表,这里是0-1.</p></blockquote><p>进程运行时设置的亲和性并不影响其他线程, 如果要对java这样的多线程设置, 需要ps -efL 找到所有线程, 然后逐一设置<br><code>taskset 1 java</code>启动java命令时的绑定, 会应用到所有线程, 因为cpu的亲和性具有继承性</p><h2 id="_59-linux系统最大文件数量" tabindex="-1">59. Linux系统最大文件数量 <a class="header-anchor" href="#_59-linux系统最大文件数量" aria-hidden="true">#</a></h2><p><code>ulimit -n</code>返回当前user单进程可打开的最大进程数<br><code>/proc/[pid]/limits</code> 查询该进程的资源限制数据<br><code>ls -rlt /proc/[pid]/fd | wc -l</code> 查询该进程当前已打开的文件数<br><code>lsof -p [pid] | wc -l </code> 也可查询, 但要过滤掉cwd, 动态库等<br><code>ulimit -n unlimited</code>是无效的, 进程级的文件句柄不支持<code>unlimited</code>, 最大值为 <code>/proc/sys/fs/nr_open</code>, 该值默认为1048576.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># ulimit -n 1048577</span></span>
<span class="line"><span style="color:#A6ACCD;">-bash: ulimit: op]en files: cannot modify limit: Operation not permitted</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ulimit -n unlimited</span></span>
<span class="line"><span style="color:#A6ACCD;">-bash: ulimit: open files: cannot modify limit: Operation not permitted</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># cat /proc/sys/fs/nr_open</span></span>
<span class="line"><span style="color:#A6ACCD;">1048576</span></span>
<span class="line"></span></code></pre></div><p>在centos7上<code>nr_open</code>的最大值可调整为2147483584</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># sysctl -w fs.nr_open=2147483585</span></span>
<span class="line"><span style="color:#A6ACCD;">sysctl: setting key </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fs.nr_open</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: Invalid argument</span></span>
<span class="line"><span style="color:#A6ACCD;">fs.nr_open = 2147483585</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># sysctl -w fs.nr_open=2147483584</span></span>
<span class="line"><span style="color:#A6ACCD;">fs.nr_open = 2147483584</span></span>
<span class="line"></span></code></pre></div><p>查询整个OS当前的文件数使用情况:<br> file-max显示所有进程的最大文件数, 可通过<code>echo 100000 &gt; /proc/sys/fs/file-max</code>提高</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ cat /proc/sys/fs/file-max</span></span>
<span class="line"><span style="color:#A6ACCD;">97703</span></span>
<span class="line"></span></code></pre></div><p>file-nr是只读的, 第一个字段代表已分配(即已打开)文件数, 第二个字段从2.6开始一直为0, 第三个字段等于file-max</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ cat /proc/sys/fs/file-nr</span></span>
<span class="line"><span style="color:#A6ACCD;">1344	0	97703</span></span>
<span class="line"></span></code></pre></div><p>列出每个进程的已打开的文件数, 用于找到当前哪个进程占用最多文件数<br><code>-d</code> 用于排除cwd, 动态库之类的信息<br><code>-n</code> 不用协议解析, 加快命令运行速度<br><code>lsof -n -d0-999999 | awk &#39;{print $2}&#39; | sort | uniq -c | sort -k1 -n</code></p><h2 id="_60-ss-查询socket连接信息" tabindex="-1">60. ss 查询socket连接信息 <a class="header-anchor" href="#_60-ss-查询socket连接信息" aria-hidden="true">#</a></h2><p>类似于<code>netstat</code>, 使用了netlink, 性能更好</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ss -s                </span><span style="color:#676E95;font-style:italic;">#显示各socket的统计信息</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -ntlp             </span><span style="color:#676E95;font-style:italic;">#-n 不解析, -t 显示tcp连接  -l 显示监听socket, -p 显示使用的进程名</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -t -a             </span><span style="color:#676E95;font-style:italic;">#查看所有tcp连接, 不带-a则指显示 Established 连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -to               </span><span style="color:#676E95;font-style:italic;">#查看tcp的keepalive信息</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -ti               </span><span style="color:#676E95;font-style:italic;">#查看tcp的内部信息,比如拥塞算法,rto,rtt,cwnd,ssthresh等</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tm               </span><span style="color:#676E95;font-style:italic;">#查看tcp的内存使用信息, 比如收发缓冲区的大小</span></span>
<span class="line"></span></code></pre></div><p>还有一些高级的过滤用法</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ss  -A raw,packet_raw  -a -p                             </span><span style="color:#676E95;font-style:italic;">#查看raw socket的信息</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tn  state listening                                  </span><span style="color:#676E95;font-style:italic;">#显示处于listening状态的连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tn  state established                                </span><span style="color:#676E95;font-style:italic;">#显示处于established状态的连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tn  state listening  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">( sport == 22 )</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">               </span><span style="color:#676E95;font-style:italic;">#显示处于listening状态且源端口为22的连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tn </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">( sport == 22 )</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">                                 </span><span style="color:#676E95;font-style:italic;">#显示源端口为22的连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tn </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">( sport != 22 )</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">                                 </span><span style="color:#676E95;font-style:italic;">#显示源端口不为22的连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tn </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">( sport == 22 || dport == 22 )</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">                  </span><span style="color:#676E95;font-style:italic;">#显示源端口为22或者目标端口为22的连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tn </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">( dst 10.211.55.2 &amp;&amp; dport == 58181 )</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">           </span><span style="color:#676E95;font-style:italic;">#显示目标ip为10.211.55.2且目标端口为58181的连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tn </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">( src 127.0.0.1 )</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">                               </span><span style="color:#676E95;font-style:italic;">#显示源ip为 127.0.0.1的连接</span></span>
<span class="line"><span style="color:#A6ACCD;">ss -tn </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">( ! dst 10.211.55.2 &amp;&amp; dport != 58181 )</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;">#显示目标ip不是10.211.55.2且目标端口不是58181的连接</span></span>
<span class="line"></span></code></pre></div><p>state后面支持的TCP状态如下:</p><div class="language-c"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">char</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sstate_namel</span><span style="color:#C792EA;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UNKNOWN</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_ESTABLISHED</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">established</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_SYN_SENT</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">syn-sent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_SYN_RECV</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">syn-recv</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_FIN_WAIT1</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fin-wait-1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_FIN_WAIT2</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fin-wait-2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_TIME_WAIT</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">time-wait</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_CLOSE</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">unconnected</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_CLOSE_WAIT</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">close-wait</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_LAST_ACK</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">last-ack</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_LISTEN</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">listening</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">SS_CLOSING</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">closing</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>更多使用介绍请参考:<br><a href="https://www.cyberciti.biz/tips/linux-investigate-sockets-network-connections.html" target="_blank" rel="noopener noreferrer">https://www.cyberciti.biz/tips/linux-investigate-sockets-network-connections.html</a><br><a href="https://man7.org/linux/man-pages/man8/ss.8.html" target="_blank" rel="noopener noreferrer">https://man7.org/linux/man-pages/man8/ss.8.html</a><br><a href="https://github.com/shemminger/iproute2/blob/main/misc/ssfilter.y" target="_blank" rel="noopener noreferrer">https://github.com/shemminger/iproute2/blob/main/misc/ssfilter.y</a></p><h2 id="_61-消除用户被锁的错误登录记录" tabindex="-1">61. 消除用户被锁的错误登录记录 <a class="header-anchor" href="#_61-消除用户被锁的错误登录记录" aria-hidden="true">#</a></h2><p>通常管理员会配置pam_faillock或者pam_tally2, 当用户使用错误密码满足一定条件, 就将用户锁定一段时间. 如下是即时清除错误记录的命令</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">faillock --reset</span></span>
<span class="line"><span style="color:#A6ACCD;">pam_tally2 -r -u </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">username</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><h2 id="_62-估计rss总和的大小" tabindex="-1">62. 估计RSS总和的大小 <a class="header-anchor" href="#_62-估计rss总和的大小" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ps aux </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> awk </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{sum+=$6} END {print sum / 1024}</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>如下脚本也可以:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ cat rss.sh</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#/bin/bash</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> PROC </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">ls  /proc/</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">grep </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^[0-9]</span><span style="color:#89DDFF;">&quot;`</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-f</span><span style="color:#A6ACCD;"> /proc/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">PROC/statm </span><span style="color:#89DDFF;">];</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">      TEP=</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">cat /proc/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">PROC</span><span style="color:#C3E88D;">/statm </span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;"> awk </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{print ($2)}</span><span style="color:#89DDFF;">&#39;`</span></span>
<span class="line"><span style="color:#A6ACCD;">      RSS=</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">expr </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">RSS</span><span style="color:#C3E88D;"> + </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">TEP</span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"><span style="color:#A6ACCD;">RSS=</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">expr </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">RSS</span><span style="color:#C3E88D;"> </span><span style="color:#A6ACCD;">\*</span><span style="color:#C3E88D;"> 4</span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">RSS</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">KB</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h2 id="_63-文件系统修复" tabindex="-1">63. 文件系统修复 <a class="header-anchor" href="#_63-文件系统修复" aria-hidden="true">#</a></h2><p>针对xfs, 使用<code>xfs_repair</code>命令:<br><code>-n</code> 表示不修复, 只扫描并显示错误</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">xfs_repair -n -v /dev/mapper/vg-home</span></span>
<span class="line"></span></code></pre></div><p>不带<code>-n</code>, 执行修复. <code>-v</code>表示显示详情</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">xfs_repair -v /dev/mapper/vg-home</span></span>
<span class="line"></span></code></pre></div><p>最后方法：损失部分数据的修复方法<br> 根据打印消息，修复失败时：<br> 先执行xfs_repair -L /dev/sdd(清空日志，会丢失文件)，再执行xfs_repair /dev/sdd，再执行xfs_check /dev/sdd 检查文件系统是否修复成功。</p><blockquote><p>-L是修复xfs文件系统的最后手段，慎重选择，它会清空日志，会丢失用户数据和文件。</p></blockquote><h2 id="_64-非交互式修改密码" tabindex="-1">64. 非交互式修改密码 <a class="header-anchor" href="#_64-非交互式修改密码" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Linux@123</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">passwd --stdin root</span></span>
<span class="line"></span></code></pre></div><h2 id="_66-udev管理" tabindex="-1">66. udev管理 <a class="header-anchor" href="#_66-udev管理" aria-hidden="true">#</a></h2><p>查询设备的信息, 主要是环境变量</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">udevadm info /dev/sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">P: /devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda/sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">N: sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">S: disk/by-id/ata-CentOS_Linux-0_SSD_FFACPKN8NC9MK3EX3N4R-part1</span></span>
<span class="line"><span style="color:#A6ACCD;">S: disk/by-uuid/5de1c8df-9b03-4830-9b56-b96a2290b78f</span></span>
<span class="line"><span style="color:#A6ACCD;">E: DEVLINKS=/dev/disk/by-id/ata-CentOS_Linux-0_SSD_FFACPKN8NC9MK3EX3N4R-part1 /dev/disk/by-uuid/5de1c8df-9b03-4830-9b56-b96a2290b78f</span></span>
<span class="line"><span style="color:#A6ACCD;">E: DEVNAME=/dev/sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">E: DEVPATH=/devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda/sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">E: DEVTYPE=partition</span></span>
<span class="line"><span style="color:#A6ACCD;">E: ID_ATA=1</span></span>
<span class="line"><span style="color:#A6ACCD;">E: ID_ATA_ROTATION_RATE_RPM=0</span></span>
<span class="line"><span style="color:#A6ACCD;">E: ID_ATA_SATA=1</span></span>
<span class="line"><span style="color:#A6ACCD;">E: ID_ATA_SATA_SIGNAL_RATE_GEN1=1</span></span>
<span class="line"></span></code></pre></div><p>加参数<code>-a</code>, 主要是设备的属性.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">udevadm info -a /dev/sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">P: /devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda/sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">N: sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">S: disk/by-id/ata-CentOS_Linux-0_SSD_FFACPKN8NC9MK3EX3N4R-part1</span></span>
<span class="line"><span style="color:#A6ACCD;">S: disk/by-uuid/5de1c8df-9b03-4830-9b56-b96a2290b78f</span></span>
<span class="line"><span style="color:#A6ACCD;">E: DEVLINKS=/dev/disk/by-id/ata-CentOS_Linux-0_SSD_FFACPKN8NC9MK3EX3N4R-part1 /dev/disk/by-uuid/5de1c8df-9b03-4830-9b56-b96a2290b78f</span></span>
<span class="line"><span style="color:#A6ACCD;">E: DEVNAME=/dev/sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">E: DEVPATH=/devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda/sda1</span></span>
<span class="line"><span style="color:#A6ACCD;">E: DEVTYPE=partition</span></span>
<span class="line"><span style="color:#A6ACCD;">E: ID_ATA=1</span></span>
<span class="line"><span style="color:#A6ACCD;">E: ID_ATA_ROTATION_RATE_RPM=0</span></span>
<span class="line"><span style="color:#A6ACCD;">E: ID_ATA_SATA=1</span></span>
<span class="line"><span style="color:#A6ACCD;">E: ID_ATA_SATA_SIGNAL_RATE_GEN1=1</span></span>
<span class="line"></span></code></pre></div><p><code>udevadmin monitor</code>用于实时监控udev实践,定位热插拔设备时特别有用.<br><code>udevadmin test xxxx</code>用于测试匹配设备的规则执行动作.<br> xxx可以是<code>/sys/class/block/sda</code>,<code>/sys/class/net/eth0</code>, 也可以是<code>/sys/devices</code>下面的设备</p><p>修改<code>/etc/udev/udev.conf</code>里的<code>udev_log=&quot;debug&quot;</code>可以打开更详细的日志<br> 使用<code>journalctl -u systemd-udevd</code>查看</p><h2 id="_67-一条命令启动web服务器" tabindex="-1">67. 一条命令启动web服务器 <a class="header-anchor" href="#_67-一条命令启动web服务器" aria-hidden="true">#</a></h2><p>查询设备的信息, 主要是环境变量</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">python -m SimpleHTTPServer 8000</span></span>
<span class="line"></span></code></pre></div><h2 id="_68-dpkg-apt-get包管理命令" tabindex="-1">68. dpkg,apt-get包管理命令 <a class="header-anchor" href="#_68-dpkg-apt-get包管理命令" aria-hidden="true">#</a></h2><p>查询所有包</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">dpkg -l</span></span>
<span class="line"></span></code></pre></div><p>查询某个文件属于哪个包</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dpkg -S /usr/bin/growpart</span></span>
<span class="line"><span style="color:#A6ACCD;">cloud-guest-utils: /usr/bin/growpart</span></span>
<span class="line"></span></code></pre></div><p>查询使用apt-get安装的历史记录</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ cat /var/log/apt/history.log</span></span>
<span class="line"></span></code></pre></div><h2 id="_69-主机安全入侵盘查" tabindex="-1">69. 主机安全入侵盘查 <a class="header-anchor" href="#_69-主机安全入侵盘查" aria-hidden="true">#</a></h2><p>检查<code>LD_PRELOAD</code>环境变量<br> 使用<code>vi</code>打开<code>/etc/ld.so.preload</code>这个文件是否有内容<br> 使用<code>cat /proc/$$/mountinfo</code> 或者<code>cat /proc/mounts </code> 看<code>proc</code> 是否被挂载到其他目录<br> 使用<code>strace</code>检查普通命令的系统调用<br> 如下个三个安全相关的分析案例:<br><a href="https://www.anquanke.com/post/id/160843" target="_blank" rel="noopener noreferrer">https://www.anquanke.com/post/id/160843</a><br><a href="https://superuser.com/questions/1183037/what-is-does-ld-so-preload-do" target="_blank" rel="noopener noreferrer">https://superuser.com/questions/1183037/what-is-does-ld-so-preload-do</a><br><a href="https://www.jianshu.com/p/31e487daa79d" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/31e487daa79d</a></p><h2 id="_70-top命令" tabindex="-1">70. top命令 <a class="header-anchor" href="#_70-top命令" aria-hidden="true">#</a></h2><p>top默认3秒刷新一次信息, 导致一些即时启动并结束的进程无法观察到, 可以用如下参数指定间隔:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">top -d 0.1</span></span>
<span class="line"></span></code></pre></div><p>上面是以100ms为间隔, 也可进入交互模式后按<code>d</code>进行动态调整<br> 交互模式下按<code>1</code>显示每个cpu的使用率信息, 按<code>M</code> 进程按内存排序, 按<code>H</code>显示线程信息</p><p>top进程级的默认字段如果不够, 可以按<code>f</code>选择要显示的字段,比如<code>last cpu used</code>, 然后按<code>q</code>返回显示<br><code>f</code>后不仅可以增加,删除,调整字段顺序, 还可以按<code>s</code>将当前选中的字段作为排序的字段. 比如按内存排序<br> 如果要过滤进程, 比如只显示cmdline 包含字符abc的进程, 按<code>o</code>后输入<code>COMMAND=abc</code>, 碰到java这种进程, 可以按<code>c</code>显示完整的命令行</p><p>查看单个进程的所有线程信息, 对java程序特别有用</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ top -Hp 4592</span></span>
<span class="line"><span style="color:#A6ACCD;">Threads:  11 total,   0 running,  11 sleeping,   0 stopped,   0 zombie</span></span>
<span class="line"><span style="color:#A6ACCD;">%Cpu</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:  0.0 us,  0.0 sy,  0.0 ni, 98.4 id,  0.0 wa,  1.6 hi,  0.0 si,  0.0 st</span></span>
<span class="line"><span style="color:#A6ACCD;">MiB Mem </span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;">   7809.8 total,   5711.5 free,    910.8 used,   1187.6 buff/cache</span></span>
<span class="line"><span style="color:#A6ACCD;">MiB Swap:      0.0 total,      0.0 free,      0.0 used.   6748.4 avail Mem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND</span></span>
<span class="line"><span style="color:#A6ACCD;">   4592 root      20   0 1810424 372332  14820 S   0.0   4.7   0:06.87 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4593 root      20   0 1810424 372332  14820 S   0.0   4.7   0:06.01 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4594 root      20   0 1810424 372332  14820 S   0.0   4.7   0:00.68 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4595 root      20   0 1810424 372332  14820 S   0.0   4.7   0:07.53 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4596 root      20   0 1810424 372332  14820 S   0.0   4.7   0:00.58 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4597 root      20   0 1810424 372332  14820 S   0.0   4.7   0:00.00 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4598 root      20   0 1810424 372332  14820 S   0.0   4.7   0:06.96 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4605 root      20   0 1810424 372332  14820 S   0.0   4.7   0:06.64 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4644 root      20   0 1810424 372332  14820 S   0.0   4.7   0:06.70 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4647 root      20   0 1810424 372332  14820 S   0.0   4.7   0:00.01 gopls</span></span>
<span class="line"><span style="color:#A6ACCD;">   4818 root      20   0 1810424 372332  14820 S   0.0   4.7   0:00.27 gopls</span></span>
<span class="line"></span></code></pre></div><h2 id="_71-ping命令" tabindex="-1">71. ping命令 <a class="header-anchor" href="#_71-ping命令" aria-hidden="true">#</a></h2><p><code>-i</code>指定两次ping之前的间隔, 默认是1s</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ping -i 0.1 www.163.com</span></span>
<span class="line"></span></code></pre></div><p><code>-s</code>指定ping包的大小, 默认是64bytes</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ping -s 1024 www.163.com</span></span>
<span class="line"><span style="color:#A6ACCD;">PING z163ipv6.v.bsgslb.cn </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">117.23.1.15</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> 1024</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">1052</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> bytes of data.</span></span>
<span class="line"><span style="color:#A6ACCD;">1032 bytes from 117.23.1.15: icmp_seq=1 ttl=128 time=7.03 ms</span></span>
<span class="line"><span style="color:#A6ACCD;">1032 bytes from 117.23.1.15: icmp_seq=2 ttl=128 time=7.77 ms</span></span>
<span class="line"></span></code></pre></div><h2 id="_72-ping和curl常见的网络报错" tabindex="-1">72. ping和curl常见的网络报错 <a class="header-anchor" href="#_72-ping和curl常见的网络报错" aria-hidden="true">#</a></h2><p>ping ip 报错：<br><code>connect: Network is unreachable</code> 原因是OS里没有相关路由导致<br><code>From 192.168.100.1 icmp_seq=1 Destination Port Unreachable</code> 原因是收到icmp reponse, 端口不可达， 中间设备或者iptable reject</p><p>cur ip 一些报错:<br><code>curl: (7) Failed to connect to 114.114.114.114: Network is unreachable</code> 原因是OS里没有相关路由导致 很快返回<code>curl: (7) Failed connect to 114.114.114.114:80; Connection refused</code> 因为Curl收到icmp 应答消息 80端口不可达， 可能是中间设备iptable发送或者收到服务端rst消息， 80端口没有处于监听状态</p><h2 id="_73-一些常用的内存统计命令" tabindex="-1">73. 一些常用的内存统计命令 <a class="header-anchor" href="#_73-一些常用的内存统计命令" aria-hidden="true">#</a></h2><p>统计所有进程占用的物理内存</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># 使用 grep 查找 Pss 指标后，再用 awk 计算累加值</span></span>
<span class="line"><span style="color:#A6ACCD;">$ grep Pss /proc/</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">1-9</span><span style="color:#89DDFF;">]*</span><span style="color:#A6ACCD;">/smaps </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> awk </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{total+=$2}; END {printf &quot;%d kB\n&quot;, total }</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">391266 kB</span></span>
<span class="line"></span></code></pre></div><p>有时smaps文件会看到没有读写权限的内存段,但有p这个权限,即是内存,往往发生在libc这样的共享库和java程序.<br> 如下文章解释了具体的目的, java程序的情况下经常占用了很大的内存, 只要是为了预留一段连续的内存快<br> 这些内存是不会计算到<code>Rss</code>或者<code>Pss</code>里面, 但却实实在在占用了内存.<br><a href="https://unix.stackexchange.com/questions/226283/shared-library-mappings-in-proc-pid-maps" target="_blank" rel="noopener noreferrer">https://unix.stackexchange.com/questions/226283/shared-library-mappings-in-proc-pid-maps</a><br><a href="https://unix.stackexchange.com/questions/353676/what-is-the-purpose-of-seemingly-unusable-memory-mappings-in-linux/353685#353685" target="_blank" rel="noopener noreferrer">https://unix.stackexchange.com/questions/353676/what-is-the-purpose-of-seemingly-unusable-memory-mappings-in-linux/353685#353685</a></p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">7fae7db9f000-7fae7dc8f000 r-xp 00000000 08:05 536861                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.20</span></span>
<span class="line"><span style="color:#A6ACCD;">7fae7dc8f000-7fae7de8f000 ---p 000f0000 08:05 536861                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.20</span></span>
<span class="line"><span style="color:#A6ACCD;">7fae7de8f000-7fae7de97000 r--p 000f0000 08:05 536861                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.20</span></span>
<span class="line"><span style="color:#A6ACCD;">7fae7de97000-7fae7de99000 rw-p 000f8000 08:05 536861                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.20</span></span>
<span class="line"></span></code></pre></div><p>这篇文章详细地介绍了<code>/proc/meminfo</code>里的每一个字段的含义和一些有用的公式.<br><a href="http://linuxperf.com/?p=142" target="_blank" rel="noopener noreferrer">http://linuxperf.com/?p=142</a></p><h2 id="_74-不同os的文件编码" tabindex="-1">74. 不同OS的文件编码 <a class="header-anchor" href="#_74-不同os的文件编码" aria-hidden="true">#</a></h2><p>linux显示文件内容的编码方式</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ file -i old.txt</span></span>
<span class="line"><span style="color:#A6ACCD;">old.txt: text/plain</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> charset=us-ascii</span></span>
<span class="line"></span></code></pre></div><p>将文件abc.txt 编����方式从iso8859-1改为utf-8</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">iconv -f iso8859-1 -t utf-8 abc.txt </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> abc.txt.utf8</span></span>
<span class="line"></span></code></pre></div><p>讲当前文件夹所有文件的文件名编码从GBK改为UTF-8, <code>-r</code>表示递归所有子文件夹</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">convmv -f GBk -t UTF-8 --notest -r </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">，这</span></span>
<span class="line"></span></code></pre></div><p>参考: <a href="http://kuring.me/post/windows_linux_code/" target="_blank" rel="noopener noreferrer">http://kuring.me/post/windows_linux_code/</a></p><h2 id="_75-一些shell循环命令" tabindex="-1">75. 一些shell循环命令 <a class="header-anchor" href="#_75-一些shell循环命令" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span><span style="color:#A6ACCD;"> cat /proc/stat  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> grep </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cpu </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> sleep 30</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> n </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> {1..1000}</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span><span style="color:#A6ACCD;"> touch a</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> rm -rf a</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> file </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">ls -1 /proc/</span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">1-9</span><span style="color:#89DDFF;">]*</span><span style="color:#C3E88D;">/status</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span><span style="color:#A6ACCD;"> grep Name </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"></span></code></pre></div><h2 id="_76-dhcp持续请求配置" tabindex="-1">76. dhcp持续请求配置 <a class="header-anchor" href="#_76-dhcp持续请求配置" aria-hidden="true">#</a></h2><p>Network管理时, 如果要在dhcp获取ip失败后不断重试,则在<code>ifcfg-ethX</code>文件里增加<code>PERSISTENT_DHCLIENT=yes</code><br> 默认是1分钟后超时, 不重试,日志打印<code>no dhcpoffers received</code><br> 如果加参数, 1分钟超时, 然后一个随机的时间间隔后再次重试. 一直重试到成功获取ip,日志打印如下:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">no dhcpoffers received</span></span>
<span class="line"><span style="color:#A6ACCD;">no working leases </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> persistent database - sleeping</span></span>
<span class="line"></span></code></pre></div><p>如果底层网卡有down, up动作, dhcp进程还在, 只显示一条报错信息<code>receive_packet failed on eth0: Network is down</code><br> 当通过dhcp获取ip失败后, 如果配置了持续获取, 那么下次发起请求的时间间隔是个随机值,大致为150s~450s之间.<br> 具体的代码如下, <code>retry_interval</code>默认是300s,且不可调整<br><a href="https://github.com/42wim/isc-dhcp/blob/f54a146c7fe88889d60f0c1aa8e6f04707f95223/client/dhclient.c" target="_blank" rel="noopener noreferrer">https://github.com/42wim/isc-dhcp/blob/f54a146c7fe88889d60f0c1aa8e6f04707f95223/client/dhclient.c</a></p><div class="language-c"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">log_info</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">No working leases in persistent database - sleeping.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">script_init</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">FAIL</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> string_list </span><span style="color:#89DDFF;">*)</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">client </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> alias</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#82AAFF;">script_write_params</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">alias_</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> client </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> alias</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">script_go</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	client </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> state </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> S_INIT</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	tv.tv_sec </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cur_tv.tv_sec </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">retry_interval </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#A6ACCD;">		    </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">random</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">retry_interval</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">	tv.tv_usec </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">tv.tv_sec </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> cur_tv.tv_sec</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#82AAFF;">random</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000000</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> cur_tv.tv_usec</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">add_timeout</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">tv</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> state_init</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">detach</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><p>NetworkManager管理时, 两个方法配置持久化:<br> 使用类似命令修改<code>nmcli connection modify enps1s0 ipv4.dhcp-timeout infinity</code><br> 在<code>ifcfg-ethX</code>里增加<code>IPV4_DHCP_TIMEOUT=2147483647</code><br> 参考 <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/configuring_the_dhcp_client_behavior" target="_blank" rel="noopener noreferrer">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/configuring_the_dhcp_client_behavior</a></p><h2 id="_77-解析-proc-pid-status里关于信号的字段" tabindex="-1">77. 解析/proc/[pid]/status里关于信号的字段 <a class="header-anchor" href="#_77-解析-proc-pid-status里关于信号的字段" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">#read -p &quot;PID=&quot; pid</span></span>
<span class="line"><span style="color:#A6ACCD;">pid=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">cat /proc/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">pid/status</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">egrep </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">(Sig|Shd)(Pnd|Blk|Ign|Cgt)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">while </span><span style="color:#82AAFF;">read</span><span style="color:#A6ACCD;"> name mask</span><span style="color:#89DDFF;">;</span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">    bin=</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">echo </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ibase=16; obase=2; </span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">mask^^</span><span style="color:#89DDFF;">*}&quot;|</span><span style="color:#C3E88D;">bc</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> -n </span><span style="color:#89DDFF;">&quot;$</span><span style="color:#A6ACCD;">name</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">mask</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">bin</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    i=1</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">bin </span><span style="color:#89DDFF;">-ne</span><span style="color:#A6ACCD;"> 0 </span><span style="color:#89DDFF;">]];</span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">bin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(-1)</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-eq</span><span style="color:#A6ACCD;"> 1 </span><span style="color:#89DDFF;">]];</span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#82AAFF;">kill</span><span style="color:#A6ACCD;"> -l </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">i </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> tr </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"><span style="color:#A6ACCD;">        bin=</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">bin</span><span style="color:#89DDFF;">::-</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$((</span><span style="color:#C3E88D;">i</span><span style="color:#89DDFF;">++))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># vim:et:sw=4:ts=4:sts=4:</span></span>
<span class="line"></span></code></pre></div><p>参考链接: <a href="https://stackoverflow.com/questions/4155483/proc-pidstatus-sigign-field" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/4155483/proc-pidstatus-sigign-field</a></p><h2 id="_78-审计谁杀了进程" tabindex="-1">78. 审计谁杀了进程 <a class="header-anchor" href="#_78-审计谁杀了进程" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">auditctl -a always,exit -F arch=b64 -F a1=15 -S </span><span style="color:#82AAFF;">kill</span><span style="color:#A6ACCD;"> -k log_kill</span></span>
<span class="line"><span style="color:#A6ACCD;">auditctl -a always,exit -F arch=b64 -F a1=9 -S </span><span style="color:#82AAFF;">kill</span><span style="color:#A6ACCD;"> -k log_kill</span></span>
<span class="line"></span></code></pre></div><p>参考: <a href="https://jotdownux.wordpress.com/2016/01/23/whos-killing-that-process-whos-dumping-prelink-files-in-tmp-linux-auditd-to-the-rescue/" target="_blank" rel="noopener noreferrer">https://jotdownux.wordpress.com/2016/01/23/whos-killing-that-process-whos-dumping-prelink-files-in-tmp-linux-auditd-to-the-rescue/</a></p><h2 id="_79-修改字符集的命令" tabindex="-1">79. 修改字符集的命令 <a class="header-anchor" href="#_79-修改字符集的命令" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">localectl set-locale LANG=en_US.UTF-8</span></span>
<span class="line"><span style="color:#A6ACCD;">localectl set-locale LANG=zh_CN.UTF-8</span></span>
<span class="line"><span style="color:#A6ACCD;">localectl list-locales</span></span>
<span class="line"></span></code></pre></div><h2 id="_80-bash脚本的退出码" tabindex="-1">80. bash脚本的退出码 <a class="header-anchor" href="#_80-bash脚本的退出码" aria-hidden="true">#</a></h2><p>脚本退出码是有特殊含义的,比如常见的<code>127</code>代表脚本里的命令没找到,<code>130</code>代表用户按了<code>ctrl+c</code>导致脚本停止</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ abc</span></span>
<span class="line"><span style="color:#A6ACCD;">-bash: abc: </span><span style="color:#82AAFF;">command</span><span style="color:#A6ACCD;"> not found</span></span>
<span class="line"><span style="color:#A6ACCD;">$ </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">127</span></span>
<span class="line"><span style="color:#A6ACCD;">$ sleep 1000</span></span>
<span class="line"><span style="color:#A6ACCD;">^C</span></span>
<span class="line"><span style="color:#A6ACCD;">$ </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">130</span></span>
<span class="line"></span></code></pre></div><p>更详细的退出码含义请参见 <a href="https://tldp.org/LDP/abs/html/exitcodes.html" target="_blank" rel="noopener noreferrer">https://tldp.org/LDP/abs/html/exitcodes.html</a></p><h2 id="_81-模拟不断增加内存致使触发oom的程序" tabindex="-1">81. 模拟不断增加内存致使触发oom的程序 <a class="header-anchor" href="#_81-模拟不断增加内存致使触发oom的程序" aria-hidden="true">#</a></h2><div class="language-c"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdio.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdlib.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">void</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> n </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">                 </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">malloc</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">NULL)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">                         </span><span style="color:#82AAFF;">printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">malloc failure after %d MiB</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> n</span><span style="color:#89DDFF;">);</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">                         </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">                 </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">                 </span><span style="color:#82AAFF;">printf</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">got %d MiB</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">++</span><span style="color:#F07178;">n</span><span style="color:#89DDFF;">);</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> $ gcc memtest1.c  </span></span>
<span class="line"><span style="color:#A6ACCD;"> $ .</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">a.out  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> got </span><span style="color:#F78C6C;">570528</span><span style="color:#A6ACCD;"> MiB  </span></span>
<span class="line"><span style="color:#A6ACCD;"> got </span><span style="color:#F78C6C;">570529</span><span style="color:#A6ACCD;"> MiB  </span></span>
<span class="line"><span style="color:#A6ACCD;"> got </span><span style="color:#F78C6C;">570530</span><span style="color:#A6ACCD;"> MiB  </span></span>
<span class="line"><span style="color:#A6ACCD;"> got </span><span style="color:#F78C6C;">570531</span><span style="color:#A6ACCD;"> MiBKilled</span></span>
<span class="line"></span></code></pre></div><p>具体的详细测试步骤: <a href="https://access.redhat.com/solutions/47692" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/47692</a></p><h2 id="_82-vi实现十六进制编辑功能" tabindex="-1">82. vi实现十六进制编辑功能 <a class="header-anchor" href="#_82-vi实现十六进制编辑功能" aria-hidden="true">#</a></h2><p>vim配合xxd对文件进行十六进制的编辑,达到类似UltraEdit的效果</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">vi abc.txt</span></span>
<span class="line"><span style="color:#A6ACCD;">:%</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">xxd</span></span>
<span class="line"><span style="color:#A6ACCD;">修改完后,运行下面的命令. 注意左边改动会生效,右边的文本改动不生效</span></span>
<span class="line"><span style="color:#A6ACCD;">:%</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">xxd -r</span></span>
<span class="line"></span></code></pre></div><p>更详细的请看 <a href="https://www.cnblogs.com/meibenjin/archive/2012/12/06/2806396.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/meibenjin/archive/2012/12/06/2806396.html</a></p><h2 id="_83-iproute软件包里的一些常用命令" tabindex="-1">83. iproute软件包里的一些常用命令 <a class="header-anchor" href="#_83-iproute软件包里的一些常用命令" aria-hidden="true">#</a></h2><p><code>ifstat</code>打印网卡的一些统计信息,类似<code>ifconfig</code>里的输出,但每次运行时输出从上次运行之后这段时间的统计,而<code>ifconfig</code>是打印的从网卡up以来的累积值<br><code>-a</code>则忽略历史文件,打印从网卡up后的累积值,<code>-j</code>表示输出格式是json.方便二次处理</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ifstat</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#kernel</span></span>
<span class="line"><span style="color:#A6ACCD;">Interface        RX Pkts/Rate    TX Pkts/Rate    RX Data/Rate    TX Data/Rate</span></span>
<span class="line"><span style="color:#A6ACCD;">                 RX Errs/Drop    TX Errs/Drop    RX Over/Rate    TX Coll/Rate</span></span>
<span class="line"><span style="color:#A6ACCD;">lo                    14 0            14 0           819 0           819 0</span></span>
<span class="line"><span style="color:#A6ACCD;">                       0 0             0 0             0 0             0 0</span></span>
<span class="line"><span style="color:#A6ACCD;">eth0                  25 0            18 0          2058 0          2784 0</span></span>
<span class="line"><span style="color:#A6ACCD;">                       0 0             0 0             0 0             0 0</span></span>
<span class="line"><span style="color:#A6ACCD;">virbr0                 0 0             0 0             0 0             0 0</span></span>
<span class="line"><span style="color:#A6ACCD;">                       0 0             0 0             0 0             0 0</span></span>
<span class="line"><span style="color:#A6ACCD;">docker0                0 0             0 0             0 0             0 0</span></span>
<span class="line"><span style="color:#A6ACCD;">                       0 0             0 0             0 0             0 0</span></span>
<span class="line"></span></code></pre></div><p><code>nstat</code>打印协议栈里的一些统计计数,类似<code>netstat -s</code>的输出,与内核代码里的相关变量名更贴近,容易分析比较<br><code>-r</code>则忽略历史文件,打印从网卡up后的累积值,<code>-z</code>表示非0值的字段也输出</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ nstat</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#kernel</span></span>
<span class="line"><span style="color:#A6ACCD;">IpInReceives                    8297               0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">IpInDelivers                    8297               0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">IpOutRequests                   7789               0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">IcmpInMsgs                      6                  0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">IcmpInErrors                    3                  0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">IcmpInDestUnreachs              6                  0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">IcmpOutMsgs                     6                  0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">IcmpOutDestUnreachs             6                  0.0</span></span>
<span class="line"></span></code></pre></div><p><code>TcpExtListenOverflows</code>和<code>TcpExtListenDrops</code> 代表全队列或者半队列满了<br><code>TcpInCsumErrors</code>代表接受的包在tcp层的checksum校验不通过,被丢弃</p><p>所有的计数项解释 <a href="https://www.kernel.org/doc/html/latest/networking/snmp_counter.html" target="_blank" rel="noopener noreferrer">https://www.kernel.org/doc/html/latest/networking/snmp_counter.html</a></p><p><code>lnstat</code>周期性输入一些内核统计数据, <code>-d</code>显示支持的具体文件和项</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ lnstat -d</span></span>
<span class="line"><span style="color:#A6ACCD;">/proc/net/stat/nf_conntrack:</span></span>
<span class="line"><span style="color:#A6ACCD;">	 1: entries</span></span>
<span class="line"><span style="color:#A6ACCD;">	 2: searched</span></span>
<span class="line"><span style="color:#A6ACCD;">	 3: found</span></span>
<span class="line"><span style="color:#A6ACCD;">	 4: new</span></span>
<span class="line"><span style="color:#A6ACCD;">	 5: invalid</span></span>
<span class="line"><span style="color:#A6ACCD;">	 6: ignore</span></span>
<span class="line"><span style="color:#A6ACCD;">	 7: delete</span></span>
<span class="line"><span style="color:#A6ACCD;">	 8: delete_list</span></span>
<span class="line"><span style="color:#A6ACCD;">	 9: insert</span></span>
<span class="line"><span style="color:#A6ACCD;">	10: insert_failed</span></span>
<span class="line"><span style="color:#A6ACCD;">	11: drop</span></span>
<span class="line"><span style="color:#A6ACCD;">	12: early_drop</span></span>
<span class="line"><span style="color:#A6ACCD;">	13: icmp_error</span></span>
<span class="line"><span style="color:#A6ACCD;">	14: expect_new</span></span>
<span class="line"><span style="color:#A6ACCD;">	15: expect_create</span></span>
<span class="line"><span style="color:#A6ACCD;">	16: expect_delete</span></span>
<span class="line"><span style="color:#A6ACCD;">	17: search_restart</span></span>
<span class="line"><span style="color:#A6ACCD;">/proc/net/stat/ndisc_cache:</span></span>
<span class="line"><span style="color:#A6ACCD;">	 1: entries</span></span>
<span class="line"><span style="color:#A6ACCD;">	 2: allocs</span></span>
<span class="line"><span style="color:#A6ACCD;">	 3: destroys</span></span>
<span class="line"><span style="color:#A6ACCD;">	 4: hash_grows</span></span>
<span class="line"><span style="color:#A6ACCD;">	 5: lookups</span></span>
<span class="line"><span style="color:#A6ACCD;">	 6: hits</span></span>
<span class="line"><span style="color:#A6ACCD;">	 7: res_failed</span></span>
<span class="line"><span style="color:#A6ACCD;">	 8: rcv_probes_mcast</span></span>
<span class="line"><span style="color:#A6ACCD;">	 9: rcv_probes_ucast</span></span>
<span class="line"><span style="color:#A6ACCD;">	10: periodic_gc_runs</span></span>
<span class="line"><span style="color:#A6ACCD;">	11: forced_gc_runs</span></span>
<span class="line"><span style="color:#A6ACCD;">	12: unresolved_discards</span></span>
<span class="line"></span></code></pre></div><p><code>-k</code>可输出特定项的信息</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ lnstat -k </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">entries,insert_failed</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">nf_connt</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">nf_connt</span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;"> entries</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">insert_f</span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">   ailed</span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">       7</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">       0</span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">       7</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">       0</span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">       7</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">       0</span><span style="color:#89DDFF;">|</span></span>
<span class="line"></span></code></pre></div><p>这里的entris和<code>conntrack -L</code>的信息是一样的</p><p><code>tc</code>可以模拟网络延迟,限速等功能, 下面是查看当前策略的命令</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ tc -s qdisc</span></span>
<span class="line"><span style="color:#A6ACCD;">$ tc -s qdisc ls dev eth0</span></span>
<span class="line"></span></code></pre></div><h2 id="_84-链接跟踪" tabindex="-1">84. 链接跟踪 <a class="header-anchor" href="#_84-链接跟踪" aria-hidden="true">#</a></h2><p><code>conntrack -L</code>可显示当前的所有链接信息, 需要安装<code>conntrack-tools</code>后才可以使用</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ conntrack -L</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp      6 430950 ESTABLISHED src=10.211.55.22 dst=10.211.55.2 sport=22 dport=51568 src=10.211.55.2 dst=10.211.55.22 sport=51568 dport=22 </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">ASSURED</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> mark=0 use=1</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp      6 5 TIME_WAIT src=10.211.55.22 dst=113.142.161.250 sport=48530 dport=80 src=113.142.161.250 dst=10.211.55.22</span></span>
<span class="line"></span></code></pre></div><p>查看当前链接跟踪表里的数目</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ cat /proc/sys/net/netfilter/nf_conntrack_count</span></span>
<span class="line"><span style="color:#A6ACCD;">4</span></span>
<span class="line"></span></code></pre></div><p>查看当前生效的最大值</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ cat /proc/sys/net/netfilter/nf_conntrack_max</span></span>
<span class="line"><span style="color:#A6ACCD;">65536</span></span>
<span class="line"></span></code></pre></div><p>如果内核出现<code>nf_conntrack: table full, dropping packet.</code>, 则需要增加链接跟踪表的最大连接数</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">sysctl -w net.nf_conntrack_max=xxxxx</span></span>
<span class="line"></span></code></pre></div><p>还可以通过在加载模块时指定hashsize解决</p><p><a href="https://access.redhat.com/solutions/972673" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/972673</a> 介绍了针对匹配的包不进行连接跟踪的方法<br> 更详细的一些文章:<br><a href="https://blog.csdn.net/u010472499/article/details/78292811" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/u010472499/article/details/78292811</a><br><a href="https://access.redhat.com/solutions/8721" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/8721</a><br><a href="https://access.redhat.com/solutions/974723" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/974723</a><br><a href="https://access.redhat.com/solutions/8721" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/8721</a></p><p><code>sysctl -a | grep nf_</code> 查看和链接跟踪所有的内核参数<br> 具体解释: <a href="https://www.kernel.org/doc/Documentation/networking/nf_conntrack-sysctl.txt" target="_blank" rel="noopener noreferrer">https://www.kernel.org/doc/Documentation/networking/nf_conntrack-sysctl.txt</a></p><p>下面的规则是用于跟踪对应连接的TCP状态, 每次连接都有自己的超时时间, 如果配置不当会导致丢包.<br> 比如<code>ESTABLISHED</code>的超时时间时5天, 如果改为5分钟, 且这5分钟该TCP没有任何报文交互, 则 iptables会将该连接置为invalid.<br> 这样即使用<code>ss</code>或者<code>netstat</code>查看该连接仍是<code>ESTABLISHED</code>, 任何发到该连接的报文全部会被丢弃.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">    0     0 ACCEPT     all  --  </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">      virbr0  0.0.0.0/0            192.168.122.0/24     ctstate RELATED,ESTABLISHED</span></span>
<span class="line"></span></code></pre></div><p>具体的信息见`man iptables-extensions</p><p>一些介绍链接跟踪,iptables的文章<br><a href="https://www.cnblogs.com/liushaodong/archive/2013/02/26/2933593.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/liushaodong/archive/2013/02/26/2933593.html</a><br><a href="http://arthurchiao.art/blog/conntrack-design-and-implementation/" target="_blank" rel="noopener noreferrer">http://arthurchiao.art/blog/conntrack-design-and-implementation/</a></p><h2 id="_85-一些汇编语法" tabindex="-1">85. 一些汇编语法 <a class="header-anchor" href="#_85-一些汇编语法" aria-hidden="true">#</a></h2><p>如下文章介绍了x86_64下许多寄存器的用途<br><a href="http://abcdxyzk.github.io/blog/2012/11/23/assembly-args/" target="_blank" rel="noopener noreferrer">http://abcdxyzk.github.io/blog/2012/11/23/assembly-args/</a></p><h2 id="_86-使用crash分析内核coredump的一些文章" tabindex="-1">86. 使用crash分析内核coredump的一些文章 <a class="header-anchor" href="#_86-使用crash分析内核coredump的一些文章" aria-hidden="true">#</a></h2><p><a href="https://irmbor.co.rs/~dspalovic/assets/docsOracle/E41138/html/ch10s02.html" target="_blank" rel="noopener noreferrer">https://irmbor.co.rs/~dspalovic/assets/docsOracle/E41138/html/ch10s02.html</a><br><a href="https://www.slideshare.net/PaulVNovarese/linux-crash-dump-capture-and-analysis" target="_blank" rel="noopener noreferrer">https://www.slideshare.net/PaulVNovarese/linux-crash-dump-capture-and-analysis</a><br><a href="https://serverfault.com/questions/475721/how-to-use-kdump-crash-to-investigate-an-oom-issue" target="_blank" rel="noopener noreferrer">https://serverfault.com/questions/475721/how-to-use-kdump-crash-to-investigate-an-oom-issue</a><br><a href="https://www.redhat.com/archives/crash-utility/2012-December/msg00029.html" target="_blank" rel="noopener noreferrer">https://www.redhat.com/archives/crash-utility/2012-December/msg00029.html</a></p><p>最主要还是看crash的官方主页: <a href="https://crash-utility.github.io/" target="_blank" rel="noopener noreferrer">https://crash-utility.github.io/</a></p><h2 id="_87-linux内核模块相关" tabindex="-1">87. Linux内核模块相关 <a class="header-anchor" href="#_87-linux内核模块相关" aria-hidden="true">#</a></h2><p>使用weak-modules实现外部开发的内核模块在多个内核(KABI兼容的情况下)都可以使用, 这篇文章介绍了具体的方法<br><a href="https://www.cnblogs.com/xingmuxin/p/9092344.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/xingmuxin/p/9092344.html</a></p><h2 id="_88-ssh连接保活配置" tabindex="-1">88. ssh连接保活配置 <a class="header-anchor" href="#_88-ssh连接保活配置" aria-hidden="true">#</a></h2><p>编辑 /etc/ssh/sshd_config, 添加如下两行, 重启sshd服务生效</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ClientAliveInterval 60 </span></span>
<span class="line"><span style="color:#A6ACCD;">ClientAliveCountMax 3 </span></span>
<span class="line"></span></code></pre></div><h2 id="_89-使用auditd审计功能" tabindex="-1">89. 使用auditd审计功能 <a class="header-anchor" href="#_89-使用auditd审计功能" aria-hidden="true">#</a></h2><p>直接使用<code>systemctl restart auditd</code>重启auditd是失败.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ systemctl restart auditd</span></span>
<span class="line"><span style="color:#A6ACCD;">Failed to restart auditd.service: Operation refused, unit auditd.service may be requested by dependency only </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">it is configured to refuse manual start/stop</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">See system logs and </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">systemctl status auditd.service</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> details.</span></span>
<span class="line"></span></code></pre></div><p>可以使用<code>service auditd status/start/stop/restart</code><br> 参见: <a href="https://access.redhat.com/solutions/2664811" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/2664811</a></p><p>启动/重启auditd 报错&quot;Not able to start Auditd service with pid file exists error&quot;<br> 原因是有其他程序占用了kernel的audit功能, 可以使用<code>auditctl -s</code>查看其他程序的pid<br><a href="https://access.redhat.com/solutions/5431221" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/5431221</a></p><p><code>/var/log/audit/audit.log</code>里的日志格式, 默认不够人性化, 具体字段含义参见:<br><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files" target="_blank" rel="noopener noreferrer">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files</a></p><p>打印今天的审计摘要</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ aureport --start 01/10/2020 07:00:00 --end 01/10/2020 19:00:00</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Summary Report</span></span>
<span class="line"><span style="color:#A6ACCD;">======================</span></span>
<span class="line"><span style="color:#A6ACCD;">Range of </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> logs: 04/27/2019 20:30:36.683 - 01/01/1970 08:00:00.000</span></span>
<span class="line"><span style="color:#A6ACCD;">Selected </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> report: 01/10/2020 07:00:00 - 01/10/2020 19:00:00</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of changes </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> configuration: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of changes to accounts, groups, or roles: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of logins: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of failed logins: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of authentications: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of failed authentications: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of users: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of terminals: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of host names: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of executables: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of commands: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of files: 0</span></span>
<span class="line"></span></code></pre></div><p>昨天到今天这个时间段里的审计摘要</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ aureport --start yesterday --end today</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Summary Report</span></span>
<span class="line"><span style="color:#A6ACCD;">======================</span></span>
<span class="line"><span style="color:#A6ACCD;">Range of </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> logs: 04/27/2019 20:30:36.683 - 10/01/2020 13:10:43.415</span></span>
<span class="line"><span style="color:#A6ACCD;">Selected </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> report: 09/30/2020 00:00:00 - 10/01/2020 13:12:35</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of changes </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> configuration: 46</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of changes to accounts, groups, or roles: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of logins: 25</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of failed logins: 2</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of authentications: 80</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of failed authentications: 1</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of users: 2</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of terminals: 16</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of host names: 3</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of executables: 14</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of commands: 11</span></span>
<span class="line"><span style="color:#A6ACCD;">Number of files: 2</span></span>
<span class="line"></span></code></pre></div><p>从昨天开始事件统计摘要, <code>-i</code>让输出更人性化.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ aureport --start yesterday -e -i --summary</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Event Summary Report</span></span>
<span class="line"><span style="color:#A6ACCD;">======================</span></span>
<span class="line"><span style="color:#A6ACCD;">total  </span><span style="color:#82AAFF;">type</span></span>
<span class="line"><span style="color:#A6ACCD;">======================</span></span>
<span class="line"><span style="color:#A6ACCD;">14485  CRYPTO_KEY_USER</span></span>
<span class="line"><span style="color:#A6ACCD;">8076  USER_START</span></span>
<span class="line"><span style="color:#A6ACCD;">7639  USER_END</span></span>
<span class="line"><span style="color:#A6ACCD;">6762  CRED_ACQ</span></span>
<span class="line"><span style="color:#A6ACCD;">6761  USER_ACCT</span></span>
<span class="line"><span style="color:#A6ACCD;">6753  LOGIN</span></span>
<span class="line"><span style="color:#A6ACCD;">6704  CRED_REFR</span></span>
<span class="line"><span style="color:#A6ACCD;">6527  CRED_DISP</span></span>
<span class="line"><span style="color:#A6ACCD;">4966  NETFILTER_CFG</span></span>
<span class="line"></span></code></pre></div><p>统计可执行文件的摘要</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ aureport -x -i --summary</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Executable Summary Report</span></span>
<span class="line"><span style="color:#A6ACCD;">=================================</span></span>
<span class="line"><span style="color:#A6ACCD;">total  file</span></span>
<span class="line"><span style="color:#A6ACCD;">=================================</span></span>
<span class="line"><span style="color:#A6ACCD;">33791  /usr/sbin/sshd</span></span>
<span class="line"><span style="color:#A6ACCD;">31880  /usr/sbin/crond</span></span>
<span class="line"><span style="color:#A6ACCD;">7432  /usr/lib/systemd/systemd</span></span>
<span class="line"><span style="color:#A6ACCD;">4370  /usr/sbin/xtables-multi</span></span>
<span class="line"><span style="color:#A6ACCD;">651  </span><span style="color:#89DDFF;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">627  /usr/bin/python2.7</span></span>
<span class="line"><span style="color:#A6ACCD;">608  /usr/bin/login</span></span>
<span class="line"><span style="color:#A6ACCD;">309  /usr/bin/kmod</span></span>
<span class="line"><span style="color:#A6ACCD;">232  /usr/lib/systemd/systemd-update-utmp</span></span>
<span class="line"><span style="color:#A6ACCD;">204  /</span></span>
<span class="line"><span style="color:#A6ACCD;">102  /usr/sbin/libvirtd</span></span>
<span class="line"><span style="color:#A6ACCD;">94  /usr/sbin/tcpdump</span></span>
<span class="line"><span style="color:#A6ACCD;">60  /usr/bin/su</span></span>
<span class="line"><span style="color:#A6ACCD;">50  /usr/bin/dockerd-current</span></span>
<span class="line"><span style="color:#A6ACCD;">42  /usr/sbin/groupadd</span></span>
<span class="line"></span></code></pre></div><p>显示每个audit日志记录的对应时间段</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ aureport -t</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Log Time Range Report</span></span>
<span class="line"><span style="color:#A6ACCD;">=====================</span></span>
<span class="line"><span style="color:#A6ACCD;">/var/log/audit/audit.log.2: 04/27/2019 20:30:36.683 - 12/01/2019 10:40:01.857</span></span>
<span class="line"><span style="color:#A6ACCD;">/var/log/audit/audit.log.1: 12/01/2019 10:40:01.858 - 06/08/2020 12:20:01.343</span></span>
<span class="line"><span style="color:#A6ACCD;">/var/log/audit/audit.log: 06/08/2020 12:20:01.358 - 10/01/2020 13:42:52.455</span></span>
<span class="line"></span></code></pre></div><p>搜索今天所有的日志</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ausearch --start today -i</span></span>
<span class="line"></span></code></pre></div><p>搜索今天所有的事件为系统调用的日志<br> 所有的事件列表参见: <a href="https://access.redhat.com/articles/4409591" target="_blank" rel="noopener noreferrer">https://access.redhat.com/articles/4409591</a></p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ausearch --start today -i  -m syscall</span></span>
<span class="line"></span></code></pre></div><p>搜索今天所有的关键字为xxxx的日志</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ausearch --start today -i  -k xxxx</span></span>
<span class="line"></span></code></pre></div><p>搜索今天所有的涉及文件/etc/passwd的日志</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ausearch --start today -i  -f /etc/passwd</span></span>
<span class="line"></span></code></pre></div><p>其他一些参考资料:<br><a href="https://cloud.tencent.com/developer/article/1359606" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/1359606</a></p><h2 id="_90-分析磁盘性能" tabindex="-1">90. 分析磁盘性能 <a class="header-anchor" href="#_90-分析磁盘性能" aria-hidden="true">#</a></h2><p>blktrace -d /dev/vda blkparse -i vda -d vda.blktrace.bin btt -i vda.blktrace.bin -l vda.d2c_latency</p><p>参考:<br><a href="https://developer.aliyun.com/article/698568" target="_blank" rel="noopener noreferrer">https://developer.aliyun.com/article/698568</a><br><a href="https://tunnelix.com/debugging-disk-issues-with-blktrace-blkparse-btrace-and-btt-in-linux-environment/" target="_blank" rel="noopener noreferrer">https://tunnelix.com/debugging-disk-issues-with-blktrace-blkparse-btrace-and-btt-in-linux-environment/</a></p><p><code>iostat</code>里<code>await</code>和<code>svctm</code>相关解释<br><a href="https://access.redhat.com/solutions/2039133" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/2039133</a><br><a href="https://access.redhat.com/articles/524353" target="_blank" rel="noopener noreferrer">https://access.redhat.com/articles/524353</a><br><a href="https://access.redhat.com/solutions/112613" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/112613</a></p><h2 id="_91-grub相关问题" tabindex="-1">91. Grub相关问题 <a class="header-anchor" href="#_91-grub相关问题" aria-hidden="true">#</a></h2><p>CentOS 6 和7 如何重装grub<br><a href="https://access.redhat.com/solutions/1521" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/1521</a></p><h2 id="_92-slab相关的知识" tabindex="-1">92. SLAB相关的知识 <a class="header-anchor" href="#_92-slab相关的知识" aria-hidden="true">#</a></h2><p>统计slab内各项的内存占用并降序排列TOP 10</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">awk </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{printf &quot;  %6i MB %s \n&quot;,$6*$15/256,$1}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> /proc/slabinfo </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> sort -nrk1 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> head -10</span></span>
<span class="line"></span></code></pre></div><h2 id="_93-nfs相关的知识" tabindex="-1">93. nfs相关的知识 <a class="header-anchor" href="#_93-nfs相关的知识" aria-hidden="true">#</a></h2><p>nfs Debug<br><a href="https://access.redhat.com/solutions/262213" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/262213</a><br><a href="https://access.redhat.com/solutions/1460313" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/1460313</a><br><a href="https://access.redhat.com/solutions/4253191" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/4253191</a><br><a href="https://access.redhat.com/solutions/2948091" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/2948091</a><br><a href="https://access.redhat.com/solutions/3765711" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/3765711</a><br><a href="https://access.redhat.com/solutions/28211" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/28211</a></p><p>nfs, rpc相关的Debug开关<br><a href="https://wiki.archlinux.org/index.php/NFS/Troubleshooting#RPC_debug_flags" target="_blank" rel="noopener noreferrer">https://wiki.archlinux.org/index.php/NFS/Troubleshooting#RPC_debug_flags</a></p><h2 id="_94-fork创建进程时的几个报错说明" tabindex="-1">94. fork创建进程时的几个报错说明 <a class="header-anchor" href="#_94-fork创建进程时的几个报错说明" aria-hidden="true">#</a></h2><p>有两个常见的报错:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">11: Resource temporarily unavailable</span></span>
<span class="line"><span style="color:#A6ACCD;">12: Cannot allocate memory</span></span>
<span class="line"></span></code></pre></div><p>在fork等创建进程的操作里, 当达到<code>nproc</code>的限制， 即用户的最大进程数， 报错<code>Resource temporarily unavailable</code> （这条规则对root用户无效） 如果在文件里对<code>nproc</code>配置为<code>ulimited</code> 这个值是根据内存算出来的， 公式可参考<br><a href="https://thelinuxcluster.com/2020/05/14/how-is-the-nproc-hard-limit-calculated-and-how-do-we-change-the-value-on-centos-7/" target="_blank" rel="noopener noreferrer">https://thelinuxcluster.com/2020/05/14/how-is-the-nproc-hard-limit-calculated-and-how-do-we-change-the-value-on-centos-7/</a></p><p>当达到系统级参数pid_max限制，无法分配出pid时， 报错为<code>Cannot allocate memory</code></p><p><code>sysctl kernel.pid_max</code>查询当前的最大值, pid_max默认是32768， 64位系统， 最大可配置为4百万左右<br><code>kernel.threads-max</code> 也控制系统能创建的最大进程/线程数, 因为它的默认值非常大. 一般都没关注过. 总是<code>kernel.pid_max</code>先超出限制.<br> 如下是相关代码: linux-3.10.0-957.21.3.el7\include\linux\threads.h</p><div class="language-c"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * This controls the default maximum pid allocated to a process</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#define</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PID_MAX_DEFAULT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">CONFIG_BASE_SMALL </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0x1000</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0x8000</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * A maximum of 4 million PIDs should be enough for a while.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * [NOTE: PID/TIDs are limited to 2^29 ~= 500+ million, see futex.h.]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#define</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PID_MAX_LIMIT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">CONFIG_BASE_SMALL </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> PAGE_SIZE </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> \</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">(sizeof(</span><span style="color:#C792EA;">long</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> PID_MAX_DEFAULT</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-79ca2460 data-v-04568844><div class="edit-info" data-v-04568844><!----><div class="last-updated" data-v-04568844><p class="VPLastUpdated" data-v-04568844 data-v-0ce8c960>Last updated: <time datatime="2022-07-14T14:54:09.000Z" data-v-0ce8c960></time></p></div></div><div class="prev-next" data-v-04568844><div class="pager" data-v-04568844><a class="pager-link prev" href="/linux/linux-boot.html" data-v-04568844><span class="desc" data-v-04568844>Previous page</span><span class="title" data-v-04568844>Linux Boot过程总结</span></a></div><div class="has-prev pager" data-v-04568844><a class="pager-link next" href="/linux/shadow.html" data-v-04568844><span class="desc" data-v-04568844>Next page</span><span class="title" data-v-04568844>Linux /etc/shadow 文件学习笔记</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-6b5fd0a9 data-v-5b331722><div class="container" data-v-5b331722><p class="message" data-v-5b331722>Released under the MIT License.</p><p class="copyright" data-v-5b331722>Copyright © 2022-present xixiliguo</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"algorithm_algorithm-dfs.md\":\"a73dea67\",\"algorithm_binary-index-tree.md\":\"8bc3e51f\",\"algorithm_radix-tree.md\":\"6b75afb6\",\"algorithm_segment-tree.md\":\"c689b78e\",\"algorithm_unionfind.md\":\"a646711f\",\"golang_golang-exec.md\":\"357621ac\",\"golang_strings-algorithm-golang.md\":\"57a20191\",\"index.md\":\"27757f36\",\"k8s_runc.md\":\"09e5ae92\",\"kernel_kernel-cgroup-namespace.md\":\"4a81fd3c\",\"kernel_kernel-crash.md\":\"27a485e9\",\"kernel_kernel-irq.md\":\"0bfc9b45\",\"kernel_kernel-memory.md\":\"1c2cf851\",\"kernel_kernel-syscall-sched.md\":\"29c8373b\",\"kernel_linux-trap.md\":\"ae6473f3\",\"linux_atop.md\":\"6cfa95b0\",\"linux_bandersnatch-pypi.md\":\"dee4724b\",\"linux_cloud-init.md\":\"e0bc6141\",\"linux_dns.md\":\"ccf3bd81\",\"linux_linux-boot.md\":\"459acaa4\",\"linux_linux-common-commands.md\":\"c3e4942a\",\"linux_linux-shadow.md\":\"4d01a795\",\"linux_multi-queue.md\":\"9db1b9ad\",\"linux_ntp.md\":\"0f26af7e\",\"linux_yum-update.md\":\"67a0bf95\",\"network_libvirt-network.md\":\"90682305\",\"network_tcp.md\":\"2211909d\",\"network_tcpdump-wireshark.md\":\"a2fe5423\",\"others_code_segment.md\":\"f0f03c59\",\"others_lua-implemention-gc.md\":\"80382876\",\"others_lua-implemention-type-value.md\":\"e4816df1\"}")</script>
    <script type="module" async src="/assets/app.526dca4e.js"></script>
    
  </body>
</html>