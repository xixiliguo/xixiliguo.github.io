import{_ as s,c as n,o as a,a as l}from"./app.526dca4e.js";const i=JSON.parse('{"title":"DNS\u5B66\u4E60\u603B\u7ED3","description":"","frontmatter":{"title":"DNS\u5B66\u4E60\u603B\u7ED3","author":"Peter Wangbo","tags":["dns","\u4EFB\u64AD"],"date":"2019-11-24T14:22:53.000Z","draft":"flase"},"headers":[],"relativePath":"linux/dns.md","lastUpdated":1657810449000}'),p={name:"linux/dns.md"},o=l(`<p>\u8FD9\u91CC\u8BB0\u5F55\u4E86\u81EA\u5DF1\u5B66\u4E60DNS\u534F\u8BAE\u4E2D\u603B\u7ED3\u548C\u5BF9\u4E00\u4E9B\u95EE\u9898\u7684\u601D\u8003</p><h1 id="dns\u534F\u8BAE" tabindex="-1">DNS\u534F\u8BAE <a class="header-anchor" href="#dns\u534F\u8BAE" aria-hidden="true">#</a></h1><p>DNS\u9ED8\u8BA4\u4F7F\u7528UDP\u534F\u8BAE,\u53D1\u6D88\u606F\u5230\u670D\u52A1\u5668\u768453\u7AEF\u53E3. UDP\u4E0D\u9700\u8981TCP\u90A3\u6837\u4E09\u4E2A\u63E1\u624B\u5EFA\u7ACB\u8FDE\u63A5. \u6548\u7387\u66F4\u9AD8. \u7B80\u5355\u5730\u8BF7\u6C42,\u7136\u540E\u6536\u5230\u56DE\u590D.<br> \u6839\u57DF\u540D\u670913\u53F0, \u8FD9\u662F\u56E0\u4E3A\u65E9\u671F\u534F\u8BAE\u6D89\u53CA\u65F6, \u89C4\u5B9Adns\u6570\u636E\u5305\u6700\u5927512\u4E2A\u5B57\u8282(\u4E0D\u542BIP\u5C42\u548CMAC\u5C42). \u6700\u591A\u5C31\u53EA\u80FD\u5BB9\u7EB313\u4E2A\u4FE1\u606F. \u5177\u4F53\u89C1\u4E0B\u9762\u6587\u7AE0\u6240\u8BC9<br><a href="https://www.apnic.net/get-ip/faqs/rootservers/" target="_blank" rel="noopener noreferrer">https://www.apnic.net/get-ip/faqs/rootservers/</a><br><a href="https://miek.nl/2013/november/10/why-13-dns-root-servers/" target="_blank" rel="noopener noreferrer">https://miek.nl/2013/november/10/why-13-dns-root-servers/</a><br> \u786E\u5B9E\u6839\u57DF\u540D\u670913\u4E2AIP, \u4F46\u540E\u9762\u6BCF\u4E2AIP\u5E76\u4E0D\u6307\u5411\u4E00\u4E2A\u670D\u52A1\u5668. \u8FD9\u91CC\u91C7\u7528\u4E86BGP\u7684\u4EFB\u64AD\u673A\u5236, \u8BBF\u95EEIP, \u8DEF\u7531\u5668\u4F1A\u8DEF\u7531\u5230\u8DDD\u79BB\u4F60\u6700\u8FD1\u7684\u4E00\u53F0\u670D\u52A1\u5668. \u8FD9\u662F\u6839DNS\u670D\u52A1\u5668\u7684\u8D1F\u8F7D\u5747\u8861\u6280\u672F<br> \u5355\u64AD,\u591A\u64AD,\u5E7F\u64AD\u548C\u4EFB\u64AD\u6280\u672F\u4ECB\u7ECD\u53C2\u89C1: <a href="https://www.hi-linux.com/posts/26571.html" target="_blank" rel="noopener noreferrer">https://www.hi-linux.com/posts/26571.html</a></p><h1 id="resolv-conf\u6587\u4EF6\u89E3\u6790" tabindex="-1">resolv.conf\u6587\u4EF6\u89E3\u6790 <a class="header-anchor" href="#resolv-conf\u6587\u4EF6\u89E3\u6790" aria-hidden="true">#</a></h1><p><code>/etc/resolv.conf</code>\u8BE6\u7EC6\u914D\u7F6E\u89E3\u6790\u53C2\u89C1<code>man 5 resolv.conf</code>, \u5B83\u5C5E\u4E8Eglibc\u7684\u4E00\u90E8\u5206. \u5982\u679C\u7A0B\u5E8F\u53D1\u6D88\u606F\u5230DNS\u670D\u52A1\u5668\u8BF7\u6C42\u57DF\u540D\u89E3\u6790,\u5219\u8BE5\u6587\u4EF6\u7684\u6240\u6709\u914D\u7F6E\u6587\u4EF6\u4E0D\u751F\u6548. \u6BD4\u5982<code>dig</code>\u76F4\u63A5\u548CDNS\u670D\u52A1\u5668\u4EA4\u4E92. <code>ping,curl,wget</code>\u5219\u4F7F\u7528<code>glibc</code>\u5E93<br> \u9ED8\u8BA4timeout\u4E3A5, attempts\u4E3A2, \u610F\u601D\u662F\u5728\u653E\u5F03\u8BE5\u8FDE\u63A5,\u5C1D\u8BD5\u4E0B\u4E00\u4E2ADNS\u670D\u52A1\u5668\u524D\u7B49\u5F85\u8D85\u65F6\u65F6\u95F4\u4E3A5s, \u5C1D\u8BD52\u904D\u540E\u653E\u5F03. \u5176\u4E2D\u4E00\u904D\u8868\u793A\u8F6E\u8BE2\u5B8C\u4E00\u904D\u6240\u6709\u7684DNS\u670D\u52A1\u5668\u5931\u8D25<br> \u5047\u8BBE\u914D\u7F6E\u6587\u4EF6\u5982\u4E0B</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># cat /etc/resolv.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">options single-request-reopen</span></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> generated by /usr/sbin/dhclient-script</span></span>
<span class="line"><span style="color:#A6ACCD;">search localdomain</span></span>
<span class="line"><span style="color:#A6ACCD;">nameserver 114.114.114.117</span></span>
<span class="line"><span style="color:#A6ACCD;">nameserver 114.114.114.113</span></span>
<span class="line"></span></code></pre></div><p>\u4E0B\u9762\u662F<code>ping www.baid1xe21.com1</code>\u7684\u62A5\u6587\u4EA4\u4E92. \u53EF\u4EE5\u770B\u5230\u653E\u5F03\u4E24\u4E2ANS\u540E,\u8FD8\u6839\u636Esearch\u7684\u914D\u7F6E\u5C1D\u8BD5\u4F7F\u7528<code>www.baid1xe21.com1.localdomain</code>\u83B7\u53D6\u89E3\u6790</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># tcpdump -i eth0 -eennvv udp</span></span>
<span class="line"><span style="color:#A6ACCD;">tcpdump: listening on eth0, link-type EN10MB </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Ethernet</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, capture size 262144 bytes</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:12.576101 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 78: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 46506, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 64</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.52434 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.117.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x270e -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x20fb</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 20589+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">36</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:17.581591 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 78: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 37849, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 64</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.55684 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.113.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x270a -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x144d</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 20589+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">36</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:22.588076 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 78: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 52914, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 64</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.52434 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.117.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x270e -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x20fb</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 20589+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">36</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:27.593191 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 78: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 47412, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 64</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.55684 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.113.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x270a -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x144d</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 20589+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">36</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:32.598796 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 90: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 60578, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 76</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.53255 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.117.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x271a -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x09f4</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 59663+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1.localdomain. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">48</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:37.605004 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 90: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 52533, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 76</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.50522 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.113.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x2716 -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x14a5</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 59663+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1.localdomain. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">48</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:42.609907 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 90: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 3384, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 76</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.53255 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.117.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x271a -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x09f4</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 59663+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1.localdomain. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">48</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">15:39:47.616265 00:1c:42:03:fd:99 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 00:1c:42:00:00:18, ethertype IPv4 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">0x0800</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 90: </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">tos 0x0, ttl 64, id 52752, offset 0, flags </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">DF</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, proto UDP </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">17</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, length 76</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    10.211.55.22.50522 </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 114.114.114.113.53: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">bad udp cksum 0x2716 -</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 0x14a5</span><span style="color:#89DDFF;">!]</span><span style="color:#A6ACCD;"> 59663+ A</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> www.baid1xe21.com1.localdomain. </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">48</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>\u901A\u8FC7<code>strace</code>\u89C2\u6D4B\u5230\u7684\u7CFB\u7EDF\u8C03\u7528\u5982\u4E0B:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">17:38:46 close</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">                       = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000263&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 socket</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">AF_INET, SOCK_DGRAM</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">SOCK_CLOEXEC</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">SOCK_NONBLOCK, IPPROTO_IP</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 4 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000222&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 connect</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">4, {sa_family=AF_INET, sin_port=htons</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">53</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, sin_addr=inet_addr</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10.211.54.2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">}, 16</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000280&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 1 </span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, revents</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000173&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 sendto</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">4, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w\\221\\1\\0\\0\\1\\0\\0\\0\\0\\0\\0\\3www\\003163\\3com\\vlocaldo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">..., 41, MSG_NOSIGNAL, NULL, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 41 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000147&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:46 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLIN}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 5000</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Timeout</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">5.</span><span style="color:#89DDFF;">006352&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 socket</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">AF_INET, SOCK_DGRAM</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">SOCK_CLOEXEC</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">SOCK_NONBLOCK, IPPROTO_IP</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 5 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000306&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 connect</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5, {sa_family=AF_INET, sin_port=htons</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">53</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, sin_addr=inet_addr</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10.211.54.3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">}, 16</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000243&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 1 </span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, revents</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000109&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 sendto</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w\\221\\1\\0\\0\\1\\0\\0\\0\\0\\0\\0\\3www\\003163\\3com\\vlocaldo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">..., 41, MSG_NOSIGNAL, NULL, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 41 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000290&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:51 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLIN}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 5000</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Timeout</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">5.</span><span style="color:#89DDFF;">006234&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:56 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 1 </span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, revents</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000221&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:56 sendto</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">4, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w\\221\\1\\0\\0\\1\\0\\0\\0\\0\\0\\0\\3www\\003163\\3com\\vlocaldo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">..., 41, MSG_NOSIGNAL, NULL, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 41 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000371&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:38:56 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">4, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLIN}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 5000</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Timeout</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">5.</span><span style="color:#89DDFF;">006071&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:01 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 1 </span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, revents</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLOUT}</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000119&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:01 sendto</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w\\221\\1\\0\\0\\1\\0\\0\\0\\0\\0\\0\\3www\\003163\\3com\\vlocaldo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">..., 41, MSG_NOSIGNAL, NULL, 0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 41 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000617&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:01 poll</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">{fd</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">5, events</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">POLLIN}</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, 1, 5000</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 0 </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Timeout</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">5.</span><span style="color:#89DDFF;">005939&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:06 close</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">4</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">                       = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000189&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:06 close</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">5</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">                       = 0 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000146&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">17:39:06 open</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/share/locale/locale.alias</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">, O_RDONLY</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">O_CLOEXEC</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = 4 </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">0.</span><span style="color:#89DDFF;">000120&gt;</span></span>
<span class="line"></span></code></pre></div><p>DHCP\u81EA\u52A8\u83B7\u53D6IP\u573A\u666F,\u7ECF\u5E38\u4F1A\u8986\u76D6\u7528\u6237\u81EA\u5DF1\u914D\u7F6E\u7684\u53C2\u6570, \u53EF\u4EE5\u4F7F\u7528\u7C7B\u4F3C\u5982\u4E0B\u7684\u547D\u4EE4\u5C06\u914D\u7F6E\u6301\u4E45\u5316. dhcp\u53EA\u4F1A\u66F4\u65B0DNS\u670D\u52A1\u5668,\u4E0D\u4F1A\u5220\u9664\u7528\u6237\u914D\u7F6E.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">RES_OPTIONS=&quot;timeout:2 attempts:3 rotate single-request-reopen&quot;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;">/etc/sysconfig/network</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u5BB9\u5668\u573A\u666F\u4E0B,\u7ECF\u5E38\u9047\u5230\u57DF\u540D\u89E3\u67905s\u8D85\u65F6\u7684\u95EE\u9898,\u4E3B\u8981\u662F\u56E0\u4E3A<code>glibc</code>\u4E0B\u4F1A\u540C\u65F6\u5E76\u884C\u53D1\u51FA\u8BF7\u6C42A\u7EA7\u8BB0\u5F55\u548CAAA\u8BB0\u5F55\u7684\u62A5\u6587, \u5E95\u5C42\u6709\u65F6\u5904\u7406\u4E0D\u4E86\u8FD9\u79CD\u7ADE\u4E89\u6761\u4EF6,\u5BFC\u81F4\u8D85\u65F6. \u53EF\u901A\u901A\u8FC7<code>single-request-reopen</code>\u6765\u89E3\u51B3, \u8BE6\u7EC6\u89C1\u5982\u4E0B\u6587\u7AE0:<br><a href="https://tencentcloudcontainerteam.github.io/2018/10/26/DNS-5-seconds-delay/" target="_blank" rel="noopener noreferrer">https://tencentcloudcontainerteam.github.io/2018/10/26/DNS-5-seconds-delay/</a></p><p>\u5728\u67E5\u8BE2\u57DF\u540D\u65F6\uFF0C\u5982\u679C\u57DF\u540D\u91CC\u9762<code>.</code>\u7684\u4E2A\u6570\u5C0F\u4E8E ndots \u6307\u5B9A\u7684\u6570\uFF0C\u5219\u4F1A\u6839\u636E search \u4E2D\u914D\u7F6E\u7684\u5217\u8868\u4F9D\u6B21\u5728\u5BF9\u5E94\u57DF\u4E2D\u67E5\u8BE2\uFF0C\u5982\u679C\u6CA1\u6709\u8FD4\u56DE\uFF0C\u5219\u6700\u540E\u76F4\u63A5\u67E5\u8BE2\u57DF\u540D\u672C\u8EAB\u3002 ndots \u9ED8\u8BA4\u662F1</p><p>\u5982\u679C\u5927\u4E8Endtos, \u5148\u76F4\u63A5\u67E5\u8BE2, \u67E5\u8BE2\u4E0D\u5230\u518D\u5728serach\u91CC\u7684\u57DF\u91CC\u7EE7\u7EED\u67E5\u8BE2 \u5047\u8BBE\u914D\u7F6E\u5982\u4E0B:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">nameserver 10.232.0.3</span></span>
<span class="line"><span style="color:#A6ACCD;">search default.svc.cluster.local svc.cluster.local cluster.local</span></span>
<span class="line"><span style="color:#A6ACCD;">options ndots:5</span></span>
<span class="line"></span></code></pre></div><p>\u60F3\u89E3\u6790\u7684<code>kubernetes.default.svc</code>\u4E2D\u7684 . \u53EA\u67092\uFF0C\u5C0F\u4E8E5\uFF0C\u8FD9\u65F6\u4F1A\u4F9D\u6B21\u62FC\u63A5\u4E0A search \u4E2D\u7684\u5730\u5740\u4E4B\u540E\u518D\u8FDB\u884C\u67E5\u8BE2\uFF0C\u5982\u679C\u90FD\u67E5\u8BE2\u4E0D\u5230\uFF0C\u5219\u518D\u67E5\u8BE2\u672C\u8EAB\u3002</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># host -v kubernetes.default.svc</span></span>
<span class="line"><span style="color:#A6ACCD;">Trying </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">kubernetes.default.svc.default.svc.cluster.local</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Trying </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">kubernetes.default.svc.svc.cluster.local</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Trying </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">kubernetes.default.svc.cluster.local</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"></span></code></pre></div><h1 id="dig\u547D\u4EE4\u4F7F\u7528" tabindex="-1">dig\u547D\u4EE4\u4F7F\u7528 <a class="header-anchor" href="#dig\u547D\u4EE4\u4F7F\u7528" aria-hidden="true">#</a></h1><p>\u67E5\u8BE2<code>www.163.com</code>\u89E3\u6790\u4FE1\u606F</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig www.163.com</span></span>
<span class="line"></span></code></pre></div><p>\u8FED\u4EE3\u67E5\u8BE2</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig +trace www.163.com</span></span>
<span class="line"></span></code></pre></div><p>\u6307\u5B9A\u4ECEDNS\u670D\u52A1\u5668<code>8.8.8.8</code>\u83B7\u53D6\u89E3\u6790\u7ED3\u679C</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig @8.8.8.8 www.163.com</span></span>
<span class="line"></span></code></pre></div><p>\u53CD\u5411\u89E3\u6790\u4E00\u4E2Aip</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig -x 114.114.114.114</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#89DDFF;font-style:italic;">&gt;&gt;</span><span style="color:#C3E88D;"> DiG 9.9.4-RedHat-9.9.4-74.el7_6.1 &lt;&lt;&gt;&gt; -x 114.114.114.114</span></span>
<span class="line"><span style="color:#C3E88D;">;; global options: +cmd</span></span>
<span class="line"><span style="color:#C3E88D;">;; Got answer:</span></span>
<span class="line"><span style="color:#C3E88D;">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 58603</span></span>
<span class="line"><span style="color:#C3E88D;">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; OPT PSEUDOSECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">; EDNS: version: 0, flags:; udp: 512</span></span>
<span class="line"><span style="color:#C3E88D;">;; QUESTION SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">;114.114.114.114.in-addr.arpa.	IN	PTR</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">114.114.114.114.in-addr.arpa. 119 IN	PTR	public1.114dns.com.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; Query time: 33 msec</span></span>
<span class="line"><span style="color:#C3E88D;">;; SERVER: 10.211.55.1#53(10.211.55.1)</span></span>
<span class="line"><span style="color:#C3E88D;">;; WHEN: Sun Oct 04 20:20:09 HKT 2020</span></span>
<span class="line"><span style="color:#C3E88D;">;; MSG SIZE  rcvd: 89</span></span>
<span class="line"></span></code></pre></div><h1 id="getaddrinfo\u8FD4\u56DE\u7684\u591A\u4E2Aa\u8BB0\u5F55\uFF0C\u8D1F\u8F7D\u5747\u8861\u5931\u6548" tabindex="-1">getaddrinfo\u8FD4\u56DE\u7684\u591A\u4E2AA\u8BB0\u5F55\uFF0C\u8D1F\u8F7D\u5747\u8861\u5931\u6548 <a class="header-anchor" href="#getaddrinfo\u8FD4\u56DE\u7684\u591A\u4E2Aa\u8BB0\u5F55\uFF0C\u8D1F\u8F7D\u5747\u8861\u5931\u6548" aria-hidden="true">#</a></h1><p>\u57DF\u540D\u7ECF\u5E38\u4F1A\u5BF9\u5E94\u591A\u4E2A\u5730\u5740, \u5982\u4E0B\u9762\u6240\u793A, \u89E3\u6790www.baidu.com\u8FD4\u56DE 14.215.177.39 \u548C 14.215.177.38, \u7A0B\u5E8F\u9ED8\u8BA4\u662F\u53D6\u7B2C\u4E00\u4E2A\u4F5C\u4E3A\u6700\u7EC8\u7ED3\u679C. \u6240\u4EE5DNS\u670D\u52A1\u5668\u4F1A\u968F\u673A\u8C03\u6574\u8FD4\u56DE\u7684IP\u5217\u8868\u987A\u5E8F, \u8FD9\u6837\u53EF\u4EE5\u5B9E\u73B0\u8D1F\u8F7D\u5747\u8861, \u53EB\u505A round-robin-dns</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ dig www.baidu.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#89DDFF;font-style:italic;">&gt;&gt;</span><span style="color:#C3E88D;"> DiG 9.11.20-RedHat-9.11.20-5.el8 &lt;&lt;&gt;&gt; www.baidu.com</span></span>
<span class="line"><span style="color:#C3E88D;">;; global options: +cmd</span></span>
<span class="line"><span style="color:#C3E88D;">;; Got answer:</span></span>
<span class="line"><span style="color:#C3E88D;">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 6006</span></span>
<span class="line"><span style="color:#C3E88D;">;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; QUESTION SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">;www.baidu.com.                 IN      A</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#C3E88D;">www.baidu.com.          831     IN      CNAME   www.a.shifen.com.</span></span>
<span class="line"><span style="color:#C3E88D;">www.a.shifen.com.       122     IN      A       14.215.177.39</span></span>
<span class="line"><span style="color:#C3E88D;">www.a.shifen.com.       122     IN      A       14.215.177.38</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">;; Query time: 11 msec</span></span>
<span class="line"><span style="color:#C3E88D;">;; SERVER: 192.168.3.1#53(192.168.3.1)</span></span>
<span class="line"><span style="color:#C3E88D;">;; WHEN: Sun Feb 21 21:35:18 CST 2021</span></span>
<span class="line"><span style="color:#C3E88D;">;; MSG SIZE  rcvd: 90</span></span>
<span class="line"></span></code></pre></div><p>\u4F46\u5728\u4E00\u4E9B\u7279\u6B8A\u573A\u666F\u4E0B, getaddrinfo\u7684\u8FD4\u56DE\u7684IPv4\u5217\u8868\u987A\u5E8F\u6C38\u8FDC\u662F\u56FA\u5B9A\u7684,\u5373\u4F7FDNS\u670D\u52A1\u5668\u8FD4\u56DE\u662F\u968F\u673A\u7684. \u8FD9\u662F\u56E0\u4E3Agetaddrinfo\u9075\u4ECErfc3484\u5BF9\u8FD4\u56DE\u7684IP\u5217\u8868\u8FDB\u884C\u6392\u5E8F. \u5177\u4F53\u5F71\u54CD\u662F\u5F53\u8FD4\u56DE\u7684IP\u4E0E\u5BA2\u6237\u7AEF\u7684IP\u5904\u4E8E\u540C\u4E00\u5B50\u7F51, \u62E5\u6709\u6700\u957F\u524D\u7F00\u7684\u6392\u5728\u524D\u9762. \u7528\u4E8E\u6BD4\u8F83\u7684\u524D\u7F00\u6307\u7684\u662Fip\u5730\u5740\u7684bit\u503C</p><p>192.168.3.20 == 11000000.10101000.00000011.00010100</p><table><thead><tr><th style="text-align:left;">\u672C\u673AIP</th><th style="text-align:left;">DNS\u670D\u52A1\u8FD4\u56DE</th><th style="text-align:left;">getaddrinfo\u8FD4\u56DE</th><th style="text-align:left;">\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:left;">192.168.3.20 /24</td><td style="text-align:left;">11000000.10101000.00001101.00011101 192.168.13.29<br> 11000000.10101000.00001101.00011011 192.168.13.27<br> 11000000.10101000.00000011.01000101 192.168.3.69</td><td style="text-align:left;">192.168.3.69<br> 192.168.13.29<br> 192.168.13.27</td><td style="text-align:left;">\u53EA\u6709192.168.3.69\u548C\u672C\u673AIP\u540C\u7F51\u6BB5,\u6240\u4EE5\u5B83\u9760\u524D,\u975E\u540C\u4E00\u5B50\u7F51\u7684\u4FDD\u6301\u539F\u987A\u5E8F\u4E0D\u53D8</td></tr><tr><td style="text-align:left;">192.168.3.20 /24</td><td style="text-align:left;">11000000.10101000.00001101.00011101 192.168.13.29<br> 11000000.10101000.00000011.01000101 192.168.3.69 <br> 11000000.10101000.00000011.00011011 192.168.3.27</td><td style="text-align:left;">192.168.3.27<br> 192.168.3.69<br> 192.168.13.29<br></td><td style="text-align:left;">\u540C\u7F51\u6BB5\u67093.27 \u548C 3.69 , commonprefixlen(27, 20) \u5927\u4E8E commonprefixlen(69, 20), \u6240\u4EE527\u9760\u524D. 69\u9760\u540E. \u975E\u540C\u4E00\u5B50\u7F51\u7684\u4FDD\u6301\u539F\u987A\u5E8F\u4E0D\u53D8</td></tr><tr><td style="text-align:left;">192.168.3.20 /24</td><td style="text-align:left;">11000000.10101000.00000011.00011101 192.168.3.29<br> 11000000.10101000.00000011.00011010 192.168.3.26 <br> 11000000.10101000.00000011.00011011 192.168.3.27</td><td style="text-align:left;">192.168.3.29<br> 192.168.3.26<br> 192.168.3.27<br></td><td style="text-align:left;">\u4E09\u4E2A\u7684commonprefixlen\u90FD\u4E00\u6837, \u4E0D\u9700\u8981\u6392\u5E8F.\u6309\u539F\u987A\u5E8F\u8FD4\u56DE</td></tr><tr><td style="text-align:left;">192.168.3.20 /24</td><td style="text-align:left;">11000000.10101000.00000011.00011101 192.168.3.29<br> 11000000.10101000.00000011.00010111 192.168.3.23 <br> 11000000.10101000.00000011.00011011 192.168.3.27</td><td style="text-align:left;">192.168.3.23<br> 192.168.3.29<br> 192.168.3.27<br></td><td style="text-align:left;">23\u7684commonprefixlen\u5927, \u6240\u4EE523\u9760\u524D,\u5176\u4ED6\u4E24\u4E2A\u7684\u6700\u957F\u524D\u7F00\u76F8\u7B49,\u987A\u5E8F\u4E0D\u53D8</td></tr></tbody></table><p>\u5982\u4E0B\u662F\u4E00\u4E2A\u7B80\u5355\u7684\u6D4B\u8BD5\u7ED3\u679C</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ go run a.go</span></span>
<span class="line"><span style="color:#A6ACCD;">use pure go, keep order from dns server  </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">192.168.3.29 192.168.3.23 192.168.3.27</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">use cgo, invoke getaddrinfo              </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">192.168.3.23 192.168.3.29 192.168.3.27</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p>\u6D4B\u8BD5\u4EE3\u7801:</p><div class="language-go"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">fmt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">io/ioutil</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">net</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">func</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	data </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#C3E88D;">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#C3E88D;">192.168.3.29  www.abc.com</span></span>
<span class="line"><span style="color:#C3E88D;">192.168.3.23  www.abc.com</span></span>
<span class="line"><span style="color:#C3E88D;">192.168.3.27  www.abc.com</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	ioutil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">WriteFile</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/etc/hosts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#82AAFF;">byte</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0644</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	testCases </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]struct</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		name     </span><span style="color:#C792EA;">string</span></span>
<span class="line"><span style="color:#A6ACCD;">		preferGo </span><span style="color:#C792EA;">bool</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">use pure go, keep order from dns server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true},</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">use cgo, invoke getaddrinfo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false},</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> _</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> tc </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">range</span><span style="color:#A6ACCD;"> testCases </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		net</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">DefaultResolver</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PreferGo </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tc</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">preferGo</span></span>
<span class="line"><span style="color:#A6ACCD;">		ips</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> _ </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> net</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">LookupHost</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">www.abc.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		fmt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%-40s %v</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> tc</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ips</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span style="color:#C3E88D;">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	ioutil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">WriteFile</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/etc/hosts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#82AAFF;">byte</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0644</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8981\u60F3\u907F\u514D\u8FD9\u79CD\u7279\u5B9A\u573A\u666F\u8FD4\u56DE\u7684ip\u662F\u56FA\u5B9A\u7684, \u53EF\u4EE5\u5173\u95EDipv6. \u8BE5\u95EE\u9898\u7684\u76F8\u5173\u53C2\u8003\u4FE1\u606F:<br><a href="https://access.redhat.com/solutions/22132" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/22132</a><br><a href="https://access.redhat.com/solutions/8709" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/8709</a><br><a href="https://gist.github.com/SpComb/c509bd064bc75151e6b41e8bc949d13f" target="_blank" rel="noopener noreferrer">https://gist.github.com/SpComb/c509bd064bc75151e6b41e8bc949d13f</a><br><a href="https://github.com/hashicorp/consul/issues/1481" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/consul/issues/1481</a><br><a href="https://github.com/weaveworks/weave/issues/1245" target="_blank" rel="noopener noreferrer">https://github.com/weaveworks/weave/issues/1245</a><br><a href="https://tools.ietf.org/rfc/rfc3484.txt" target="_blank" rel="noopener noreferrer">https://tools.ietf.org/rfc/rfc3484.txt</a><br><a href="https://www.api.rackspace.com/blog/glibc-linux-dns-round-robin-explanation/" target="_blank" rel="noopener noreferrer">https://www.api.rackspace.com/blog/glibc-linux-dns-round-robin-explanation/</a><br><a href="https://github.com/golang/go/issues/18518" target="_blank" rel="noopener noreferrer">https://github.com/golang/go/issues/18518</a></p>`,38),e=[o];function t(c,D,r,y,F,C){return a(),n("div",null,e)}var d=s(p,[["render",t]]);export{i as __pageData,d as default};
