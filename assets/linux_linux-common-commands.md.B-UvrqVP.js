import{_ as s,c as i,o as a,a2 as h,ab as n,ac as t}from"./chunks/framework.YBtj1D-X.js";const o=JSON.parse('{"title":"Linux 下常用命令与技巧汇总","description":"","frontmatter":{"title":"Linux 下常用命令与技巧汇总"},"headers":[],"relativePath":"linux/linux-common-commands.md","filePath":"linux/linux-common-commands.md","lastUpdated":1747665785000}'),p={name:"linux/linux-common-commands.md"},l=h(`<h1 id="linux-下常用命令与技巧汇总" tabindex="-1">Linux 下常用命令与技巧汇总 <a class="header-anchor" href="#linux-下常用命令与技巧汇总" aria-label="Permalink to &quot;Linux 下常用命令与技巧汇总&quot;">​</a></h1><p>收集自己常用到的linux命令与技巧,方便后续查找.不定期更新.</p><h2 id="_1-查询系统准确的启动时间" tabindex="-1">1. 查询系统准确的启动时间 <a class="header-anchor" href="#_1-查询系统准确的启动时间" aria-label="Permalink to &quot;1. 查询系统准确的启动时间&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">awk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{print $1}&#39; /proc/uptime) second ago&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +&quot;%Y-%m-%d %H:%M:%S&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2018-01-17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22:27:55</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">who</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         system</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> boot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2018-01-17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22:27</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uptime</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2019-09-04</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 00:40:58</span></span></code></pre></div><h2 id="_2-查询所有进程的准确启动时间和运行时长" tabindex="-1">2. 查询所有进程的准确启动时间和运行时长 <a class="header-anchor" href="#_2-查询所有进程的准确启动时间和运行时长" aria-label="Permalink to &quot;2. 查询所有进程的准确启动时间和运行时长&quot;">​</a></h2><p>-e 表示查询所有进程<br> -o 表示按指定的格式输出<br> lstart 为进程启动时间<br> etime可以显示已经运行了多长时间<br> args 为具体的命令行参数</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pid,lstart,etime,args</span></span></code></pre></div><p><code>ps -efL</code> 加 <code>-L</code> 则显示线程</p><h2 id="_3-设置时间" tabindex="-1">3. 设置时间 <a class="header-anchor" href="#_3-设置时间" aria-label="Permalink to &quot;3. 设置时间&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;dd/mm/yyyy hh:mm:ss&quot;</span></span></code></pre></div><p>也可以在centos7下使用</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timedatectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2012-10-30 18:17:16&quot;</span></span></code></pre></div><h2 id="_4-同步os与硬件时间" tabindex="-1">4. 同步OS与硬件时间 <a class="header-anchor" href="#_4-同步os与硬件时间" aria-label="Permalink to &quot;4. 同步OS与硬件时间&quot;">​</a></h2><p>将OS系统时间同步到硬件(RTC)</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hwclock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> –-systohc</span></span></code></pre></div><p>将硬件时间同步到OS</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hwclock</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hctosys</span></span></code></pre></div><h2 id="_5-查看硬件信息" tabindex="-1">5. 查看硬件信息 <a class="header-anchor" href="#_5-查看硬件信息" aria-label="Permalink to &quot;5. 查看硬件信息&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lscpu</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #查看CPU信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lspci</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #查看PCI信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsusb</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #查看外设USB</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsscsi</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              #查看SCSI设备</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsblk</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #查看块设备</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dmidecode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> memory</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #查内存槽位信息. 不跟 -t , 查全量processor, Memory, BIOS</span></span></code></pre></div><h2 id="_6-锁定文件-不被任何程序修改" tabindex="-1">6 锁定文件,不被任何程序修改 <a class="header-anchor" href="#_6-锁定文件-不被任何程序修改" aria-label="Permalink to &quot;6 锁定文件,不被任何程序修改&quot;">​</a></h2><p>chattr 可以改变文件扩展属性, <code>chattr +i</code> 可以防止任何程序修改该文件. 即使有root权限.<br> 常用于锁定dns配置,防止dhcp程序自动修改. <code>lsattr</code> 查看当前的扩展属性. <code>man chattr</code> 查看所有参数含义.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chattr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/resolv.conf</span></span></code></pre></div><h2 id="_7-stat-查看文件详细元数据信息-特别是inode" tabindex="-1">7. stat 查看文件详细元数据信息, 特别是inode <a class="header-anchor" href="#_7-stat-查看文件详细元数据信息-特别是inode" aria-label="Permalink to &quot;7. stat 查看文件详细元数据信息, 特别是inode&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> messages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  File:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ‘messages’</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Size:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         	Blocks:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          IO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Block:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4096</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   regular</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> empty</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Device:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fd01h/64769d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	Inode:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 528438</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Links:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Access:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (0600/-rw-------)  Uid: (    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   Gid: (    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> system_u:object_r:var_log_t:s0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Access:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2018-01-14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 21:32:01.977218590</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Modify:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2018-01-14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 21:32:01.977218590</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Change:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2018-01-14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 21:32:01.977218590</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Birth:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span></code></pre></div><h2 id="_8-xxd查看二进制文件" tabindex="-1">8. xxd查看二进制文件 <a class="header-anchor" href="#_8-xxd查看二进制文件" aria-label="Permalink to &quot;8. xxd查看二进制文件&quot;">​</a></h2><p>-s 指定起始位置(不指定则从0开始), -l 指定打印多少个字节</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xxd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/hosts</span></span></code></pre></div><p>当将js,或其他文本类信息嵌入到C程序时, <code>xxd -i</code> 非常实用.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0000000:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7661</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7220</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6120</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3d20</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 310a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                 var</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> char</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a_js[]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  0x76,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0x61,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0x72,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0x20,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0x61,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0x20,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0x3d,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0x20,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0x31,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x0a</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unsigned</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> int</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a_js_len</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="_9-批量修改文件名" tabindex="-1">9. 批量修改文件名 <a class="header-anchor" href="#_9-批量修改文件名" aria-label="Permalink to &quot;9. 批量修改文件名&quot;">​</a></h2><p>用法:<code>rename 原字符串 目标字符串 文件</code><br> 含义:<br> 原字符串：将文件名需要替换的字符串；<br> 目标字符串：将文件名中含有的原字符替换成目标字符串；<br> 文件：指定要改变文件名的文件列</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>rename支持通配符</span></span>
<span class="line"><span>?    可替代单个字符</span></span>
<span class="line"><span>*    可替代多个字符</span></span>
<span class="line"><span>[charset]    可替代charset集中的任意单个字符</span></span></code></pre></div><p>将所有已<code>yum</code>开头的文件的后缀名从<code>.yumtx</code>改为<code>.txt</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .yumtx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span></code></pre></div><h2 id="_10-df-查询文件系统挂载点信息" tabindex="-1">10. df 查询文件系统挂载点信息 <a class="header-anchor" href="#_10-df-查询文件系统挂载点信息" aria-label="Permalink to &quot;10. df 查询文件系统挂载点信息&quot;">​</a></h2><p><code>-h</code> 使容量的大小显示更人性化 <code>-T</code> 显示文件系统类型</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> df</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -hT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Filesystem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                   Type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Used</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Avail</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Use%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Mounted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ext4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       50G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  8.0G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   39G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  18%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">devtmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     devtmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  484M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  484M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     495M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  495M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/shm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     495M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  460K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  494M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     495M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  495M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /sys/fs/cgroup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/sda1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    ext4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      477M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  234M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  215M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  53%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /boot</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_home</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ext4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       12G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   41M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   11G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      99M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   99M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/user/0</span></span></code></pre></div><p><code>-i</code> 显示inode容量</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> df</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -hi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Filesystem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                   Inodes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> IUsed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> IFree</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> IUse%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Mounted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   3.2M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  170K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  3.0M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    6%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">devtmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       121K</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   389</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  121K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                          124K</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  124K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/shm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                          124K</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   498</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  124K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                          124K</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  124K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /sys/fs/cgroup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/sda1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      126K</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   358</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  125K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /boot</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_home</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   740K</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    31</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  740K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                          124K</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  124K</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/user/0</span></span></code></pre></div><h2 id="_11-du-命令" tabindex="-1">11. du 命令 <a class="header-anchor" href="#_11-du-命令" aria-label="Permalink to &quot;11. du 命令&quot;">​</a></h2><p>单位是KB 如下获取/tmp下所有文件的大小, 并按降序排列</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">du</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -xs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	systemd-private-415928f8a9ee431abb4fdb7f6265aa87-chronyd.service-uw9sq7</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	empty</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	a.tar.gz</span></span></code></pre></div><h2 id="_12-find删除查找到的文件" tabindex="-1">12. find删除查找到的文件 <a class="header-anchor" href="#_12-find删除查找到的文件" aria-label="Permalink to &quot;12. find删除查找到的文件&quot;">​</a></h2><p>find命令经常会用到, <code>-type f</code>表示只返回文件, <code>-exec</code> 可将已找到的结果作为标准输入执行其他命令.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PAT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">H</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 删除查找到的文件, 将 path 改为实际要查找的目录</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [PATH] [option] [action]  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-mtime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> n为数字，意思为在n天之前的“一天内”被更改过的文件；</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-mtime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 列出在n天之前（不含n天本身）被更改过的文件名；</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-mtime</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 列出在n天之内（含n天本身）被更改过的文件名；</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-newer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 列出比file还要新的文件名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">例如：</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -mtime</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 在当前目录下查找今天之内有改动的文件  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">与文件权限及名称有关的参数：</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ：找出文件名为filename的文件</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [+-]SIZE ：找出比SIZE还要大（+）或小（-）的文件  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-tpye</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ：查找文件的类型为TYPE的文件，TYPE的值主要有：一般文件（f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)、设备文件（b、c）、  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             目录（d）、连接文件（l）、socket（s）、FIFO管道文件（p）；</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-perm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ：查找文件权限刚好等于mode的文件，mode用数字表示，如0755；</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-perm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ：查找文件权限必须要全部包括mode权限的文件，mode用数字表示</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-perm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ：查找文件权限包含任一mode的权限的文件，mode用数字表示</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">例如：</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> passwd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查找文件名为passwd的文件  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -perm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0755</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查找当前目录中文件权限的0755的文件  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +12k</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查找当前目录中大于12KB的文件，注意c表示byte</span></span></code></pre></div><h2 id="_13-xargs-命令" tabindex="-1">13. xargs 命令 <a class="header-anchor" href="#_13-xargs-命令" aria-label="Permalink to &quot;13. xargs 命令&quot;">​</a></h2><p>该命令可以将一个命令的输出作为参数传递给另一个命令。<br> 区别于管道符<code>|</code>是将将输出作为另一个命令的标准输入传递.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.png</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> xargs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -cvzf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images.tar.gz</span></span></code></pre></div><p>默认是将内容放到参数的最后面, 如果要放到指定位置,需要使用 <code>-i</code> 和 <code>{}</code><br> 如下所示，将第一个命令的输出放到<code>{}</code>出现的位置</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.conf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> xargs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/likegeeks/Desktop/out</span></span></code></pre></div><h2 id="_14-grep查询文本" tabindex="-1">14. grep查询文本 <a class="header-anchor" href="#_14-grep查询文本" aria-label="Permalink to &quot;14. grep查询文本&quot;">​</a></h2><p>在文件中查找字符串(不区分大小写)</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;the&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/hosts</span></span></code></pre></div><p>输出成功匹配的行，以及该行之后的三行. -B 表示前三行. -C 指前后三行</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;localhost&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/hosts</span></span></code></pre></div><p>在一个文件夹中递归查询包含指定字符串的文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;abc&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc</span></span></code></pre></div><p>查找不包含 127 的所有行</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;127&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/hosts</span></span></code></pre></div><p>递归搜索时忽略二进制文件,加参数<code>-I</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;abc&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc</span></span></code></pre></div><h2 id="_15-tail-查看文件指定行信息" tabindex="-1">15. tail 查看文件指定行信息 <a class="header-anchor" href="#_15-tail-查看文件指定行信息" aria-label="Permalink to &quot;15. tail 查看文件指定行信息&quot;">​</a></h2><p>显示最后3行记录</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/yum.log-20180101</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 00:35:55</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Installed:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libvirt-debuginfo-3.2.0-14.el7_4.3.x86_64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 18:52:40</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Installed:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init-0.7.9-9.el7.centos.2.x86_64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 19:50:30</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Erased:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init-0.7.9-9.el7.centos.2.x86_64</span></span></code></pre></div><p>从第770行开始显示</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +770</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/yum.log-20180101</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 18:52:40</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Installed:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init-0.7.9-9.el7.centos.2.x86_64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 19:50:30</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Erased:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init-0.7.9-9.el7.centos.2.x86_64</span></span></code></pre></div><h2 id="_16-批量创建目录" tabindex="-1">16. 批量创建目录 <a class="header-anchor" href="#_16-批量创建目录" aria-label="Permalink to &quot;16. 批量创建目录&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new_folder/{folder_1,folder_2,folder_3,folder_4,folder_5}</span></span></code></pre></div><h2 id="_17-echo-相关命令" tabindex="-1">17. echo 相关命令 <a class="header-anchor" href="#_17-echo-相关命令" aria-label="Permalink to &quot;17. echo 相关命令&quot;">​</a></h2><p>显示当前使用哪个shell</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> $0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-bash</span></span></code></pre></div><p>显示最近一个命令执行的结果码</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0</span></span></code></pre></div><h2 id="_18-nohup与标准输出-标准错误输出" tabindex="-1">18. nohup与标准输出,标准错误输出 <a class="header-anchor" href="#_18-nohup与标准输出-标准错误输出" aria-label="Permalink to &quot;18. nohup与标准输出,标准错误输出&quot;">​</a></h2><p><code>nohup</code>配和<code>&amp;</code>可以让进程在后台运行, 如果没有显示指定, 默认将标准输出和错误输出重定向到 nohup.out<br><code>1&gt;/dev/null</code> 首先表示标准输出重定向到空设备文件，也就是不输出任何信息到终端，不显示任何信息<br><code>2&gt;&amp;1</code> 表示标准错误输出重定向等同于标准输出，因为之前标准输出已经重定向到了空设备文件，所以标准错误输出也重定向到空设备文件<br> 常用使用方式为:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMAND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">output.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span></span></code></pre></div><h2 id="_19-linux模块的安装和卸载" tabindex="-1">19. Linux模块的安装和卸载 <a class="header-anchor" href="#_19-linux模块的安装和卸载" aria-label="Permalink to &quot;19. Linux模块的安装和卸载&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsmod</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                               #显示当前装入的内核模块</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">modinfo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> module_name</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 #显示模块信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">modprobe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                         #显示模块的配置信息       </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">modprobe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --show-depends</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> module_name</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #显示模块的依赖信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">modprobe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> module_name</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                #手动加载模块</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rmmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> module_name</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   #卸载模块</span></span></code></pre></div><p>systemd 读取 /etc/modules-load.d/ 中的配置加载额外的内核模块。配置文件名称通常为 <code>/etc/modules-load.d/&lt;program&gt;.conf</code>。如：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ cat /etc/modules-load.d/bonding.conf</span></span>
<span class="line"><span>bonding</span></span></code></pre></div><p>使用 /etc/modprobe.d/中的文件来配置传递参数，如:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modprobe.d/bonding.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">options</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bonding</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mode=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div><p>别名</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modprobe.d/myalias.conf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Lets you use &#39;mymod&#39; in MODULES, instead of &#39;really_long_module_name&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">alias</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mymod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> really_long_module_name</span></span></code></pre></div><p>如果模块直接编译进内核，也可以通过启动管理器(GRUB, LILO 或 Syslinux)的内核行加入参数： <code>modname.parametername=parametercontents</code></p><p>列出直接编译到内核的模块列表</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /lib/modules/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uname</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/modules.builtin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kernel/lib/zlib_deflate/zlib_deflate.ko</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kernel/lib/zlib_inflate/zlib_inflate.ko</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kernel/lib/crc16.ko</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kernel/lib/crc32.ko</span></span></code></pre></div><h2 id="_20-column格式化输出" tabindex="-1">20. column格式化输出 <a class="header-anchor" href="#_20-column格式化输出" aria-label="Permalink to &quot;20. column格式化输出&quot;">​</a></h2><p>可以让一些命令的输出看起来更舒服些. 例如<code>blkid</code>,<code>mount</code>,<code>cat /etc/fstab</code>.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> blkid</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/sda1:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UUID=&quot;04f8e14d-906d-475a-bacc-7d4be966f670&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TYPE=&quot;ext4&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/sda2:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UUID=&quot;8pXbJg-c7bG-CzS4-Xs9Y-SdBD-TYOJ-0r9hgF&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TYPE=&quot;LVM2_member&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_swap:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UUID=&quot;c058935d-34e0-403c-82f6-435b1c8194ce&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TYPE=&quot;swap&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_root:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UUID=&quot;e9fe20ee-5d6f-4610-98ca-7cbed5d012ad&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TYPE=&quot;ext4&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_home:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UUID=&quot;43578ba0-a809-4274-931d-b92f881196ad&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TYPE=&quot;ext4&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> blkid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> column</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/sda1:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     UUID=&quot;04f8e14d-906d-475a-bacc-7d4be966f670&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TYPE=&quot;ext4&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/sda2:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     UUID=&quot;8pXbJg-c7bG-CzS4-Xs9Y-SdBD-TYOJ-0r9hgF&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  TYPE=&quot;LVM2_member&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_swap:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  UUID=&quot;c058935d-34e0-403c-82f6-435b1c8194ce&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TYPE=&quot;swap&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_root:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  UUID=&quot;e9fe20ee-5d6f-4610-98ca-7cbed5d012ad&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TYPE=&quot;ext4&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/mapper/VolGroup-lv_home:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  UUID=&quot;43578ba0-a809-4274-931d-b92f881196ad&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TYPE=&quot;ext4&quot;</span></span></code></pre></div><p><code>-s </code>参数指定可以指定分隔符. 默认是空格</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -E</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;sshd|qemu&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/passwd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> column</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sshd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  74</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   74</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Privilege-separated</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SSH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /var/empty/sshd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /sbin/nologin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qemu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  107</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  107</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  qemu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                /</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                /sbin/nologin</span></span></code></pre></div><h2 id="_21-通过pid查看进程的环境变量信息" tabindex="-1">21. 通过pid查看进程的环境变量信息 <a class="header-anchor" href="#_21-通过pid查看进程的环境变量信息" aria-label="Permalink to &quot;21. 通过pid查看进程的环境变量信息&quot;">​</a></h2><p>使用strings, 可以格式化打印</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strings</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/1158/environ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LANG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">en_US.UTF-8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NOTIFY_SOCKET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/run/systemd/notify</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SSH_USE_STRONG_RNG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span></span></code></pre></div><h2 id="_22-通过pid查看进程对应可执行文件的绝对路径" tabindex="-1">22. 通过pid查看进程对应可执行文件的绝对路径 <a class="header-anchor" href="#_22-通过pid查看进程对应可执行文件的绝对路径" aria-label="Permalink to &quot;22. 通过pid查看进程对应可执行文件的绝对路径&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readlink</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/[pid]/exe</span></span></code></pre></div><h2 id="_23-通过pid查看进程的当前工作目录" tabindex="-1">23. 通过pid查看进程的当前工作目录 <a class="header-anchor" href="#_23-通过pid查看进程的当前工作目录" aria-label="Permalink to &quot;23. 通过pid查看进程的当前工作目录&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pwdx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [pid]</span></span></code></pre></div><h2 id="_24-lsof-一切皆文件" tabindex="-1">24. lsof 一切皆文件 <a class="header-anchor" href="#_24-lsof-一切皆文件" aria-label="Permalink to &quot;24. lsof 一切皆文件&quot;">​</a></h2><p><code>-p [PID]</code> 只显示该进程打开的所有文件. 不带参数显示所有已打开的文件<br><code>-d</code> 对<code>FD</code>有效, 用于筛选文件列表. <code>^txt</code> 显示除txt 其他所有类型的文件. <code>1</code> 显示所有fd为1的文件. 可以使用<code>,</code>逗号连接多个选择<br><code>-a</code> 表示两个参数都必须满足 (AND)。如果没有 -a 标志，缺省的情况是显示匹配任何一个参数 (OR) 的文件<br><code>-n</code> 阻止网络地址转换<br><code>-P</code> 阻止端口号到端口名的转换<br><code>-i protocol:@ip:port</code> protocol 包括 tcp 和 udp. 显示符合该地址的文件列表 <code>-u s</code> s为用户名或者用户ID, 选择该用户下的文件</p><p><code>lsof [name]</code><br> name是 mount point或者文件系统对应的设备文件, 则显示在该文件系统上打开的所有文件列表<br> name是 文件夹(非mount point), 则显示所有将该文件夹作为正常文件打开的列表. 例如 cwd, rtd. 如果 <code>+d</code> 打印所有在该目录下已打开的文件,但不递归查找子目录. <code>+D </code>则允许递归查找</p><p>谁在使用 /var/log/audit/audit.log</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lsof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/audit/audit.log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> USER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   FD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVICE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SIZE/OFF</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   NODE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NAME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auditd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  669</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    5w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  2027785</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 524474</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/audit/audit.log</span></span></code></pre></div><p>显示文件系统<code>/</code>下所有已打开的文件列表. 和<code>fuser /</code>效果一样</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lsof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span></span></code></pre></div><p>所有在/var下已打开的文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lsof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/spool/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    USER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   FD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVICE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SIZE/OFF</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   NODE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NAME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1297</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     4096</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 524402</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/spool/postfix</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1297</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   10uW</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       33</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 524591</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/spool/postfix/pid/master.pid</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qmgr</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1301</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> postfix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     4096</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 524402</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/spool/postfix</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pickup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  4178</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> postfix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     4096</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 524402</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/spool/postfix</span></span></code></pre></div><p>列出tcpdump这个用户打开的所有文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lsof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    USER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   FD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVICE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SIZE/OFF</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    NODE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NAME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     4096</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2752513</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  rtd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     4096</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   929928</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1323976</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/sbin/tcpdump</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    62184</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1328951</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/libnss_files-2.17.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    0,7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           231120</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> socket:[231120]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (stat: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">No</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> such</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    90664</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1311459</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/libz.so.1.2.7</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    19776</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1328757</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/libdl-2.17.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  2127336</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1314561</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/libc-2.17.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   266496</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1312167</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/libpcap.so.1.5.3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  2512448</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1312014</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/libcrypto.so.1.0.2k</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    23968</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1311919</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/libcap-ng.so.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   164264</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1311451</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/ld-2.17.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    0u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CHR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  136,1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      0t0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/pts/1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    1u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CHR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  136,1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      0t0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/pts/1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    2u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CHR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  136,1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      0t0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/pts/1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    3u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  pack</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 231120</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      0t0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     ALL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type=SOCK_RAW</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17905</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    4w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   REG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  253,1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   864256</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2756467</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/abc2</span></span></code></pre></div><h2 id="_25-fuser-查找访问文件系统的进程" tabindex="-1">25. fuser 查找访问文件系统的进程 <a class="header-anchor" href="#_25-fuser-查找访问文件系统的进程" aria-label="Permalink to &quot;25. fuser 查找访问文件系统的进程&quot;">​</a></h2><p><code>-v</code> 显示具体的进程名和用户</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fuser</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                     USER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ACCESS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMAND</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                   root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                     root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .rc..</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                     root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .rc..</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kthreadd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                     root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .rc..</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ksoftirqd/0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                     root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .rc..</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kworker/0:0H</span></span></code></pre></div><p><code>-k</code> kill掉访问该文件系统的所有进程.慎用. 先使用上述命令查询</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fuser</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span></span></code></pre></div><h2 id="_26-dd-测试磁盘或者文件读写" tabindex="-1">26. dd 测试磁盘或者文件读写 <a class="header-anchor" href="#_26-dd-测试磁盘或者文件读写" aria-label="Permalink to &quot;26. dd 测试磁盘或者文件读写&quot;">​</a></h2><p>高危命令, <code>of</code>一定要指向正确的文件, 不要指 <code>/</code>, <code>/dev/vda</code>, <code>/dev/vda1</code>等系统重要设备.<br> 该命令要在测试环境验证充分.<br><code>if</code> 表示从哪个设备/文件读<br><code>of</code> 表示写到哪个设备/文件<br><code>bs</code> 表示一次读写多少字节. 也可以使用 1K, 1M这样带单位的<br><code>count</code> 表示最多读写多少次. 总的读写量为 <code>bs * count</code><br><code>/dev/zero</code> 可以无限读取<code>\\0</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> if=/dev/zero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of=/tmp/abc.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bs=1M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span></code></pre></div><h2 id="_27-rpm-安装-更新-卸载软件包" tabindex="-1">27. rpm 安装/更新/卸载软件包 <a class="header-anchor" href="#_27-rpm-安装-更新-卸载软件包" aria-label="Permalink to &quot;27. rpm 安装/更新/卸载软件包&quot;">​</a></h2><p>查询系统已安装的所有软件包</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qa</span></span></code></pre></div><p>查询某个文件所属的软件包名. 文件必须是绝对路径</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ssh/sshd_config</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">which</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strace\`</span></span></code></pre></div><p>查询包所含有的文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strace</span></span></code></pre></div><p>查询包里的配置文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssh-server</span></span></code></pre></div><p>查询包里的文档</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssh-server</span></span></code></pre></div><p>查询软件包里的脚本信息</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --scripts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssh-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preinstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scriptlet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (using </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/bin/sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> groupadd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 74</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> passwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  useradd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Privilege-separated SSH&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 74</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /sbin/nologin</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/empty/sshd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postinstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scriptlet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (using </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/bin/sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -eq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] ; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Initial installation</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> preset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd.socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preuninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scriptlet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (using </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/bin/sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -eq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] ; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Package removal, not upgrade</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd.socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd.socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postuninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scriptlet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (using </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/bin/sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> daemon-reload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -ge</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] ; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Package upgrade, not uninstall</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> try-restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd.service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fi</span></span></code></pre></div><p>查询包,自定义输出的格式和地段</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --queryformat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%-35{NAME} %{VERSION} %{RELEASE} %{INSTALLTIME:date}\\n&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jzlib</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                               1.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 6.el7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Thu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 27</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11:30:01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HKT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                 3.36.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 7.1.el7_6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11:13:42</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HKT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hamcrest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                            1.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 6.el7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Thu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 27</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11:30:01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HKT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dhcp-libs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                           4.2.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 68.el7.centos.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11:13:43</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HKT</span></span></code></pre></div><p>查询当前包的changelog. 常用于查看已解决的CVE列表</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --changelog</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssh-server</span></span></code></pre></div><p>查询包所能提供的CAPABILITY</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --provides</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> glibc</span></span></code></pre></div><p>查询哪些包依赖某个CAPABILITY</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --whatrequires</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [CAPABILITY]</span></span></code></pre></div><p>查询包所依赖的CAPABILITY</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> glibc</span></span></code></pre></div><p>查询包所有提供的CAPABILITY</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --whatprovides</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [CAPABILITY]</span></span></code></pre></div><p>校验当前包与原始状态的差别.<br> 5 -- MD5 校验和<br> S -- 文件长度<br> L -- 符号链接<br> T -- 文件修改日期<br> D -- 设备<br> U -- 用户<br> G -- 用户组<br> M -- 模式 (包含许可和文件类型)<br> ? -- 不可读文件<br> 如下标志文件的md5, 文件长度, 修改日志有变化</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -V</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssh-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S.5....T.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ssh/sshd_config</span></span></code></pre></div><p>安装本地包 <code>-vh</code> 获得一个详细的安装进程 <code>--nodeps</code> 忽略依赖关系</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ivh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.rpm</span></span></code></pre></div><p>卸载包</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.rpm</span></span></code></pre></div><p>升级包</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Uvh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.rpm</span></span></code></pre></div><p>查询本地包的信息,要加<code>-p</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.rpm</span></span></code></pre></div><h2 id="_28-yum-安装-更新-卸载软件包" tabindex="-1">28. yum 安装/更新/卸载软件包 <a class="header-anchor" href="#_28-yum-安装-更新-卸载软件包" aria-label="Permalink to &quot;28. yum 安装/更新/卸载软件包&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #安装软件包a   (加上-y选项，可以在安装软件包时，不弹出是否继续的提示)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --downloadonly</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --downloaddir=/xxx</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #只下载,不安装.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reinstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #重装</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #卸载软件包a</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> groups</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #查看已安装的软件组和可用的软件组</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> groups</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Basic Web Server&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #安装软件组</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> groups</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Basic Web Server&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      #卸载软件组</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #查看软件包a的相关信息，如大小，版本等...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #更新软件包a</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #整体更新所有可更新的软件包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> provides</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 文件或目录</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #查看文件由哪个rpm包提供的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> search</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tree</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #从仓库中搜索关键词为tree的包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> history</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              #查看yum运行历史记录</span></span></code></pre></div><blockquote><p>查找某个文件属于哪个包的方法有:<br> 如果文件已经安装在本机, 则<code>rpm -qf xxx</code><br> 如果文件没有在本机安装, 则<code>yum provides XXX</code> XXX 可以是文件名, 也可以使用glob这样的通配符去查找<br> 比如安装某rpm包, 提示文件没找到, 则可以使用 <code>yum provices xxx</code>. 比如文件名为 abc.txt, 用<code>yum provides *abc.txt</code>去查找</p></blockquote><p>查询当前在repo里指定包的所有可用版本, 可用于升级到特定版本. <code>yum update systemd</code>默认升级到最新版</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --showduplicates</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Installed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemd.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  219-42.el7_4.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  @updates</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Available</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemd.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  219-42.el7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      base</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemd.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  219-42.el7_4.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  updates</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemd.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  219-42.el7_4.4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  updates</span></span></code></pre></div><p>升级指定包到特定的版本</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd-219-42.el7_4.4</span></span></code></pre></div><p>具体查看某次事务中安装,更新,删除的包列表</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 307</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Loaded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> plugins:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auto-update-debuginfo,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fastestmirror</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Transaction</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 307</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Begin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Sat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 20:24:11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2017</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Begin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpmdb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 700:b36eb7acc22b3ab4b107097d0b740dc6bfd84a58</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">End</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            20:24:12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2017</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (1 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">seconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">End</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpmdb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 701:df2089f95d28d6f1f19561b39352bf3dd7a98c75</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">roo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Return-Code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Success</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Line</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qemu-kvm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Transaction</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> performed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> with:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Installed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     rpm-4.11.3-25.el7.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      @base</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Installed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     yum-3.4.3-154.el7.centos.noarch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               @base</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Installed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     yum-plugin-fastestmirror-1.1.31-42.el7.noarch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @base</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Packages</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Altered:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Updated</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qemu-img-10:1.5.3-141.el7_4.2.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        @updates</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           10:1.5.3-141.el7_4.4.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        @updates</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qemu-kvm-10:1.5.3-141.el7_4.4.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        @updates</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Updated</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qemu-kvm-common-10:1.5.3-141.el7_4.2.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @updates</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  10:1.5.3-141.el7_4.4.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @updates</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span></span></code></pre></div><p>查询某个软件包的所有历史变更记录</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cloud-init</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Loaded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> plugins:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auto-update-debuginfo,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fastestmirror</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> line</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Action(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Altered</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-------------------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   312</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> erase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2018-01-11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 00:07</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Erase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   311</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2018-01-11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 00:01</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Install</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   310</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> erase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2017-12-10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 19:50</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Erase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   309</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2017-12-10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 18:52</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Install</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   306</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> erase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2017-12-09</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 13:09</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Erase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   301</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloud-init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2017-10-14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11:49</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Install</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    5</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span></code></pre></div><p>查询包的依赖关系</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deplist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strace</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">package:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strace.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4.12-4.el7</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dependency:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   provider:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4.2.46-29.el7_4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dependency:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libc.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GLIBC_2.15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">64bit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   provider:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> glibc.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2.17-196.el7_4.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dependency:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libgcc_s.so.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">64bit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   provider:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libgcc.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4.8.5-16.el7_4.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dependency:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libgcc_s.so.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GCC_3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">64bit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   provider:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libgcc.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4.8.5-16.el7_4.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dependency:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libgcc_s.so.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GCC_3.3.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">64bit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   provider:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libgcc.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4.8.5-16.el7_4.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dependency:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rtld</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GNU_HASH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   provider:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> glibc.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2.17-196.el7_4.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   provider:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> glibc.i686</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2.17-196.el7_4.2</span></span></code></pre></div><h2 id="_29-解压缩命令" tabindex="-1">29. 解压缩命令 <a class="header-anchor" href="#_29-解压缩命令" aria-label="Permalink to &quot;29. 解压缩命令&quot;">​</a></h2><p>tar.gz</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -xzvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.tar.gz</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #解压缩</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -xzvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.tar.gz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /path</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      #解压缩到制动的path目录下</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tzvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.tar.gz</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #不解压,只查看文件列表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -czvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b.txt</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   #将 a.txt 和 b.txt 压缩为 abc.tar.gz</span></span></code></pre></div><p>.gz</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gzip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.gz</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      #解压</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gzip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #压缩</span></span></code></pre></div><p>.bz .bz2</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bzip2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.bz2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #解压</span></span></code></pre></div><p>.tar.bz .tar.bz2</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.tar.bz2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #解压</span></span></code></pre></div><p>.Z</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uncompress</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.Z</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #解压</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compress</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #压缩</span></span></code></pre></div><p>.zip</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unzip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.zip</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       #解压</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.zip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DirName</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #压缩</span></span></code></pre></div><p>.rar</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.rar</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                #解压</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.rar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DirName</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #压缩</span></span></code></pre></div><p>.rpm</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm2cpio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.rpm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cpio</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -div</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   #解包</span></span></code></pre></div><p>.deb</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FileName.deb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data.tar.gz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -xzvf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #解包</span></span></code></pre></div><h2 id="_30-systemd-管理命令" tabindex="-1">30. systemd 管理命令 <a class="header-anchor" href="#_30-systemd-管理命令" aria-label="Permalink to &quot;30. systemd 管理命令&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> help</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #列出所有的单元类型</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;unit&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         #查看指定单元类型的状况, 替换 unit 为 &quot;mount&quot;, &quot;service&quot;, &quot;socket&quot;等</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --failed</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              #查看所有加载失败的单元信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           #查看sshd服务单元状况</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #启动sshd服务单元</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #停止sshd服务单元</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #重启sshd服务单元</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           #配置sshd服务单元开机自动启动</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #配置sshd服务单元开机不启动</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           #重新加载sshd服务单元的配置文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mask</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #彻底屏蔽sshd服务单元</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unmask</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           #取消屏蔽sshd服务单元</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-units</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #列出当前所有的单元, 这是 systemctl 的默认命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get-default</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           #查看系统默认启动的Target</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multi-user.target</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 设置系统默认的target为 多用户模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-dependencies</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multi-user.target</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #查看该target下所有的unit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-dependencies</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 查看一个service所依赖的所有unit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-dependencies</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reverse</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 查看哪个unit依赖该服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-dependencies</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --before</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 查看所有unit after sshd, 也就是 sshd 配置里的before=</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-dependencies</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --after</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 查看所有unit before sshd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              #查看service的配置文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> show</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #查看service的配置参数, 不带 service则显示默认的配置. 可用来查询nofile, noproc等限制资源参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-jobs</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #查看有哪些job仍在运行或者等待运行</span></span></code></pre></div><blockquote><p>/etc/security/limits.conf无法设置systemd服务的资源限制. 参见:<br><a href="http://smilejay.com/2016/06/centos-7-systemd-conf-limits/" target="_blank" rel="noreferrer">http://smilejay.com/2016/06/centos-7-systemd-conf-limits/</a></p></blockquote><p>列出当前旧的LSB脚本</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LSB</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  network.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       loaded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> active</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   LSB:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Bring</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up/down</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> networking</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  prl-x11.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       loaded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> active</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exited</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    LSB:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Autostart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> script</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Parallels</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  prltoolsd.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     loaded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> active</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   LSB:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Autostart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> script</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> guest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tools</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service.</span></span></code></pre></div><p>查询systemd 版本</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 219</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+PAM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +AUDIT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +SELINUX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +IMA</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -APPARMOR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +SMACK</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +SYSVINIT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +UTMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +LIBCRYPTSETUP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +GCRYPT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +GNUTLS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +ACL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +XZ</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -LZ4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -SECCOMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +BLKID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +ELFUTILS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +KMOD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +IDN</span></span></code></pre></div><p>查看启动耗时</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd-analyze</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Startup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> finished</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 579ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (kernel) + 2.964s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">initrd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) + 8.899s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">userspace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) = 12.442s</span></span></code></pre></div><p>查看每个服务的启动耗时,并打印TOP5</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd-analyze</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> blame</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          4.949s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NetworkManager-wait-online.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          3.379s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           987ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> postfix.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           656ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev-mapper-VolGroup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2dlv_root.device</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           591ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lvm2-monitor.service</span></span></code></pre></div><p>打印最耗时的一条启动链, 后面跟指定的service, 则打印该服务的启动链</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd-analyze</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> critical-chain</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> active</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> started</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> printed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> character.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> takes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> printed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;+&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> character.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multi-user.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @8.863s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└─postfix.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @7.864s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +987ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  └─network.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @7.856s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    └─NetworkManager.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @2.459s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +64ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      └─network-pre.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @2.458s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        └─firewalld.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.934s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +523ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          └─polkit.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.724s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +203ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            └─basic.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.721s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">              └─sockets.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.721s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                └─iscsiuio.socket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.721s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                  └─sysinit.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.709s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    └─systemd-update-utmp.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.700s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +8ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                      └─auditd.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.426s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +272ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                        └─systemd-tmpfiles-setup.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.358s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +58ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                          └─rhel-import-state.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.303s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +52ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                            └─local-fs.target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.299s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                              └─home.mount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.283s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +15ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                └─systemd-fsck@dev-mapper-VolGroup\\x2dlv_home.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.266s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +14ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                  └─dev-mapper-VolGroup\\x2dlv_home.device</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @1.265s</span></span></code></pre></div><p>生成启动瀑布图, 使用chrome浏览器打开 a.svg. 分析启动性能更加直观</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemd-analyze</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> plot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">a.svg</span></span></code></pre></div><p>启动瀑布图<br><img src="`+n+`" alt="启动瀑布图"></p><p>journalctl 相关操作</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                       # 查看所有日志（默认情况下 ，显示所有可以查看的日志）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    # 查看内核日志（不显示应用日志）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    # 查看系统本次启动的日志                 </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 # 查看上一次启动的日志（需更改设置）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               # 实时滚动显示最新日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib/systemd/systemd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查看指定可执行文件的日志, 必须指定绝对路径</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> _PID=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 查看指定进程的日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sshd</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               # 查看某个 Unit 的日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --disk-usage</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # 显示日志占据的硬盘空间</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --list-boots</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # 显示每次启动的id和时间</span></span></code></pre></div><p>查看指定时间的日志</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2012-10-30 18:17:16&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2020-10-01&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;20 min ago&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;-5m&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;-5d&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yesterday</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2015-01-10&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --until</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2015-01-11 03:00&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 09:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --until</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;1 hour ago&quot;</span></span></code></pre></div><p>时间格式可参考<code>man journalctl</code>或者<code>man 7 systemd.time</code></p><h2 id="_31-ubuntu-debian-检查已经安装好的软件包的更新日志" tabindex="-1">31. Ubuntu/Debian 检查已经安装好的软件包的更新日志 <a class="header-anchor" href="#_31-ubuntu-debian-检查已经安装好的软件包的更新日志" aria-label="Permalink to &quot;31. Ubuntu/Debian 检查已经安装好的软件包的更新日志&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zless</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/doc/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">package</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">/changelog.Debian.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zless</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/doc/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">package</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">/changelog.gz</span></span></code></pre></div><h2 id="_32-搜索含有指定字符的手册页" tabindex="-1">32. 搜索含有指定字符的手册页 <a class="header-anchor" href="#_32-搜索含有指定字符的手册页" aria-label="Permalink to &quot;32. 搜索含有指定字符的手册页&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> man</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logrotate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dh_installlogrotate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (1) - install logrotate config files</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">logrotate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (8) - rotates, compresses, and mails system logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">logrotate.conf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (5) - rotates, compresses, and mails system logs</span></span></code></pre></div><h2 id="_33-快速删除大量小文件" tabindex="-1">33. 快速删除大量小文件 <a class="header-anchor" href="#_33-快速删除大量小文件" aria-label="Permalink to &quot;33. 快速删除大量小文件&quot;">​</a></h2><p>使用<code>rsync</code>, 速度快但占用大量IO, 业务量低时使用. 高危命令</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> empty_dir</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> empty_dir/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    yourdirectory/</span></span></code></pre></div><p>使用<code>find</code>, 速度慢但消耗IO少. <code>rm</code>会遇到<code>Argument list too long</code>报错</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      #删除/tmp目录下所有文件</span></span></code></pre></div><h2 id="_34-sysctl-管理系统参数" tabindex="-1">34. sysctl 管理系统参数 <a class="header-anchor" href="#_34-sysctl-管理系统参数" aria-label="Permalink to &quot;34. sysctl 管理系统参数&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                       #打印当前参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net.ipv4.tcp_fin_timeout=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           #实时更新一个系统参数, 高危. 要验证好</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                       #读取/etc/sysctl.conf和 /etc/sysctl.d/下配置文件信息,使其生效</span></span></code></pre></div><h2 id="_35-清空文件内容" tabindex="-1">35. 清空文件内容 <a class="header-anchor" href="#_35-清空文件内容" aria-label="Permalink to &quot;35. 清空文件内容&quot;">​</a></h2><p>假设文件名为 abc.txt, 以下方法都可以清空该文件的内容</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> abc.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.txt</span></span></code></pre></div><h2 id="_36-查询系统调用" tabindex="-1">36. 查询系统调用 <a class="header-anchor" href="#_36-查询系统调用" aria-label="Permalink to &quot;36. 查询系统调用&quot;">​</a></h2><p>跟踪命令<code>ls -rlt</code>的系统调用, 将信息输出到<code>a.txt</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ftT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rlt</span></span></code></pre></div><p>统计命令进行的系统调用信息</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span></code></pre></div><p>跟踪具体的进程</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [pid]</span></span></code></pre></div><p>过滤系统调用</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trace=open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strace</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trace=open,write</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span></code></pre></div><h2 id="_37-查看磁盘uuid和文件系统类型" tabindex="-1">37. 查看磁盘uuid和文件系统类型 <a class="header-anchor" href="#_37-查看磁盘uuid和文件系统类型" aria-label="Permalink to &quot;37. 查看磁盘uuid和文件系统类型&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lsblk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   FSTYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LABEL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UUID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                 MOUNTPOINT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vda</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└─vda1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ext3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         32236b41-fcde-460e-8c34-ba50515b33f2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> blkid</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/vda1:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UUID=&quot;32236b41-fcde-460e-8c34-ba50515b33f2&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TYPE=&quot;ext3&quot;</span></span></code></pre></div><h2 id="_38-创建软连接" tabindex="-1">38. 创建软连接 <a class="header-anchor" href="#_38-创建软连接" aria-label="Permalink to &quot;38. 创建软连接&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> regular_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> softlink</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          创建软连接</span></span></code></pre></div><h2 id="_39-history查看历史记录" tabindex="-1">39. history查看历史记录 <a class="header-anchor" href="#_39-history查看历史记录" aria-label="Permalink to &quot;39. history查看历史记录&quot;">​</a></h2><p>如果直接执行<code>history</code>没有显示时间戳,可以使用下面的命令</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HISTTIMEFORMAT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;%d/%m/%y %T&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">history</span></span></code></pre></div><h2 id="_40-查看进程的父子调用关系" tabindex="-1">40. 查看进程的父子调用关系 <a class="header-anchor" href="#_40-查看进程的父子调用关系" aria-label="Permalink to &quot;40. 查看进程的父子调用关系&quot;">​</a></h2><p><code>-p</code> 显示pid信息. {}表示线程</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pstree</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemd(1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)─┬─agetty(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1176</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           ├─auditd(669</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)───{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auditd}(670</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           ├─avahi-daemon(701</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)───avahi-daemon(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">720</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           ├─chronyd(721</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           ├─crond(1169</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           ├─dbus-daemon(702</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)───{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dbus-daemon}(730</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           ├─dhclient(4673</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           ├─dnsmasq(1344</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)───dnsmasq(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1345</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           ├─firewalld(776</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)───{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewalld}(952</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           ├─gssproxy(714</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)─┬─{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gssproxy}(724</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           │</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               ├─{gssproxy}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">725</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           │</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               ├─{gssproxy}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">726</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           │</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               ├─{gssproxy}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">727</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           │</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               └─{gssproxy}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">728</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="_41-rsync文件" tabindex="-1">41. rsync文件 <a class="header-anchor" href="#_41-rsync文件" aria-label="Permalink to &quot;41. rsync文件&quot;">​</a></h2><p>rsync [OPTION]... SRC [SRC]... DEST<br> 在指定复制源时，路径是否有最后的 “/” 有不同的含义，例如：<br> /data ：表示将整个 /data 目录复制到目标目录<br> /data/ ：表示将 /data/ 目录中的所有内容复制到目标目录<br><code>--stats</code> : 输出文件传输的状态<br><code>--progress</code> : 输出文件传输的进度<br><code>-a</code>归档模式, 递归且保留符号链接，保留权限信息，时间戳，以及owner,group信息<br><code>-z</code> 打开压缩功能<br><code>-v</code> verbose更多打印信息<br> 本地同步</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -azv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/opt/installation/inventory/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/temp/</span></span></code></pre></div><p>从本地到远端</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -avz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/temp/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> thegeekstuff@192.168.200.10:/home/thegeekstuff/temp/</span></span></code></pre></div><h2 id="_42-查询的动态库链接信息" tabindex="-1">42. 查询的动态库链接信息 <a class="header-anchor" href="#_42-查询的动态库链接信息" aria-label="Permalink to &quot;42. 查询的动态库链接信息&quot;">​</a></h2><p>查询python这个程序依赖的所有动态库</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ldd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">which</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python\`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	linux-vdso.so.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (0x00007fffb1fb4000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	libpython2.7.so.1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /lib64/libpython2.7.so.1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (0x00007f5dee201000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	libpthread.so.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /lib64/libpthread.so.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (0x00007f5dedfe5000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	libdl.so.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /lib64/libdl.so.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (0x00007f5dedde0000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	libutil.so.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /lib64/libutil.so.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (0x00007f5dedbdd000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	libm.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /lib64/libm.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (0x00007f5ded8db000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	libc.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /lib64/libc.so.6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (0x00007f5ded517000)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	/lib64/ld-linux-x86-64.so.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (0x0000561b940b0000)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@linux /tmp/new_folder]#</span></span></code></pre></div><h2 id="_43-查询ascii编码表" tabindex="-1">43. 查询ascii编码表 <a class="header-anchor" href="#_43-查询ascii编码表" aria-label="Permalink to &quot;43. 查询ascii编码表&quot;">​</a></h2><p>速查编码信息</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">man</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ascii</span></span></code></pre></div><h2 id="_44-iptable-内置防火墙" tabindex="-1">44. iptable 内置防火墙 <a class="header-anchor" href="#_44-iptable-内置防火墙" aria-label="Permalink to &quot;44. iptable 内置防火墙&quot;">​</a></h2><p>iptables内置了4个表，即raw表、filter表、nat表和mangle表，默认操作filter表.</p><p>规则表之间的优先顺序如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>     Raw      --&gt;    mangle       -&gt;        nat    --&gt;      filter</span></span>
<span class="line"><span>prerouting          prerouting          prerouting        input</span></span>
<span class="line"><span>output              postrouting         postrouting       output</span></span>
<span class="line"><span>                    input               output            forward</span></span>
<span class="line"><span>                    output</span></span>
<span class="line"><span>                    forward</span></span></code></pre></div><p>查询表中的规则,当时打印匹配该规则的包和字节数</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nvL</span></span></code></pre></div><p><code>REJECT</code> 拦阻该数据包，并返回数据包通知对方，可以返回的数据包有几个选择：ICMP port-unreachable、ICMP echo-reply 或是tcp-reset（这个数据包包会要求对方关闭联机），进行完此处理动作后，将不再比对其它规则，直接中断过滤程序。 范例如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TCP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> REJECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reject-with</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ICMP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo-reply</span></span></code></pre></div><p><code>DROP</code> 丢弃数据包不予处理，进行完此处理动作后，将不再比对其它规则，直接中断过滤程序。 <code>REDIRECT</code> 将封包重新导向到另一个端口（PNAT），进行完此处理动作后，将会继续比对其它规则。这个功能可以用来实作透明代理 或用来保护web 服务器。例如：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PREROUTING</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> REDIRECT--to-ports</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8081</span></span></code></pre></div><p><code>MASQUERADE</code> 改写封包来源IP为防火墙的IP，可以指定port 对应的范围，进行完此处理动作后，直接跳往下一个规则链（mangle:postrouting）。这个功能与SNAT略有不同，当进行IP 伪装时，不需指定要伪装成哪个 IP，IP 会从网卡直接读取，当使用拨接连线时，IP 通常是由ISP公司的DHCP服务器指派的，这个时候MASQUERADE特别有用。范例如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POSTROUTING</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TCP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MASQUERADE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --to-ports</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 21000-31000</span></span></code></pre></div><p><code>LOG</code> 将数据包相关信息纪录在 /var/log 中，详细位置请查阅 /etc/syslog.conf 配置文件，进行完此处理动作后，将会继续比对其它规则。例如：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LOG</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --log-prefix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;input packet&quot;</span></span></code></pre></div><p><code>SNAT</code> 改写封包来源IP为某特定IP或IP范围，可以指定port对应的范围，进行完此处理动作后，将直接跳往下一个规则炼（mangle:postrouting）.范例如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POSTROUTING</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SNAT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --to-source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.10.15-192.168.10.160:2100-3200</span></span></code></pre></div><p><code>DNAT</code> 改写数据包包目的地 IP 为某特定 IP 或 IP 范围，可以指定 port 对应的范围，进行完此处理动作后，将会直接跳往下一个规则链（filter:input 或 filter:forward）。范例如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PREROUTING</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 15.45.23.67</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DNAT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --to-destination</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.10.1-192.168.10.10:80-100</span></span></code></pre></div><p><code>MIRROR</code> 镜像数据包，也就是将来源 IP与目的地IP对调后，将数据包返回，进行完此处理动作后，将会中断过滤程序。 <code>QUEUE</code> 中断过滤程序，将封包放入队列，交给其它程序处理。透过自行开发的处理程序，可以进行其它应用，例如：计算联机费用.......等。 <code>RETURN</code> 结束在目前规则链中的过滤程序，返回主规则链继续过滤，如果把自订规则炼看成是一个子程序，那么这个动作，就相当于提早结束子程序并返回到主程序中。 <code>MARK</code> 将封包标上某个代号，以便提供作为后续过滤的条件判断依据，进行完此处理动作后，将会继续比对其它规则。范例如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mangle</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PREROUTING</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MARK</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set-mark</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span></span></code></pre></div><p>清空iptables规则</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># set ACCEPT for default action</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -P</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INPUT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -P</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FORWARD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -P</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OUTPUT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># flush all chains</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># delete all  user-defined chains</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span></span></code></pre></div><p>丢弃TCP访问21端口的包</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 21</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DROP</span></span></code></pre></div><p>加<code>--line-numbers</code>参数可以打印规则序号. 删除时用</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nvL</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --line-numbers</span></span></code></pre></div><p>删除INPUT链里的第三个规则</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span></code></pre></div><p><a href="https://blog.csdn.net/htmlxx/article/details/51412750" target="_blank" rel="noreferrer">https://blog.csdn.net/htmlxx/article/details/51412750</a><br> 这里记录了一些常用的iptables规则操作</p><h2 id="_45-tcpdump-抓包" tabindex="-1">45. tcpdump 抓包 <a class="header-anchor" href="#_45-tcpdump-抓包" aria-label="Permalink to &quot;45. tcpdump 抓包&quot;">​</a></h2><p>常用表达式:<br> 非 : ! or &quot;not&quot; (去掉双引号)<br> 且 : &amp;&amp; or &quot;and&quot;<br> 或 : || or &quot;or&quot;<br><code>-nn</code> 不转换地址和端口号 <code>-v</code> 打印详情</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nnv</span></span></code></pre></div><p>抓取所有经过eth1，地址是192.168.1.1且端口号为25的所有包</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 25</span></span></code></pre></div><p>-c count 抓取指定数目的包后退出</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span></span></code></pre></div><p>-C file_size 循环抓包,当文件达到指定的大小后,将包写入到新文件.举例如下:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rlt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-rw-r--r--.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1001078</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Jan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 23:33</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-rw-r--r--.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  647168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Jan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 23:33</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc1</span></span></code></pre></div><p>抓取本机eth0网卡发往公网ip的数据包</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcpdump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;not net 10.0.0.0/8 and not net 192.168.0.0/16 and not net 172.16.0.0/12&#39;</span></span></code></pre></div><h2 id="_46-dns查询工具" tabindex="-1">46. DNS查询工具 <a class="header-anchor" href="#_46-dns查询工具" aria-label="Permalink to &quot;46. DNS查询工具&quot;">​</a></h2><p>指定DNS服务器递归查</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dig</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.baidu.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @8.8.8.8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&gt;&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DiG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 9.9.4-RedHat-9.9.4-51.el7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&gt;&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> www.baidu.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @8.8.8.8</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; global options: +cmd</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; Got answer:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 4712</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; OPT PSEUDOSECTION:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">; EDNS: version: 0, flags:; udp: 512</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; QUESTION SECTION:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;www.baidu.com.			IN	A</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; ANSWER SECTION:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">www.baidu.com.		1043	IN	CNAME	www.a.shifen.com.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">www.a.shifen.com.	218	IN	A	220.181.112.244</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">www.a.shifen.com.	218	IN	A	220.181.111.188</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; Query time: 78 msec</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; SERVER: 8.8.8.8#53(8.8.8.8)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; WHEN: Mon Jan 15 00:03:09 HKT 2018</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;; MSG SIZE  rcvd: 101</span></span></code></pre></div><p>反解析</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 74.125.135.105</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">QUESTION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SECTION:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">105.135.125.74.in-addr.arpa.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   IN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      PTR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ANSWER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SECTION:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">105.135.125.74.in-addr.arpa.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 83205</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> IN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PTR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     ni-in-f105.1e100.net.</span></span></code></pre></div><p>全过程迭代跟踪</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dig</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +trace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.baidu.com</span></span></code></pre></div><h2 id="_47-ntp时间同步" tabindex="-1">47. NTP时间同步 <a class="header-anchor" href="#_47-ntp时间同步" aria-label="Permalink to &quot;47. NTP时间同步&quot;">​</a></h2><p>ntpdate 手工校准时间, 加 <code>-q</code> 只查询, 不同步时间, 加 <code>-d</code> 打开Debug模式, 但不真正更新时间</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ntpdate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ntp1.aliyun.com</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">15</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Jan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 23:18:51</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ntpdate[18981]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> adjust</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 182.92.12.11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> offset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.000643</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sec</span></span></code></pre></div><p>安装<code>ntpd</code>时查询ntp同步状态的命令为<code>ntpq -p</code><br> 如果使用<code>chronyd</code>(centos7默认)是命令为<code>chronyc sources -v</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chronyc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sources</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">210</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sources</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  .--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;^&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;=&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> peer,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;#&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clock.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;*&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> current</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> synced,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;+&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> combined</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;-&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> combined,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   &#39;?&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unreachable,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;x&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> may</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> be</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> error,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;~&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> too</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> variable.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                                 .-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxxx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yyyy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +/-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zzzz</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      Reachability</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (octal) -.           </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  xxxx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> adjusted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> offset,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      Log2(Polling</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) --.      </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  yyyy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> measured</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> offset,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                \\</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  zzzz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> estimated</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> error.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           \\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name/IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Stratum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Poll</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Reach</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LastRx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Last</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sample</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">===============================================================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">^*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time5.aliyun.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    37</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    41</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  +2394ns[+1057us]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +/-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   15ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">^-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120.25.115.19</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    37</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    40</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -2559us[-2559us]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +/-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   67ms</span></span></code></pre></div><h2 id="_48-netstat查询网络连接信息" tabindex="-1">48. netstat查询网络连接信息 <a class="header-anchor" href="#_48-netstat查询网络连接信息" aria-label="Permalink to &quot;48. netstat查询网络连接信息&quot;">​</a></h2><p>查看所有tcp下监听端口, p表示打印相应的进程</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -lntp</span></span></code></pre></div><p>查看所有已经建立的连接</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -antp</span></span></code></pre></div><p>查看路由表</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rn</span></span></code></pre></div><p>查看网络统计信息进程</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span></span></code></pre></div><h2 id="_49-ethtool-网卡查询工具" tabindex="-1">49. ethtool 网卡查询工具 <a class="header-anchor" href="#_49-ethtool-网卡查询工具" aria-label="Permalink to &quot;49. ethtool 网卡查询工具&quot;">​</a></h2><p><code>-i</code> 查网卡驱动信息</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ethtool</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  eth0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">driver:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> virtio_net</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">version:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firmware-version:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expansion-rom-version:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bus-info:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0000:00:05.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supports-statistics:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supports-test:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supports-eeprom-access:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supports-register-dump:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supports-priv-flags:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span></code></pre></div><p>不跟参数,显示速率,全双工模式等信息(虚拟机下没有)<br> Link 为<code>yes</code>表示 网线连接正常</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ethtool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Settings</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	Link</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> detected:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span></code></pre></div><h2 id="_50-ip-网络维护" tabindex="-1">50. ip 网络维护 <a class="header-anchor" href="#_50-ip-网络维护" aria-label="Permalink to &quot;50. ip 网络维护&quot;">​</a></h2><p>启用接口</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ip link set &lt;接口名&gt; up</span></span></code></pre></div><p>禁用接口</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ip link set &lt;接口名&gt; down</span></span></code></pre></div><p>设置接口MAC地址（设置前请先禁用接口）</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ip link set &lt;接口名&gt; address &lt;值&gt;</span></span></code></pre></div><p>设置接口MTU（设置前请先禁用接口） 例：把ens33的MTU改成9000并检查。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># ip link show dev ens33 #修改前</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2: ens33: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast state DOWN mode DEFAULT qlen 1000</span></span>
<span class="line"><span>    link/ether 88:32:9b:ca:3f:49 brd ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span># ip link set ens33 mtu 9000</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ip link show dev ens33  #修改后</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2: ens33: &lt;BROADCAST,MULTICAST&gt; mtu 9000 qdisc pfifo_fast state DOWN mode DEFAULT qlen 1000</span></span>
<span class="line"><span>    link/ether 88:32:9b:ca:3f:49 brd ff:ff:ff:ff:ff:ff</span></span></code></pre></div><p>查看网卡的详细信息, 比如是bridge还是veth等类型</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --details</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  show</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bridge</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #显示所有的桥接设备</span></span></code></pre></div><p>下面脚本可以显示每个链路的类型, 除了以太网</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Arguments: $1: Interface (&#39;grep&#39;-regexp).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Static list of types (from \`ip link help\`):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TYPES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bond</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bond_slave</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bridge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dummy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gre</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gretap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ifb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip6gre</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip6gretap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip6tnl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ipip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ipoib</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ipvlan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> macvlan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> macvtap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nlmon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vcan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> veth</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vlan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vti</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vxlan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">iface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TYPES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> show</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -E</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;^[0-9]+:&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;:&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s|^[[:space:]]*||&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> while</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> read</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> _if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  done</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;^\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">iface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span></code></pre></div><p>查看网卡状态和对应的IP信息</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addr</span></span></code></pre></div><p>给接口eth0赋予地址10.211.55.10 掩码是255.255.255.0(24代表掩码中1的个数)，广播地址是10.211.55.255</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.211.55.10/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span></span></code></pre></div><p>删除eth0上的 10.211.55.10</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> del</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.211.55.10/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span></span></code></pre></div><p>查看路由表信息</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.211.55.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.211.55.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.211.55.9</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">192.168.122.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> virbr0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.122.1</span></span></code></pre></div><p>查询目的地为<code>192.168.1.1</code>时选择的路由情况</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">192.168.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.211.55.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.211.55.9</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cache</span></span></code></pre></div><p>增加默认路由</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20.0.0.1</span></span></code></pre></div><p>策略性路由相对于传统的路由算法主要是引入了多路由表以及规则的概念。<br> 例如一个子网通过一个路由器与外界相连，路由器与外界有两条线路相连，其中一条的速度比较快，一条的速度比较慢。对于子网内的大多数用户来说对速度并没有特殊的要求，所以可以让他们用比较慢的路由；但是子网内有一些特殊的用户却是对速度的要求比较苛刻，所以他们需要使用速度比较快的路由。如果使用一张路由表上述要求是无法实现的，而如果根据源地址或其它参数，对不同的用户使用不同的路由表，这样就可以大大提高路由器的性能。<br> 优先级别越高的规则越先匹配（数值越小优先级别越高）。</p><p>系统内置3张表:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>表255 本地路由表（Local table）本地接口地址，广播地址，已及NAT地址都放在这个表。该路由表由系统自动维护，管理员不能直接修改。</span></span>
<span class="line"><span>表254 主路由表（Main table）如果没有指明路由所属的表，所有的路由都默认都放在这个表里，route）所添加的路由都会加到这个表。</span></span>
<span class="line"><span>表253 默认路由表（Default table）一般来说默认的路由都放在这张表，但是如果特别指明放的也可以是所有的网关路由。</span></span></code></pre></div><p>查看路由规则, <code>32766</code>表示优先级, 越小优先级越高.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lookup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">32766:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lookup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">32767:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lookup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span></span></code></pre></div><p>创建一个新的路由表, 原地址为<code>192.168.2.0/24</code>的消息全部路由到这张表里</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;250 test&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/iproute2/rt_tables</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.2.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span></span></code></pre></div><p>上面的配置如果要持久化, 可以将命令写入<code>/etc/rc.d/rc.local</code>, 并给该文件可执行权限. <code>chmod +x /etc/rc.d/rc.local</code></p><p>查看某一张表里的路由信息</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span></span></code></pre></div><p>规则匹配的对象是所有的数据包，动作是选用路由表1的路由，这条规则的优先级是32800</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0/0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> table</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pref</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32800</span></span></code></pre></div><p>规则匹配的对象是IP为192.168.3.112，tos等于0x10的包，使用路由表2，这条规则的优先级是1500</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.3.112/32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [tos </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0x10]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> table</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ２</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pref</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1500</span></span></code></pre></div><p>在table test里添加一条默认路由</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 182.169.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span></span></code></pre></div><p>上面的规则是以源地址为关键字，作为是否匹配的依据的。除了源地址外，还可以用以下的信息：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>from -- 源地址</span></span>
<span class="line"><span>to -- 目的地址（这里是选择规则时使用，查找路由表时也使用）</span></span>
<span class="line"><span>tos -- IP包头的TOS（type of sevice）域</span></span>
<span class="line"><span>dev -- 物理接口</span></span>
<span class="line"><span>fwmark -- 防火墙参数</span></span></code></pre></div><p>采取的动作除了指定表，还可以指定下面的动作：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Table 指明所使用的表</span></span>
<span class="line"><span>Nat 透明网关</span></span>
<span class="line"><span>Action prohibit 丢弃该包，并发送 COMM.ADM.PROHIITED的ICMP信息</span></span>
<span class="line"><span>Reject 单纯丢弃该包</span></span>
<span class="line"><span>Unreachable丢弃该包，并发送 NET UNREACHABLE的ICMP信息</span></span></code></pre></div><p>实际场景中尽量使用<code>ip rule to xxxx table xxx</code>针对目的IP指定路由表. 这样无论是收到请求后回复,或者主动发起请求都能匹配</p><p>具体的语法可参考<code>man ip-rule</code>和<code>man ip-route</code><br><a href="https://www.redhat.com/sysadmin/beginners-guide-network-troubleshooting-linux" target="_blank" rel="noreferrer">https://www.redhat.com/sysadmin/beginners-guide-network-troubleshooting-linux</a><br><a href="http://www.microhowto.info/troubleshooting/troubleshooting_the_routing_table.html" target="_blank" rel="noreferrer">http://www.microhowto.info/troubleshooting/troubleshooting_the_routing_table.html</a></p><p>ip netns操作<br><a href="https://www.cnblogs.com/sparkdev/p/9253409.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/sparkdev/p/9253409.html</a></p><h2 id="_51-who-查看当前登录用户" tabindex="-1">51. who 查看当前登录用户 <a class="header-anchor" href="#_51-who-查看当前登录用户" aria-label="Permalink to &quot;51. who 查看当前登录用户&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> who</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     pts/0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        2018-01-17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22:28</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (10.211.55.2)</span></span></code></pre></div><h2 id="_52-使用iftop查看主机实时网络流量" tabindex="-1">52. 使用iftop查看主机实时网络流量 <a class="header-anchor" href="#_52-使用iftop查看主机实时网络流量" aria-label="Permalink to &quot;52. 使用iftop查看主机实时网络流量&quot;">​</a></h2><p>类似top这样的交互式界面<br> 监控网卡的实时流量,反向解析IP,同时还显示具体每个连接接受和发送的流量<br> 注意显示流量的单位为b. 例如 <code>8Mb = 1MB</code>. 所有流量值都是 per second<br> 按<code>n</code>关闭主机名解析, 按<code>N</code>关闭端口号解析, 按<code>p</code>显示连接的端口号<br><code>iftop -f &quot;port 22&quot;</code>过滤只显示端口为22的连接的流量信息, 过滤语法跟<code>tcpdump</code>一样<br> 直接运行<code>iftop</code>, 得到如下信息:</p><blockquote><p>第一行类似刻度尺的刻度，为显示流量图形的长条作标尺用的。<br> &lt;= =&gt;这两个左右箭头，表示的是流量的方向。<br> TX：发送流量<br> RX：接收流量<br> TOTAL：总流量<br> Cumm：运行iftop到目前时间的总流量<br> peak：流量峰值<br> rates：分别表示过去 2s 10s 40s 的平均流量</p></blockquote><p><img src="`+t+`" alt="iftop交互图"></p><h2 id="_53-bash相关环境变量" tabindex="-1">53. Bash相关环境变量 <a class="header-anchor" href="#_53-bash相关环境变量" aria-label="Permalink to &quot;53. Bash相关环境变量&quot;">​</a></h2><p>历史信息显示时间格式<br> 如下设置后, 使用<code>history</code>就会显示具体命令的具体执行时间.<br> 可以直接将其写在 .bashrc文件里</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HISTTIMEFORMAT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;%d/%m/%y %T &quot;</span></span></code></pre></div><p>PS1变量 设置登录提示符, 如下带颜色显示当前用户, 主机名和当前目录的绝对路径.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PS1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[\\e[1;31m\\u@\\h \\e[0;34m\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PWD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\\e[0m]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$ &quot;</span></span></code></pre></div><h2 id="_54-查本机的公网ip" tabindex="-1">54. 查本机的公网IP <a class="header-anchor" href="#_54-查本机的公网ip" aria-label="Permalink to &quot;54. 查本机的公网IP&quot;">​</a></h2><p>通常我们的主机都在内网, 访问互联网是都是换成公网IP后去连接的<br> 如下是查询我们主机的公网IP</p><ol><li>打开百度 www.baidu.com</li><li>输出两个字符 <code>ip</code>, 敲回车</li><li>新页面显示的本机IP就是公网IP</li></ol><h2 id="_55-查询linux系统的一些限制信息" tabindex="-1">55. 查询linux系统的一些限制信息 <a class="header-anchor" href="#_55-查询linux系统的一些限制信息" aria-label="Permalink to &quot;55. 查询linux系统的一些限制信息&quot;">​</a></h2><p>如下文章详细列举了redhat/centos各版本操作系统的重要限制信息.<br> 比如ext4限制, 最大cpu, 最大Memory<br><a href="https://access.redhat.com/articles/rhel-limits" target="_blank" rel="noreferrer">https://access.redhat.com/articles/rhel-limits</a></p><h2 id="_56-判断虚拟化类型的n种方法" tabindex="-1">56. 判断虚拟化类型的N种方法 <a class="header-anchor" href="#_56-判断虚拟化类型的n种方法" aria-label="Permalink to &quot;56. 判断虚拟化类型的N种方法&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dmidecode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> system-manufacturer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OpenStack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Foundation</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd-detect-virt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kvm</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> virt-what</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kvm</span></span></code></pre></div><h2 id="_57-cpu信息解读" tabindex="-1">57. cpu信息解读 <a class="header-anchor" href="#_57-cpu信息解读" aria-label="Permalink to &quot;57. cpu信息解读&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lscpu</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Architecture:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              //</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 架构</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CPU</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> op-mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        32-bit,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 64-bit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      //</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 位数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Byte</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Order:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            Little</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Endian</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       //</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 小端</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CPU(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):                2                   // 逻辑cpu数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">On-line</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CPU</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">list:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0,1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Thread(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) per core:    1                   // 一个核有一个线程. </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Core(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) per socket:    2                   // 一个插槽有两个核</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Socket(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):             1                   // 总共一个插槽</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NUMA</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             GenuineIntel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CPU</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> family:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Model:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                 69</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            Intel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">R</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Core</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">i5-4260U</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CPU</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1.40GHz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Stepping:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CPU</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MHz:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">               2000.000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BogoMIPS:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              4000.00</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Hypervisor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vendor:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     KVM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                 //</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 虚拟化类型</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Virtualization</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   full</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                //</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 全虚拟化</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L1d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             32K</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L1i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             32K</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              256K</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              3072K</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NUMA</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CPU</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0,1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">............</span></span></code></pre></div><h2 id="_58-taskset指定进程的cpu亲和性" tabindex="-1">58. taskset指定进程的CPU亲和性 <a class="header-anchor" href="#_58-taskset指定进程的cpu亲和性" aria-label="Permalink to &quot;58. taskset指定进程的CPU亲和性&quot;">​</a></h2><p>返回的mask为十六进制, 3 代表 0x11 即绑定在cpu 0 和 1 上面. 最低位代表第一个cpu<br> taskset -p pid 返回pid对应进程当前的亲和性</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> taskset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 691</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pid</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 691</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s current affinity mask: 3</span></span></code></pre></div><p><code>taskset -p mask pid</code>设置进程的cpu亲和性<br> 也可以使用数字代替mask, 比如 <code>taskset -c 0,1 -p 1</code> 表示为pid为1的进程绑定cpu0和1</p><p><code>taskset 1 ls</code> 执行ls命令是直接绑定到cpu0上.</p><p><code>/proc/[pid]/status</code>也可以查询, 举例:</p><blockquote><p>Cpus_allowed: 3<br> Cpus_allowed_list: 0-1<br> 解释:<br> Cpus_allowed:3指出该进程可以使用CPU的亲和性掩码,因为我们指定为两块CPU,所以这里就是3,如果该进程指定为4个CPU(如果有话),这里就是F(1111).<br> Cpus_allowed_list:0-1指出该进程可以使用CPU的列表,这里是0-1.</p></blockquote><p>进程运行时设置的亲和性并不影响其他线程, 如果要对java这样的多线程设置, 需要ps -efL 找到所有线程, 然后逐一设置<br><code>taskset 1 java</code>启动java命令时的绑定, 会应用到所有线程, 因为cpu的亲和性具有继承性</p><h2 id="_59-linux系统最大文件数量" tabindex="-1">59. Linux系统最大文件数量 <a class="header-anchor" href="#_59-linux系统最大文件数量" aria-label="Permalink to &quot;59. Linux系统最大文件数量&quot;">​</a></h2><p><code>ulimit -n</code>返回当前user单进程可打开的最大进程数<br><code>/proc/[pid]/limits</code> 查询该进程的资源限制数据<br><code>ls -rlt /proc/[pid]/fd | wc -l</code> 查询该进程当前已打开的文件数<br><code>lsof -p [pid] | wc -l </code> 也可查询, 但要过滤掉cwd, 动态库等<br><code>ulimit -n unlimited</code>是无效的, 进程级的文件句柄不支持<code>unlimited</code>, 最大值为 <code>/proc/sys/fs/nr_open</code>, 该值默认为1048576.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ulimit -n 1048577</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-bash:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ulimit:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> op]en</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cannot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> modify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> limit:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Operation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> permitted</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ulimit -n unlimited</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-bash:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ulimit:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cannot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> modify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> limit:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Operation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> permitted</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cat /proc/sys/fs/nr_open</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1048576</span></span></code></pre></div><p>在centos7上<code>nr_open</code>的最大值可调整为2147483584</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sysctl -w fs.nr_open=2147483585</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> setting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;fs.nr_open&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Invalid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argument</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fs.nr_open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2147483585</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sysctl -w fs.nr_open=2147483584</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fs.nr_open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2147483584</span></span></code></pre></div><p>查询整个OS当前的文件数使用情况:<br> file-max显示所有进程的最大文件数, 可通过<code>echo 100000 &gt; /proc/sys/fs/file-max</code>提高</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/sys/fs/file-max</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">97703</span></span></code></pre></div><p>file-nr是只读的, 第一个字段代表已分配(即已打开)文件数, 第二个字段从2.6开始一直为0, 第三个字段等于file-max</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/sys/fs/file-nr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1344</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	97703</span></span></code></pre></div><p>列出每个进程的已打开的文件数, 用于找到当前哪个进程占用最多文件数<br><code>-d</code> 用于排除cwd, 动态库之类的信息<br><code>-n</code> 不用协议解析, 加快命令运行速度<br><code>lsof -n -d0-999999 | awk &#39;{print $2}&#39; | sort | uniq -c | sort -k1 -n</code></p><h2 id="_60-ss-查询socket连接信息" tabindex="-1">60. ss 查询socket连接信息 <a class="header-anchor" href="#_60-ss-查询socket连接信息" aria-label="Permalink to &quot;60. ss 查询socket连接信息&quot;">​</a></h2><p>类似于<code>netstat</code>, 使用了netlink, 性能更好</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                #显示各socket的统计信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ntlp</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #-n 不解析, -t 显示tcp连接  -l 显示监听socket, -p 显示使用的进程名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #查看所有tcp连接, 不带-a则指显示 Established 连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -to</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #查看tcp的keepalive信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ti</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #查看tcp的内部信息,比如拥塞算法,rto,rtt,cwnd,ssthresh等</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tm</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #查看tcp的内存使用信息, 比如收发缓冲区的大小</span></span></code></pre></div><p>还有一些高级的过滤用法</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> raw,packet_raw</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                             #查看raw socket的信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> listening</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                  #显示处于listening状态的连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> established</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                #显示处于established状态的连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> listening</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;( sport == 22 )&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #显示处于listening状态且源端口为22的连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;( sport == 22 )&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                 #显示源端口为22的连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;( sport != 22 )&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                 #显示源端口不为22的连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;( sport == 22 || dport == 22 )&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  #显示源端口为22或者目标端口为22的连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;( dst 10.211.55.2 &amp;&amp; dport == 58181 )&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           #显示目标ip为10.211.55.2且目标端口为58181的连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;( src 127.0.0.1 )&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                               #显示源ip为 127.0.0.1的连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ss</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;( ! dst 10.211.55.2 &amp;&amp; dport != 58181 )&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         #显示目标ip不是10.211.55.2且目标端口不是58181的连接</span></span></code></pre></div><p>state后面支持的TCP状态如下:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sstate_namel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">		&quot;UNKNOWN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_ESTABLISHED] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;established&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_SYN_SENT] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;syn-sent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_SYN_RECV] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;syn-recv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_FIN_WAIT1] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;fin-wait-1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_FIN_WAIT2] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;fin-wait-2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_TIME_WAIT] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;time-wait&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_CLOSE] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;unconnected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_CLOSE_WAIT] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;close-wait&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_LAST_ACK] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;last-ack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_LISTEN] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;listening&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		[SS_CLOSING] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;closing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	};</span></span></code></pre></div><p>更多使用介绍请参考:<br><a href="https://www.cyberciti.biz/tips/linux-investigate-sockets-network-connections.html" target="_blank" rel="noreferrer">https://www.cyberciti.biz/tips/linux-investigate-sockets-network-connections.html</a><br><a href="https://man7.org/linux/man-pages/man8/ss.8.html" target="_blank" rel="noreferrer">https://man7.org/linux/man-pages/man8/ss.8.html</a><br><a href="https://github.com/shemminger/iproute2/blob/main/misc/ssfilter.y" target="_blank" rel="noreferrer">https://github.com/shemminger/iproute2/blob/main/misc/ssfilter.y</a></p><h2 id="_61-消除用户被锁的错误登录记录" tabindex="-1">61. 消除用户被锁的错误登录记录 <a class="header-anchor" href="#_61-消除用户被锁的错误登录记录" aria-label="Permalink to &quot;61. 消除用户被锁的错误登录记录&quot;">​</a></h2><p>通常管理员会配置pam_faillock或者pam_tally2, 当用户使用错误密码满足一定条件, 就将用户锁定一段时间. 如下是即时清除错误记录的命令</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">faillock</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reset</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pam_tally2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [username]</span></span></code></pre></div><h2 id="_62-估计rss总和的大小" tabindex="-1">62. 估计RSS总和的大小 <a class="header-anchor" href="#_62-估计rss总和的大小" aria-label="Permalink to &quot;62. 估计RSS总和的大小&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{sum+=$6} END {print sum / 1024}&#39;</span></span></code></pre></div><p>如下脚本也可以:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rss.sh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PROC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /proc/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;^[0-9]&quot;\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /proc/$PROC/statm ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      TEP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PROC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/statm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{print ($2)}&#39;\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      RSS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $RSS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> + </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$TEP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  fi</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RSS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $RSS</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $RSS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;KB&quot;</span></span></code></pre></div><h2 id="_63-文件系统修复" tabindex="-1">63. 文件系统修复 <a class="header-anchor" href="#_63-文件系统修复" aria-label="Permalink to &quot;63. 文件系统修复&quot;">​</a></h2><p>针对xfs, 使用<code>xfs_repair</code>命令:<br><code>-n</code> 表示不修复, 只扫描并显示错误</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xfs_repair</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/mapper/vg-home</span></span></code></pre></div><p>不带<code>-n</code>, 执行修复. <code>-v</code>表示显示详情</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xfs_repair</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/mapper/vg-home</span></span></code></pre></div><p>最后方法：损失部分数据的修复方法<br> 根据打印消息，修复失败时：<br> 先执行xfs_repair -L /dev/sdd(清空日志，会丢失文件)，再执行xfs_repair /dev/sdd，再执行xfs_check /dev/sdd 检查文件系统是否修复成功。</p><blockquote><p>-L是修复xfs文件系统的最后手段，慎重选择，它会清空日志，会丢失用户数据和文件。</p></blockquote><h2 id="_64-非交互式修改密码" tabindex="-1">64. 非交互式修改密码 <a class="header-anchor" href="#_64-非交互式修改密码" aria-label="Permalink to &quot;64. 非交互式修改密码&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Linux@123&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">passwd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --stdin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span></span></code></pre></div><h2 id="_66-udev管理" tabindex="-1">66. udev管理 <a class="header-anchor" href="#_66-udev管理" aria-label="Permalink to &quot;66. udev管理&quot;">​</a></h2><p>查询设备的信息, 主要是环境变量</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">udevadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">P:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda/sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">N:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disk/by-id/ata-CentOS_Linux-0_SSD_FFACPKN8NC9MK3EX3N4R-part1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disk/by-uuid/5de1c8df-9b03-4830-9b56-b96a2290b78f</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVLINKS=/dev/disk/by-id/ata-CentOS_Linux-0_SSD_FFACPKN8NC9MK3EX3N4R-part1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/disk/by-uuid/5de1c8df-9b03-4830-9b56-b96a2290b78f</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVNAME=/dev/sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVPATH=/devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda/sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVTYPE=partition</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID_ATA=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID_ATA_ROTATION_RATE_RPM=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID_ATA_SATA=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID_ATA_SATA_SIGNAL_RATE_GEN1=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div><p>加参数<code>-a</code>, 主要是设备的属性.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">udevadm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">P:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda/sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">N:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disk/by-id/ata-CentOS_Linux-0_SSD_FFACPKN8NC9MK3EX3N4R-part1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disk/by-uuid/5de1c8df-9b03-4830-9b56-b96a2290b78f</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVLINKS=/dev/disk/by-id/ata-CentOS_Linux-0_SSD_FFACPKN8NC9MK3EX3N4R-part1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/disk/by-uuid/5de1c8df-9b03-4830-9b56-b96a2290b78f</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVNAME=/dev/sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVPATH=/devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda/sda1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEVTYPE=partition</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID_ATA=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID_ATA_ROTATION_RATE_RPM=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID_ATA_SATA=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID_ATA_SATA_SIGNAL_RATE_GEN1=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></div><p><code>udevadmin monitor</code>用于实时监控udev实践,定位热插拔设备时特别有用.<br><code>udevadmin test xxxx</code>用于测试匹配设备的规则执行动作.<br> xxx可以是<code>/sys/class/block/sda</code>,<code>/sys/class/net/eth0</code>, 也可以是<code>/sys/devices</code>下面的设备</p><p>修改<code>/etc/udev/udev.conf</code>里的<code>udev_log=&quot;debug&quot;</code>可以打开更详细的日志<br> 使用<code>journalctl -u systemd-udevd</code>查看</p><h2 id="_67-一条命令启动web服务器" tabindex="-1">67. 一条命令启动web服务器 <a class="header-anchor" href="#_67-一条命令启动web服务器" aria-label="Permalink to &quot;67. 一条命令启动web服务器&quot;">​</a></h2><p>查询设备的信息, 主要是环境变量</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SimpleHTTPServer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8000</span></span></code></pre></div><h2 id="_68-dpkg-apt-get包管理命令" tabindex="-1">68. dpkg,apt-get包管理命令 <a class="header-anchor" href="#_68-dpkg-apt-get包管理命令" aria-label="Permalink to &quot;68. dpkg,apt-get包管理命令&quot;">​</a></h2><p>查询所有包</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dpkg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span></span></code></pre></div><p>查询某个文件属于哪个包</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dpkg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/growpart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloud-guest-utils:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/growpart</span></span></code></pre></div><p>查询使用apt-get安装的历史记录</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/apt/history.log</span></span></code></pre></div><h2 id="_69-主机安全入侵盘查" tabindex="-1">69. 主机安全入侵盘查 <a class="header-anchor" href="#_69-主机安全入侵盘查" aria-label="Permalink to &quot;69. 主机安全入侵盘查&quot;">​</a></h2><p>检查<code>LD_PRELOAD</code>环境变量<br> 使用<code>vi</code>打开<code>/etc/ld.so.preload</code>这个文件是否有内容<br> 使用<code>cat /proc/$$/mountinfo</code> 或者<code>cat /proc/mounts </code> 看<code>proc</code> 是否被挂载到其他目录<br> 使用<code>strace</code>检查普通命令的系统调用<br> 如下个三个安全相关的分析案例:<br><a href="https://www.anquanke.com/post/id/160843" target="_blank" rel="noreferrer">https://www.anquanke.com/post/id/160843</a><br><a href="https://superuser.com/questions/1183037/what-is-does-ld-so-preload-do" target="_blank" rel="noreferrer">https://superuser.com/questions/1183037/what-is-does-ld-so-preload-do</a><br><a href="https://www.jianshu.com/p/31e487daa79d" target="_blank" rel="noreferrer">https://www.jianshu.com/p/31e487daa79d</a></p><h2 id="_70-top命令" tabindex="-1">70. top命令 <a class="header-anchor" href="#_70-top命令" aria-label="Permalink to &quot;70. top命令&quot;">​</a></h2><p>top默认3秒刷新一次信息, 导致一些即时启动并结束的进程无法观察到, 可以用如下参数指定间隔:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">top</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.1</span></span></code></pre></div><p>上面是以100ms为间隔, 也可进入交互模式后按<code>d</code>进行动态调整<br> 交互模式下按<code>1</code>显示每个cpu的使用率信息, 按<code>M</code> 进程按内存排序, 按<code>H</code>显示线程信息</p><p>top进程级的默认字段如果不够, 可以按<code>f</code>选择要显示的字段,比如<code>last cpu used</code>, 然后按<code>q</code>返回显示<br><code>f</code>后不仅可以增加,删除,调整字段顺序, 还可以按<code>s</code>将当前选中的字段作为排序的字段. 比如按内存排序<br> 如果要过滤进程, 比如只显示cmdline 包含字符abc的进程, 按<code>o</code>后输入<code>COMMAND=abc</code>, 碰到java这种进程, 可以按<code>c</code>显示完整的命令行</p><p>查看单个进程的所有线程信息, 对java程序特别有用</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> top</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Hp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4592</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Threads:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> total,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> running,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sleeping,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stopped,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zombie</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">%Cpu(s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):  0.0 us,  0.0 sy,  0.0 ni, 98.4 id,  0.0 wa,  1.6 hi,  0.0 si,  0.0 st</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MiB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Mem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   7809.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> total,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   5711.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> free,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    910.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> used,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1187.6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> buff/cache</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MiB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Swap:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> total,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> free,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> used.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   6748.4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> avail</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Mem</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> USER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      PR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  NI</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    VIRT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    RES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    SHR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  %CPU</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  %MEM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     TIME+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> COMMAND</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4592</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:06.87</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4593</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:06.01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4594</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:00.68</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4595</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:07.53</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4596</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:00.58</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4597</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:00.00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4598</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:06.96</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4605</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:06.64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4644</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:06.70</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4647</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:00.01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   4818</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1810424</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 372332</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  14820</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> S</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0:00.27</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gopls</span></span></code></pre></div><h2 id="_71-ping命令" tabindex="-1">71. ping命令 <a class="header-anchor" href="#_71-ping命令" aria-label="Permalink to &quot;71. ping命令&quot;">​</a></h2><p><code>-i</code>指定两次ping之前的间隔, 默认是1s</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ping</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.163.com</span></span></code></pre></div><p><code>-s</code>指定ping包的大小, 默认是64bytes</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ping</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.163.com</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PING</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> z163ipv6.v.bsgslb.cn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (117.23.1.15) 1024(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1052</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) bytes of data.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1032</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 117.23.1.15:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7.03</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1032</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 117.23.1.15:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7.77</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span></span></code></pre></div><h2 id="_72-ping和curl常见的网络报错" tabindex="-1">72. ping和curl常见的网络报错 <a class="header-anchor" href="#_72-ping和curl常见的网络报错" aria-label="Permalink to &quot;72. ping和curl常见的网络报错&quot;">​</a></h2><p>ping ip 报错：<br><code>connect: Network is unreachable</code> 原因是OS里没有相关路由导致<br><code>From 192.168.100.1 icmp_seq=1 Destination Port Unreachable</code> 原因是收到icmp reponse, 端口不可达， 中间设备或者iptable reject</p><p>cur ip 一些报错:<br><code>curl: (7) Failed to connect to 114.114.114.114: Network is unreachable</code> 原因是OS里没有相关路由导致 很快返回<code>curl: (7) Failed connect to 114.114.114.114:80; Connection refused</code> 因为Curl收到icmp 应答消息 80端口不可达， 可能是中间设备iptable发送或者收到服务端rst消息， 80端口没有处于监听状态</p><h2 id="_73-一些常用的内存统计命令" tabindex="-1">73. 一些常用的内存统计命令 <a class="header-anchor" href="#_73-一些常用的内存统计命令" aria-label="Permalink to &quot;73. 一些常用的内存统计命令&quot;">​</a></h2><p>统计所有进程占用的物理内存</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用 grep 查找 Pss 指标后，再用 awk 计算累加值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Pss</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/[1-9]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/smaps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{total+=$2}; END {printf &quot;%d kB\\n&quot;, total }&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">391266</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kB</span></span></code></pre></div><p>有时smaps文件会看到没有读写权限的内存段,但有p这个权限,即是内存,往往发生在libc这样的共享库和java程序.<br> 如下文章解释了具体的目的, java程序的情况下经常占用了很大的内存, 只要是为了预留一段连续的内存快<br> 这些内存是不会计算到<code>Rss</code>或者<code>Pss</code>里面, 但却实实在在占用了内存.<br><a href="https://unix.stackexchange.com/questions/226283/shared-library-mappings-in-proc-pid-maps" target="_blank" rel="noreferrer">https://unix.stackexchange.com/questions/226283/shared-library-mappings-in-proc-pid-maps</a><br><a href="https://unix.stackexchange.com/questions/353676/what-is-the-purpose-of-seemingly-unusable-memory-mappings-in-linux/353685#353685" target="_blank" rel="noreferrer">https://unix.stackexchange.com/questions/353676/what-is-the-purpose-of-seemingly-unusable-memory-mappings-in-linux/353685#353685</a></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">7fae7db9f000-7fae7dc8f000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> r-xp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 00000000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 08:05</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 536861</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.20</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">7fae7dc8f000-7fae7de8f000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 000f0000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 08:05</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 536861</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.20</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">7fae7de8f000-7fae7de97000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> r--p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 000f0000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 08:05</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 536861</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.20</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">7fae7de97000-7fae7de99000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rw-p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 000f8000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 08:05</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 536861</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.20</span></span></code></pre></div><p>这篇文章详细地介绍了<code>/proc/meminfo</code>里的每一个字段的含义和一些有用的公式.<br><a href="http://linuxperf.com/?p=142" target="_blank" rel="noreferrer">http://linuxperf.com/?p=142</a></p><h2 id="_74-不同os的文件编码" tabindex="-1">74. 不同OS的文件编码 <a class="header-anchor" href="#_74-不同os的文件编码" aria-label="Permalink to &quot;74. 不同OS的文件编码&quot;">​</a></h2><p>linux显示文件内容的编码方式</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> old.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">old.txt:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> text/plain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; charset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">us-ascii</span></span></code></pre></div><p>将文件abc.txt 编����方式从iso8859-1改为utf-8</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iconv</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iso8859-1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> utf-8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.txt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.txt.utf8</span></span></code></pre></div><p>讲当前文件夹所有文件的文件名编码从GBK改为UTF-8, <code>-r</code>表示递归所有子文件夹</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">convmv</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GBk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UTF-8</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --notest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">，这</span></span></code></pre></div><p>参考: <a href="http://kuring.me/post/windows_linux_code/" target="_blank" rel="noreferrer">http://kuring.me/post/windows_linux_code/</a></p><h2 id="_75-一些shell循环命令" tabindex="-1">75. 一些shell循环命令 <a class="header-anchor" href="#_75-一些shell循环命令" aria-label="Permalink to &quot;75. 一些shell循环命令&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">while</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/stat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;cpu &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sleep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1..1000}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> touch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$n; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$n; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> file </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/[1-9]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $file; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span></code></pre></div><h2 id="_76-dhcp持续请求配置" tabindex="-1">76. dhcp持续请求配置 <a class="header-anchor" href="#_76-dhcp持续请求配置" aria-label="Permalink to &quot;76. dhcp持续请求配置&quot;">​</a></h2><p>Network管理时, 如果要在dhcp获取ip失败后不断重试,则在<code>ifcfg-ethX</code>文件里增加<code>PERSISTENT_DHCLIENT=yes</code><br> 默认是1分钟后超时, 不重试,日志打印<code>no dhcpoffers received</code><br> 如果加参数, 1分钟超时, 然后一个随机的时间间隔后再次重试. 一直重试到成功获取ip,日志打印如下:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dhcpoffers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> received</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> working</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> leases</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> persistent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> database</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sleeping</span></span></code></pre></div><p>如果底层网卡有down, up动作, dhcp进程还在, 只显示一条报错信息<code>receive_packet failed on eth0: Network is down</code><br> 当通过dhcp获取ip失败后, 如果配置了持续获取, 那么下次发起请求的时间间隔是个随机值,大致为150s~450s之间.<br> 具体的代码如下, <code>retry_interval</code>默认是300s,且不可调整<br><a href="https://github.com/42wim/isc-dhcp/blob/f54a146c7fe88889d60f0c1aa8e6f04707f95223/client/dhclient.c" target="_blank" rel="noreferrer">https://github.com/42wim/isc-dhcp/blob/f54a146c7fe88889d60f0c1aa8e6f04707f95223/client/dhclient.c</a></p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	log_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;No working leases in persistent database - sleeping.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	script_init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;FAIL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> string_list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> alias)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		script_write_params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;alias_&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> alias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	script_go</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> S_INIT;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	tv.tv_sec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cur_tv.tv_sec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retry_interval </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		    (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retry_interval));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	tv.tv_usec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((tv.tv_sec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cur_tv.tv_sec) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cur_tv.tv_usec;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	add_timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, state_init, client, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	detach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ();</span></span></code></pre></div><p>NetworkManager管理时, 两个方法配置持久化:<br> 使用类似命令修改<code>nmcli connection modify enps1s0 ipv4.dhcp-timeout infinity</code><br> 在<code>ifcfg-ethX</code>里增加<code>IPV4_DHCP_TIMEOUT=2147483647</code><br> 参考 <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/configuring_the_dhcp_client_behavior" target="_blank" rel="noreferrer">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/configuring_the_dhcp_client_behavior</a></p><h2 id="_77-解析-proc-pid-status里关于信号的字段" tabindex="-1">77. 解析/proc/[pid]/status里关于信号的字段 <a class="header-anchor" href="#_77-解析-proc-pid-status里关于信号的字段" aria-label="Permalink to &quot;77. 解析/proc/[pid]/status里关于信号的字段&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#read -p &quot;PID=&quot; pid</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$pid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">egrep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;(Sig|Shd)(Pnd|Blk|Ign|Cgt)&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">while read name mask;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ibase=16; obase=2; \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mask</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">^^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $mask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $bin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ $bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-ne</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]];</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ \${bin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(-1)} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-eq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]];</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;\\n&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39; &#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fi</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        bin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\${bin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $((</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    done</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># vim:et:sw=4:ts=4:sts=4:</span></span></code></pre></div><p>参考链接: <a href="https://stackoverflow.com/questions/4155483/proc-pidstatus-sigign-field" target="_blank" rel="noreferrer">https://stackoverflow.com/questions/4155483/proc-pidstatus-sigign-field</a></p><h2 id="_78-审计谁杀了进程" tabindex="-1">78. 审计谁杀了进程 <a class="header-anchor" href="#_78-审计谁杀了进程" aria-label="Permalink to &quot;78. 审计谁杀了进程&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auditctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> always,exit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> arch=b64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a1=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log_kill</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auditctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> always,exit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> arch=b64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a1=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> log_kill</span></span></code></pre></div><p>参考: <a href="https://jotdownux.wordpress.com/2016/01/23/whos-killing-that-process-whos-dumping-prelink-files-in-tmp-linux-auditd-to-the-rescue/" target="_blank" rel="noreferrer">https://jotdownux.wordpress.com/2016/01/23/whos-killing-that-process-whos-dumping-prelink-files-in-tmp-linux-auditd-to-the-rescue/</a></p><h2 id="_79-修改字符集的命令" tabindex="-1">79. 修改字符集的命令 <a class="header-anchor" href="#_79-修改字符集的命令" aria-label="Permalink to &quot;79. 修改字符集的命令&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-locale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LANG=en_US.UTF-8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-locale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LANG=zh_CN.UTF-8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-locales</span></span></code></pre></div><h2 id="_80-bash脚本的退出码" tabindex="-1">80. bash脚本的退出码 <a class="header-anchor" href="#_80-bash脚本的退出码" aria-label="Permalink to &quot;80. bash脚本的退出码&quot;">​</a></h2><p>脚本退出码是有特殊含义的,比如常见的<code>127</code>代表脚本里的命令没找到,<code>130</code>代表用户按了<code>ctrl+c</code>导致脚本停止</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-bash:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> found</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sleep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">^C</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">130</span></span></code></pre></div><p>更详细的退出码含义请参见 <a href="https://tldp.org/LDP/abs/html/exitcodes.html" target="_blank" rel="noreferrer">https://tldp.org/LDP/abs/html/exitcodes.html</a></p><h2 id="_81-模拟不断增加内存致使触发oom的程序" tabindex="-1">81. 模拟不断增加内存致使触发oom的程序 <a class="header-anchor" href="#_81-模拟不断增加内存致使触发oom的程序" aria-label="Permalink to &quot;81. 模拟不断增加内存致使触发oom的程序&quot;">​</a></h2><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdlib.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                 if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                         printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;malloc failure after </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MiB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, n);  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                 }  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                 printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;got </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MiB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n);  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         }  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }  </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $ gcc memtest1.c  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $ .</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a.out  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> got </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">570528</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MiB  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> got </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">570529</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MiB  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> got </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">570530</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MiB  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> got </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">570531</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MiBKilled</span></span></code></pre></div><p>具体的详细测试步骤: <a href="https://access.redhat.com/solutions/47692" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/47692</a></p><h2 id="_82-vi实现十六进制编辑功能" tabindex="-1">82. vi实现十六进制编辑功能 <a class="header-anchor" href="#_82-vi实现十六进制编辑功能" aria-label="Permalink to &quot;82. vi实现十六进制编辑功能&quot;">​</a></h2><p>vim配合xxd对文件进行十六进制的编辑,达到类似UltraEdit的效果</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc.txt</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">%!xxd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">修改完后,运行下面的命令.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 注意左边改动会生效,右边的文本改动不生效</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">%!xxd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span></span></code></pre></div><p>更详细的请看 <a href="https://www.cnblogs.com/meibenjin/archive/2012/12/06/2806396.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/meibenjin/archive/2012/12/06/2806396.html</a></p><h2 id="_83-iproute软件包里的一些常用命令" tabindex="-1">83. iproute软件包里的一些常用命令 <a class="header-anchor" href="#_83-iproute软件包里的一些常用命令" aria-label="Permalink to &quot;83. iproute软件包里的一些常用命令&quot;">​</a></h2><p><code>ifstat</code>打印网卡的一些统计信息,类似<code>ifconfig</code>里的输出,但每次运行时输出从上次运行之后这段时间的统计,而<code>ifconfig</code>是打印的从网卡up以来的累积值<br><code>-a</code>则忽略历史文件,打印从网卡up后的累积值,<code>-j</code>表示输出格式是json.方便二次处理</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ifstat</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#kernel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Pkts/Rate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Pkts/Rate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    RX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Data/Rate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Data/Rate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                 RX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Errs/Drop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Errs/Drop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    RX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Over/Rate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Coll/Rate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    14</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            14</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           819</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           819</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eth0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                  25</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            18</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2058</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2784</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">virbr0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div><p><code>nstat</code>打印协议栈里的一些统计计数,类似<code>netstat -s</code>的输出,与内核代码里的相关变量名更贴近,容易分析比较<br><code>-r</code>则忽略历史文件,打印从网卡up后的累积值,<code>-z</code>表示非0值的字段也输出</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nstat</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#kernel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IpInReceives</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    8297</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">               0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IpInDelivers</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    8297</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">               0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IpOutRequests</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                   7789</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">               0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IcmpInMsgs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                  0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IcmpInErrors</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                  0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IcmpInDestUnreachs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                  0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IcmpOutMsgs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                     6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                  0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IcmpOutDestUnreachs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                  0.0</span></span></code></pre></div><p><code>TcpExtListenOverflows</code>和<code>TcpExtListenDrops</code> 代表全队列或者半队列满了<br><code>TcpInCsumErrors</code>代表接受的包在tcp层的checksum校验不通过,被丢弃</p><p>所有的计数项解释 <a href="https://www.kernel.org/doc/html/latest/networking/snmp_counter.html" target="_blank" rel="noreferrer">https://www.kernel.org/doc/html/latest/networking/snmp_counter.html</a></p><p><code>lnstat</code>周期性输入一些内核统计数据, <code>-d</code>显示支持的具体文件和项</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lnstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/proc/net/stat/nf_conntrack:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 1:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entries</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 2:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> searched</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 3:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> found</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 4:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 5:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> invalid</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 6:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ignore</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 7:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 8:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete_list</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 9:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> insert</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	10:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> insert_failed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	11:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> drop</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	12:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> early_drop</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	13:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> icmp_error</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	14:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> expect_new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	15:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> expect_create</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	16:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> expect_delete</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	17:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> search_restart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/proc/net/stat/ndisc_cache:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 1:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entries</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 2:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allocs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 3:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destroys</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 4:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hash_grows</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 5:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lookups</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 6:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hits</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 7:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> res_failed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 8:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rcv_probes_mcast</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	 9:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rcv_probes_ucast</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	10:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> periodic_gc_runs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	11:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> forced_gc_runs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	12:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unresolved_discards</span></span></code></pre></div><p><code>-k</code>可输出特定项的信息</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lnstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;entries,insert_failed&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nf_connt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nf_connt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> entries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insert_f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   ailed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       7</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span></code></pre></div><p>这里的entris和<code>conntrack -L</code>的信息是一样的</p><p><code>tc</code>可以模拟网络延迟,限速等功能, 下面是查看当前策略的命令</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qdisc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span></span></code></pre></div><h2 id="_84-链接跟踪" tabindex="-1">84. 链接跟踪 <a class="header-anchor" href="#_84-链接跟踪" aria-label="Permalink to &quot;84. 链接跟踪&quot;">​</a></h2><p><code>conntrack -L</code>可显示当前的所有链接信息, 需要安装<code>conntrack-tools</code>后才可以使用</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conntrack</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 430950</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ESTABLISHED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.211.55.22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dst=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.211.55.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sport=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dport=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">51568</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.211.55.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dst=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.211.55.22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sport=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">51568</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dport=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">22</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ASSURED] mark</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> use</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TIME_WAIT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.211.55.22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dst=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">113.142.161.250</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sport=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">48530</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dport=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">113.142.161.250</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dst=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.211.55.22</span></span></code></pre></div><p>查看当前链接跟踪表里的数目</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/sys/net/netfilter/nf_conntrack_count</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4</span></span></code></pre></div><p>查看当前生效的最大值</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/sys/net/netfilter/nf_conntrack_max</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">65536</span></span></code></pre></div><p>如果内核出现<code>nf_conntrack: table full, dropping packet.</code>, 则需要增加链接跟踪表的最大连接数</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net.nf_conntrack_max=xxxxx</span></span></code></pre></div><p>还可以通过在加载模块时指定hashsize解决</p><p><a href="https://access.redhat.com/solutions/972673" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/972673</a> 介绍了针对匹配的包不进行连接跟踪的方法<br> 更详细的一些文章:<br><a href="https://blog.csdn.net/u010472499/article/details/78292811" target="_blank" rel="noreferrer">https://blog.csdn.net/u010472499/article/details/78292811</a><br><a href="https://access.redhat.com/solutions/8721" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/8721</a><br><a href="https://access.redhat.com/solutions/974723" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/974723</a><br><a href="https://access.redhat.com/solutions/8721" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/8721</a></p><p><code>sysctl -a | grep nf_</code> 查看和链接跟踪所有的内核参数<br> 具体解释: <a href="https://www.kernel.org/doc/Documentation/networking/nf_conntrack-sysctl.txt" target="_blank" rel="noreferrer">https://www.kernel.org/doc/Documentation/networking/nf_conntrack-sysctl.txt</a></p><p>下面的规则是用于跟踪对应连接的TCP状态, 每次连接都有自己的超时时间, 如果配置不当会导致丢包.<br> 比如<code>ESTABLISHED</code>的超时时间时5天, 如果改为5分钟, 且这5分钟该TCP没有任何报文交互, 则 iptables会将该连接置为invalid.<br> 这样即使用<code>ss</code>或者<code>netstat</code>查看该连接仍是<code>ESTABLISHED</code>, 任何发到该连接的报文全部会被丢弃.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ACCEPT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      virbr0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  0.0.0.0/0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            192.168.122.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     ctstate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> RELATED,ESTABLISHED</span></span></code></pre></div><p>具体的信息见\`man iptables-extensions</p><p>一些介绍链接跟踪,iptables的文章<br><a href="https://www.cnblogs.com/liushaodong/archive/2013/02/26/2933593.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/liushaodong/archive/2013/02/26/2933593.html</a><br><a href="http://arthurchiao.art/blog/conntrack-design-and-implementation/" target="_blank" rel="noreferrer">http://arthurchiao.art/blog/conntrack-design-and-implementation/</a></p><h2 id="_85-一些汇编语法" tabindex="-1">85. 一些汇编语法 <a class="header-anchor" href="#_85-一些汇编语法" aria-label="Permalink to &quot;85. 一些汇编语法&quot;">​</a></h2><p>如下文章介绍了x86_64下许多寄存器的用途<br><a href="http://abcdxyzk.github.io/blog/2012/11/23/assembly-args/" target="_blank" rel="noreferrer">http://abcdxyzk.github.io/blog/2012/11/23/assembly-args/</a></p><h2 id="_86-使用crash分析内核coredump的一些文章" tabindex="-1">86. 使用crash分析内核coredump的一些文章 <a class="header-anchor" href="#_86-使用crash分析内核coredump的一些文章" aria-label="Permalink to &quot;86. 使用crash分析内核coredump的一些文章&quot;">​</a></h2><p><a href="https://irmbor.co.rs/~dspalovic/assets/docsOracle/E41138/html/ch10s02.html" target="_blank" rel="noreferrer">https://irmbor.co.rs/~dspalovic/assets/docsOracle/E41138/html/ch10s02.html</a><br><a href="https://www.slideshare.net/PaulVNovarese/linux-crash-dump-capture-and-analysis" target="_blank" rel="noreferrer">https://www.slideshare.net/PaulVNovarese/linux-crash-dump-capture-and-analysis</a><br><a href="https://serverfault.com/questions/475721/how-to-use-kdump-crash-to-investigate-an-oom-issue" target="_blank" rel="noreferrer">https://serverfault.com/questions/475721/how-to-use-kdump-crash-to-investigate-an-oom-issue</a><br><a href="https://www.redhat.com/archives/crash-utility/2012-December/msg00029.html" target="_blank" rel="noreferrer">https://www.redhat.com/archives/crash-utility/2012-December/msg00029.html</a></p><p>最主要还是看crash的官方主页: <a href="https://crash-utility.github.io/" target="_blank" rel="noreferrer">https://crash-utility.github.io/</a></p><h2 id="_87-linux内核模块相关" tabindex="-1">87. Linux内核模块相关 <a class="header-anchor" href="#_87-linux内核模块相关" aria-label="Permalink to &quot;87. Linux内核模块相关&quot;">​</a></h2><p>使用weak-modules实现外部开发的内核模块在多个内核(KABI兼容的情况下)都可以使用, 这篇文章介绍了具体的方法<br><a href="https://www.cnblogs.com/xingmuxin/p/9092344.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/xingmuxin/p/9092344.html</a></p><h2 id="_88-ssh连接保活配置" tabindex="-1">88. ssh连接保活配置 <a class="header-anchor" href="#_88-ssh连接保活配置" aria-label="Permalink to &quot;88. ssh连接保活配置&quot;">​</a></h2><p>编辑 /etc/ssh/sshd_config, 添加如下两行, 重启sshd服务生效</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ClientAliveInterval</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ClientAliveCountMax</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span></code></pre></div><h2 id="_89-使用auditd审计功能" tabindex="-1">89. 使用auditd审计功能 <a class="header-anchor" href="#_89-使用auditd审计功能" aria-label="Permalink to &quot;89. 使用auditd审计功能&quot;">​</a></h2><p>直接使用<code>systemctl restart auditd</code>重启auditd是失败.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auditd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auditd.service:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Operation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> refused,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auditd.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> may</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> be</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> requested</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dependency</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> only</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (it </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configured</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> refuse</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> manual</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start/stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">See</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> system</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;systemctl status auditd.service&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> details.</span></span></code></pre></div><p>可以使用<code>service auditd status/start/stop/restart</code><br> 参见: <a href="https://access.redhat.com/solutions/2664811" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/2664811</a></p><p>启动/重启auditd 报错&quot;Not able to start Auditd service with pid file exists error&quot;<br> 原因是有其他程序占用了kernel的audit功能, 可以使用<code>auditctl -s</code>查看其他程序的pid<br><a href="https://access.redhat.com/solutions/5431221" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/5431221</a></p><p><code>/var/log/audit/audit.log</code>里的日志格式, 默认不够人性化, 具体字段含义参见:<br><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files" target="_blank" rel="noreferrer">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files</a></p><p>打印今天的审计摘要</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aureport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 01/10/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 07:00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --end</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 01/10/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 19:00:00</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Summary</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Report</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">======================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Range</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 04/27/2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 20:30:36.683</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 01/01/1970</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 08:00:00.000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Selected</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> report:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 01/10/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 07:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 01/10/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 19:00:00</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configuration:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accounts,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> groups,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> roles:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logins:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logins:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authentications:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authentications:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> users:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> terminals:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> executables:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commands:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div><p>昨天到今天这个时间段里的审计摘要</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aureport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yesterday</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --end</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> today</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Summary</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Report</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">======================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Range</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 04/27/2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 20:30:36.683</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10/01/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 13:10:43.415</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Selected</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> report:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 09/30/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10/01/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 13:12:35</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configuration:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 46</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accounts,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> groups,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> roles:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logins:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 25</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logins:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authentications:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authentications:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> users:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> terminals:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> executables:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commands:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span></code></pre></div><p>从昨天开始事件统计摘要, <code>-i</code>让输出更人性化.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aureport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yesterday</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --summary</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Event</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Summary</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Report</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">======================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">total</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  type</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">======================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">14485</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  CRYPTO_KEY_USER</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">8076</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  USER_START</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">7639</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  USER_END</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">6762</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  CRED_ACQ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">6761</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  USER_ACCT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">6753</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  LOGIN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">6704</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  CRED_REFR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">6527</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  CRED_DISP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4966</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  NETFILTER_CFG</span></span></code></pre></div><p>统计可执行文件的摘要</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aureport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --summary</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Executable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Summary</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Report</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">total</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  file</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">33791</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/sbin/sshd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">31880</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/sbin/crond</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">7432</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/lib/systemd/systemd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4370</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/sbin/xtables-multi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">651</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">627</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/bin/python2.7</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">608</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/bin/login</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">309</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/bin/kmod</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">232</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/lib/systemd/systemd-update-utmp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">204</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">102</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/sbin/libvirtd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">94</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/sbin/tcpdump</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">60</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/bin/su</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">50</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/bin/dockerd-current</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">42</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /usr/sbin/groupadd</span></span></code></pre></div><p>显示每个audit日志记录的对应时间段</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aureport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Range</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Report</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=====================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/var/log/audit/audit.log.2:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 04/27/2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 20:30:36.683</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12/01/2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10:40:01.857</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/var/log/audit/audit.log.1:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12/01/2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10:40:01.858</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 06/08/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:20:01.343</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/var/log/audit/audit.log:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 06/08/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:20:01.358</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10/01/2020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 13:42:52.455</span></span></code></pre></div><p>搜索今天所有的日志</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ausearch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> today</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span></span></code></pre></div><p>搜索今天所有的事件为系统调用的日志<br> 所有的事件列表参见: <a href="https://access.redhat.com/articles/4409591" target="_blank" rel="noreferrer">https://access.redhat.com/articles/4409591</a></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ausearch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> today</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> syscall</span></span></code></pre></div><p>搜索今天所有的关键字为xxxx的日志</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ausearch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> today</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxxx</span></span></code></pre></div><p>搜索今天所有的涉及文件/etc/passwd的日志</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ausearch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> today</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/passwd</span></span></code></pre></div><p>其他一些参考资料:<br><a href="https://cloud.tencent.com/developer/article/1359606" target="_blank" rel="noreferrer">https://cloud.tencent.com/developer/article/1359606</a></p><h2 id="_90-分析磁盘性能" tabindex="-1">90. 分析磁盘性能 <a class="header-anchor" href="#_90-分析磁盘性能" aria-label="Permalink to &quot;90. 分析磁盘性能&quot;">​</a></h2><p>blktrace -d /dev/vda blkparse -i vda -d vda.blktrace.bin btt -i vda.blktrace.bin -l vda.d2c_latency</p><p>参考:<br><a href="https://developer.aliyun.com/article/698568" target="_blank" rel="noreferrer">https://developer.aliyun.com/article/698568</a><br><a href="https://tunnelix.com/debugging-disk-issues-with-blktrace-blkparse-btrace-and-btt-in-linux-environment/" target="_blank" rel="noreferrer">https://tunnelix.com/debugging-disk-issues-with-blktrace-blkparse-btrace-and-btt-in-linux-environment/</a></p><p><code>iostat</code>里<code>await</code>和<code>svctm</code>相关解释<br><a href="https://access.redhat.com/solutions/2039133" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/2039133</a><br><a href="https://access.redhat.com/articles/524353" target="_blank" rel="noreferrer">https://access.redhat.com/articles/524353</a><br><a href="https://access.redhat.com/solutions/112613" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/112613</a></p><h2 id="_91-grub相关问题" tabindex="-1">91. Grub相关问题 <a class="header-anchor" href="#_91-grub相关问题" aria-label="Permalink to &quot;91. Grub相关问题&quot;">​</a></h2><p>CentOS 6 和7 如何重装grub<br><a href="https://access.redhat.com/solutions/1521" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/1521</a></p><h2 id="_92-slab相关的知识" tabindex="-1">92. SLAB相关的知识 <a class="header-anchor" href="#_92-slab相关的知识" aria-label="Permalink to &quot;92. SLAB相关的知识&quot;">​</a></h2><p>统计slab内各项的内存占用并降序排列TOP 10</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{printf &quot;  %6i MB %s \\n&quot;,$6*$15/256,$1}&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/slabinfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nrk1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -10</span></span></code></pre></div><h2 id="_93-nfs相关的知识" tabindex="-1">93. nfs相关的知识 <a class="header-anchor" href="#_93-nfs相关的知识" aria-label="Permalink to &quot;93. nfs相关的知识&quot;">​</a></h2><p>nfs Debug<br><a href="https://access.redhat.com/solutions/262213" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/262213</a><br><a href="https://access.redhat.com/solutions/1460313" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/1460313</a><br><a href="https://access.redhat.com/solutions/4253191" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/4253191</a><br><a href="https://access.redhat.com/solutions/2948091" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/2948091</a><br><a href="https://access.redhat.com/solutions/3765711" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/3765711</a><br><a href="https://access.redhat.com/solutions/28211" target="_blank" rel="noreferrer">https://access.redhat.com/solutions/28211</a></p><p>nfs, rpc相关的Debug开关<br><a href="https://wiki.archlinux.org/index.php/NFS/Troubleshooting#RPC_debug_flags" target="_blank" rel="noreferrer">https://wiki.archlinux.org/index.php/NFS/Troubleshooting#RPC_debug_flags</a></p><h2 id="_94-fork创建进程时的几个报错说明" tabindex="-1">94. fork创建进程时的几个报错说明 <a class="header-anchor" href="#_94-fork创建进程时的几个报错说明" aria-label="Permalink to &quot;94. fork创建进程时的几个报错说明&quot;">​</a></h2><p>有两个常见的报错:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">11:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Resource</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> temporarily</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unavailable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">12:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Cannot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allocate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> memory</span></span></code></pre></div><p>在fork等创建进程的操作里, 当达到<code>nproc</code>的限制， 即用户的最大进程数， 报错<code>Resource temporarily unavailable</code> （这条规则对root用户无效） 如果在文件里对<code>nproc</code>配置为<code>ulimited</code> 这个值是根据内存算出来的， 公式可参考<br><a href="https://thelinuxcluster.com/2020/05/14/how-is-the-nproc-hard-limit-calculated-and-how-do-we-change-the-value-on-centos-7/" target="_blank" rel="noreferrer">https://thelinuxcluster.com/2020/05/14/how-is-the-nproc-hard-limit-calculated-and-how-do-we-change-the-value-on-centos-7/</a></p><p>当达到系统级参数pid_max限制，无法分配出pid时， 报错为<code>Cannot allocate memory</code></p><p><code>sysctl kernel.pid_max</code>查询当前的最大值, pid_max默认是32768， 64位系统， 最大可配置为4百万左右<br><code>kernel.threads-max</code> 也控制系统能创建的最大进程/线程数, 因为它的默认值非常大. 一般都没关注过. 总是<code>kernel.pid_max</code>先超出限制.<br> 如下是相关代码: linux-3.10.0-957.21.3.el7\\include\\linux\\threads.h</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * This controls the default maximum pid allocated to a process</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PID_MAX_DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CONFIG_BASE_SMALL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * A maximum of 4 million PIDs should be enough for a while.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * [NOTE: PID/TIDs are limited to 2^29 ~= 500+ million, see futex.h.]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PID_MAX_LIMIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CONFIG_BASE_SMALL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PAGE_SIZE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PID_MAX_DEFAULT))</span></span></code></pre></div>`,591),k=[l];function e(F,d,r,g,y,C){return a(),i("div",null,k)}const B=s(p,[["render",e]]);export{o as __pageData,B as default};
