import{_ as s,c as n,o as a,a as p}from"./app.526dca4e.js";var l="/img/ntp.svg";const m=JSON.parse('{"title":"\u7406\u89E3NTP\u534F\u8BAE","description":"","frontmatter":{"title":"\u7406\u89E3NTP\u534F\u8BAE","author":"Peter Wang","tags":["NTP","\u534F\u8BAE"],"date":"2018-01-28T07:02:50.000Z","draft":false},"headers":[{"level":2,"title":"\u65F6\u949F\u540C\u6B65\u7684\u8FC7\u7A0B","slug":"\u65F6\u949F\u540C\u6B65\u7684\u8FC7\u7A0B"},{"level":2,"title":"ntp\u6D88\u606F\u683C\u5F0F","slug":"ntp\u6D88\u606F\u683C\u5F0F"},{"level":2,"title":"\u6293\u5305\u5B9E\u4F8B","slug":"\u6293\u5305\u5B9E\u4F8B"},{"level":2,"title":"\u76F8\u5173\u8F6F\u4EF6\u4F7F\u7528","slug":"\u76F8\u5173\u8F6F\u4EF6\u4F7F\u7528"},{"level":2,"title":"\u53C2\u8003","slug":"\u53C2\u8003"}],"relativePath":"linux/ntp.md","lastUpdated":1657810449000}'),e={name:"linux/ntp.md"},o=p(`<p>NTP\u534F\u8BAE\u7528\u6765\u6821\u51C6\u670D\u52A1\u5668\u7684\u65F6\u95F4. \u672C\u6587\u8BE6\u7EC6\u4ECB\u7ECD\u539F\u7406\u548C\u534F\u8BAE\u683C\u5F0F </p><h2 id="\u65F6\u949F\u540C\u6B65\u7684\u8FC7\u7A0B" tabindex="-1">\u65F6\u949F\u540C\u6B65\u7684\u8FC7\u7A0B <a class="header-anchor" href="#\u65F6\u949F\u540C\u6B65\u7684\u8FC7\u7A0B" aria-hidden="true">#</a></h2><ol><li>A\u53D1\u9001ntp\u6D88\u606F\u5230B, \u6D88\u606F\u91CC\u542B\u53D1\u9001\u65F6\u95F4\u6233 T1.</li><li>B\u6536\u5230ntp\u6D88\u606F\u540E, \u5C06\u63A5\u53D7\u65F6\u95F4T2\u5199\u5165\u8BE5\u6D88\u606F\u4F53.</li><li>\u5F53B\u53D1\u9001ntp\u54CD\u5E94\u6D88\u606F\u7ED9A\u65F6, \u5C06\u53D1\u9001\u65F6\u95F4T3\u4E5F\u5199\u5165\u8BE5\u6D88\u606F\u4F53</li><li>A\u6536\u5230\u54CD\u5E94ntp\u6D88\u606F\u7684\u65F6\u95F4\u4E3AT4</li></ol><p>\u90A3\u4E48<br> round-trip \u4E3A: (T4 - T1) - (T3 - T2)<br> \u65F6\u95F4\u504F\u79FB\u4E3A: ((T2 - T1) + (T3 - T4)) / 2</p><p>ntp\u8BF7\u6C42\u6D88\u606F\u548C\u54CD\u5E94\u6D88\u606F\u683C\u5F0F\u5B8C\u5168\u4E00\u6837, \u4F7F\u7528udp\u534F\u8BAE. \u9ED8\u8BA4\u7684ntp\u670D\u52A1\u5668\u76D1\u542C\u7AEF\u53E3\u662F123<br> \u5982\u4E0Bchronyd(centos\u4E0B\u9ED8\u8BA4\u7684ntp\u8F6F\u4EF6)\u6B63\u5728\u76D1\u542C123\u7AEF\u53E3</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ lsof -i:123</span></span>
<span class="line"><span style="color:#A6ACCD;">COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span></span>
<span class="line"><span style="color:#A6ACCD;">chronyd 2439 chrony    3u  IPv4  23270      0t0  UDP </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">:ntp</span></span>
<span class="line"></span></code></pre></div><h2 id="ntp\u6D88\u606F\u683C\u5F0F" tabindex="-1">ntp\u6D88\u606F\u683C\u5F0F <a class="header-anchor" href="#ntp\u6D88\u606F\u683C\u5F0F" aria-hidden="true">#</a></h2><p>ntp\u6D88\u606F\u7531\u6D88\u606F\u5934,\u6269\u5C55\u5B57\u6BB5,\u53EF\u9009\u7684\u9274\u6743\u7801\u7EC4\u6210. \u5728\u5B9E\u9645\u4F7F\u7528\u4E2D, \u4E00\u822C\u53EA\u643A\u5E26\u6D88\u606F\u5934. \u5982\u4E0B\u662F\u6D88\u606F\u5934\u7684\u5177\u4F53\u683C\u5F0F</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">     0                   1                   2                   3</span></span>
<span class="line"><span style="color:#A6ACCD;">     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |LI | VN  |Mode |    Stratum     |     Poll      |  Precision   |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                         Root Delay                            |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                         Root Dispersion                       |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                          Reference ID                         |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                                                               |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +                     Reference Timestamp (64)                  +</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                                                               |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                                                               |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +                      Origin Timestamp (64)                    +</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                                                               |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                                                               |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +                      Receive Timestamp (64)                   +</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                                                               |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                                                               |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +                      Transmit Timestamp (64)                  |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u65F6\u95F4\u683C\u5F0F\u6709\u4E24\u79CD, \u5B83\u4EEC\u4EE3\u8868\u4ECE1900\u5E741\u67081\u53F7 0\u65F6 UTC\u65F6\u95F4\u81F3\u4ECA\u7684\u79D2\u6570</p><ul><li>NTP Timestamp Format<br> 8\u4E2A\u5B57\u8282, \u524D32\u4F4D\u8868\u793A\u79D2\u6570, \u540E32\u4F4D\u8868\u793A <code>1/2\u768432\u6B21\u65B9</code> \u79D2</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">     0                   1                   2                   3</span></span>
<span class="line"><span style="color:#A6ACCD;">     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                            Seconds                            |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |                            Fraction                           |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li>NTP Short Format<br> 4\u4E2A\u5B57\u8282, \u524D16\u4F4D\u8868\u793A\u79D2\u6570, \u540E16\u4F4D\u8868\u793A <code>1/2\u768416\u6B21\u65B9</code> \u79D2</li></ul><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">     0                   1                   2                   3</span></span>
<span class="line"><span style="color:#A6ACCD;">     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;">    |          Seconds              |           Fraction            |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li>\u6D88\u606F\u5934\u5404\u5B57\u6BB5\u89E3\u91CA:</li></ul><p>LI Leap Indicator (leap): 2\u6BD4\u7279, \u7528\u6765\u8B66\u544A\u662F\u5426\u6709\u95F0\u79D2\u6216\u8005\u672A\u548C\u4E0A\u7EA7\u540C\u6B65. \u5177\u4F53\u53D6\u503C\u548C\u542B\u4E49\u5982\u4E0B:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">    +-------+----------------------------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;">    | Value | Meaning                                |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-------+----------------------------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 0     | no warning                             |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 1     | last minute of the day has 61 seconds  |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 2     | last minute of the day has 59 seconds  |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 3     | unknown (clock unsynchronized)         |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-------+----------------------------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>VN Version Number: 3\u6BD4\u7279,\u6307\u5B9Antp\u7248\u672C Mode (mode): 3\u6BD4\u7279, \u6307\u5B9A\u5DE5\u4F5C\u6A21\u5F0F, \u901A\u5E38\u6211\u4EEC\u4F7F\u75283,4 \u4EE3\u8868\u5BA2\u6237\u7AEF-\u670D\u52A1\u7AEF\u6A21\u5F0F</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">    +-------+--------------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;">    | Value | Meaning                  |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-------+--------------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 0     | reserved                 |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 1     | symmetric active         |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 2     | symmetric passive        |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 3     | client                   |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 4     | server                   |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 5     | broadcast                |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 6     | NTP control message      |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 7     | reserved for private use |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +-------+--------------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Stratum (stratum): 8\u6BD4\u7279\u6307\u5B9A\u9636\u5C42. \u901A\u5E38Server\u66F4\u65B0\u8BE5\u5B57\u6BB5.<br> \u9876\u5C42\u5206\u914D\u4E3A\u6570\u5B570\u3002\u4E00\u4E2A\u901A\u8FC7\u9636\u5C42n\u540C\u6B65\u7684\u670D\u52A1\u5668\u5C06\u8FD0\u884C\u5728\u9636\u5C42n + 1\u3002 \u9636\u5C42\u4E3A0\u7684\u662F\u9AD8\u7CBE\u5EA6\u8BA1\u65F6\u8BBE\u5907\uFF0C\u4F8B\u5982\u539F\u5B50\u949F\uFF08\u5982\u94EF\u3001\u94F7\uFF09\u3001GPS\u65F6\u949F\u6216\u5176\u4ED6\u65E0\u7EBF\u7535\u65F6\u949F\u3002\u5B83\u4EEC\u751F\u6210\u975E\u5E38\u7CBE\u786E\u7684\u8109\u51B2\u79D2\u4FE1\u53F7\uFF0C\u89E6\u53D1\u6240\u8FDE\u63A5\u8BA1\u7B97\u673A\u4E0A\u7684\u4E2D\u65AD\u548C\u65F6\u95F4\u6233\u3002\u9636\u5C420\u8BBE\u5907\u4E5F\u79F0\u4E3A\u53C2\u8003\uFF08\u57FA\u51C6\uFF09\u65F6\u949F. \u9636\u5C421\u670D\u52A1\u5668\u8FDE\u63A5\u9636\u5C420\u7684\u8BBE\u5907, \u5B83\u4EEC\u4E5F\u88AB\u79F0\u4E3A\u4E3B\u8981\uFF08primary\uFF09\u65F6\u95F4\u670D\u52A1\u5668\u3002 <img src="`+l+`" alt="ntp\u9636\u5C42\u56FE"> \u66F4\u5177\u4F53\u7684\u53D6\u503C\u542B\u4E49\u5982\u4E0B:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">    +--------+-----------------------------------------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;">    | Value  | Meaning                                             |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +--------+-----------------------------------------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 0      | unspecified or invalid                              |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 1      | primary server (e.g., equipped with a GPS receiver) |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 2-15   | secondary server (via NTP)                          |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 16     | unsynchronized                                      |</span></span>
<span class="line"><span style="color:#A6ACCD;">    | 17-255 | reserved                                            |</span></span>
<span class="line"><span style="color:#A6ACCD;">    +--------+-----------------------------------------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Poll: 8\u6BD4\u7279\u7B26\u53F7\u6574\u6570, \u6307\u793A\u4E0E\u4E0B\u4E00\u6B21ntp\u540C\u6B65\u7684\u6700\u77ED\u65F6\u95F4\u95F4\u9694. \u503C\u4E3A4, \u5219\u8868\u793A16(2\u76844\u6B21\u65B9)\u79D2<br> Precision: 8\u6BD4\u7279\u7B26\u53F7\u6574\u6570, \u6307\u793A\u65F6\u95F4\u7CBE\u5EA6. log2 \u79D2. -18 \u4E3A\u5FAE\u5999<br> Root Delay: \u603B\u7684 round-trip delay\u5230 Primary server. \u5355\u4F4D\u662F NTP Short Format<br> Root Dispersion: \u5355\u4F4D\u662F NTP Short Format<br> Reference ID: 32\u6BD4\u7279\u6307\u793A\u670D\u52A1\u7AEF\u7684\u53C2\u8003\u65F6\u949F(\u5373\u4E0A\u5C42\u670D\u52A1\u5668\u4FE1\u606F). \u5373\u4E0A\u5C42\u65F6\u949F\u6E90 . \u5F53\u9636\u5C42\u4E3A1\u65F6, \u90A3\u4E48\u4E0A\u5C42\u662F\u539F\u5B50\u949F\u7B49\u8BBE\u5907. \u6CA1IP, \u6240\u4EE5\u4F7F\u7528ascii \u5B57\u7B26 \u4ECE\u9636\u5C422\u5F00\u59CB, \u8868\u793AIP\u5730\u5740.<br> Reference Timestamp: \u6307\u793A\u670D\u52A1\u7AEF\u81EA\u8EAB\u7CFB\u7EDF\u65F6\u95F4\u6700\u540E\u4E00\u6B21\u88AB\u8BBE\u7F6E\u7684\u65F6\u95F4\u6233.\u901A\u5E38\u6BCFPoll\u4E00\u6B21\u66F4\u65B0\u4E00\u4E0B<br> Origin Timestamp: \u5BA2\u6237\u7AEF\u53D1\u8D77\u65F6\u95F4<br> Receive Timestamp: \u670D\u52A1\u7AEF\u63A5\u53D7\u65F6\u95F4<br> Transmit Timestamp: \u670D\u52A1\u7AEF\u53D1\u9001\u65F6\u95F4</p><h2 id="\u6293\u5305\u5B9E\u4F8B" tabindex="-1">\u6293\u5305\u5B9E\u4F8B <a class="header-anchor" href="#\u6293\u5305\u5B9E\u4F8B" aria-hidden="true">#</a></h2><p><code>tcpdump -i eth0 port 123 -nnv</code> \u6293\u53D6ntp\u7684\u8BE6\u7EC6\u62A5\u6587, \u6837\u4F8B\u5982\u4E0B:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">17:19:18.566860 IP (tos 0x0, ttl 45, id 33978, offset 0, flags [none], proto UDP (17), length 76)</span></span>
<span class="line"><span style="color:#A6ACCD;">    1.80.235.52.31681 &gt; 192.168.1.247.123: NTPv4, length 48</span></span>
<span class="line"><span style="color:#A6ACCD;">	Client, Leap indicator: clock unsynchronized (192), Stratum 0 (unspecified), poll 3 (8s), precision -6</span></span>
<span class="line"><span style="color:#A6ACCD;">	Root Delay: 1.000000, Root dispersion: 1.000000, Reference-ID: (unspec)</span></span>
<span class="line"><span style="color:#A6ACCD;">	  Reference Timestamp:  0.000000000</span></span>
<span class="line"><span style="color:#A6ACCD;">	  Originator Timestamp: 0.000000000</span></span>
<span class="line"><span style="color:#A6ACCD;">	  Receive Timestamp:    0.000000000</span></span>
<span class="line"><span style="color:#A6ACCD;">	  Transmit Timestamp:   3726119958.485983999 (2018/01/28 17:19:18)</span></span>
<span class="line"><span style="color:#A6ACCD;">	    Originator - Receive Timestamp:  0.000000000</span></span>
<span class="line"><span style="color:#A6ACCD;">	    Originator - Transmit Timestamp: 3726119958.485983999 (2018/01/28 17:19:18)</span></span>
<span class="line"><span style="color:#A6ACCD;">17:19:18.566899 IP (tos 0x0, ttl 64, id 38707, offset 0, flags [DF], proto UDP (17), length 76)</span></span>
<span class="line"><span style="color:#A6ACCD;">    192.168.1.247.123 &gt; 1.80.235.52.31681: NTPv4, length 48</span></span>
<span class="line"><span style="color:#A6ACCD;">	Server, Leap indicator:  (0), Stratum 3 (secondary reference), poll 3 (8s), precision -24</span></span>
<span class="line"><span style="color:#A6ACCD;">	Root Delay: 0.005340, Root dispersion: 0.002105, Reference-ID: 182.92.12.11</span></span>
<span class="line"><span style="color:#A6ACCD;">	  Reference Timestamp:  3726119511.971055101 (2018/01/28 17:11:51)</span></span>
<span class="line"><span style="color:#A6ACCD;">	  Originator Timestamp: 3726119958.485983999 (2018/01/28 17:19:18)</span></span>
<span class="line"><span style="color:#A6ACCD;">	  Receive Timestamp:    3726119958.566745462 (2018/01/28 17:19:18)</span></span>
<span class="line"><span style="color:#A6ACCD;">	  Transmit Timestamp:   3726119958.566777029 (2018/01/28 17:19:18)</span></span>
<span class="line"><span style="color:#A6ACCD;">	    Originator - Receive Timestamp:  +0.080761462</span></span>
<span class="line"><span style="color:#A6ACCD;">	    Originator - Transmit Timestamp: +0.080793029</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="\u76F8\u5173\u8F6F\u4EF6\u4F7F\u7528" tabindex="-1">\u76F8\u5173\u8F6F\u4EF6\u4F7F\u7528 <a class="header-anchor" href="#\u76F8\u5173\u8F6F\u4EF6\u4F7F\u7528" aria-hidden="true">#</a></h2><p>chronyd\u662Fcentos7\u5F15\u5165\u7684\u65B0\u7684ntp\u8F6F\u4EF6, \u4EE3\u66FF\u8001\u7684ntpd<br> \u5982\u4E0B\u547D\u4EE4\u68C0\u6D4B\u5F53\u524D\u4E0E\u4E0A\u5C42ntp\u7684\u540C\u6B65\u72B6\u6001</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ chronyc sources -v</span></span>
<span class="line"><span style="color:#A6ACCD;">210 Number of sources = 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  .-- Source mode  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">^</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = server, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = peer, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = </span><span style="color:#C792EA;">local</span><span style="color:#A6ACCD;"> clock.</span></span>
<span class="line"><span style="color:#A6ACCD;"> / .- Source state </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = current synced, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">+</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = combined , </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = not combined,</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> /   </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">?</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = unreachable, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">x</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> may be </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> error, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">~</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> = </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> too variable.</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">                                                 .- xxxx </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> yyyy </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> +/- zzzz</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">      Reachability register </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">octal</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> -.           </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">  xxxx = adjusted offset,</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">      Log2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Polling interval</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> --.      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">  yyyy = measured offset,</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">                                \\     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">  zzzz = estimated error.</span></span>
<span class="line"><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;">                                 </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">           \\</span></span>
<span class="line"><span style="color:#A6ACCD;">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span></span>
<span class="line"><span style="color:#A6ACCD;">===============================================================================</span></span>
<span class="line"><span style="color:#A6ACCD;">^</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> time5.aliyun.com              2  10   377   733   +165us</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> +206us</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> +/- 5534us</span></span>
<span class="line"><span style="color:#A6ACCD;">^- 120.25.115.19                 2  10   377   633  -1155us</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">-1155us</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> +/-   65ms</span></span>
<span class="line"></span></code></pre></div><p>\u4F7F\u7528ntpd\u8F6F\u4EF6\u5305\u65F6\u68C0\u67E5ntp\u72B6\u6001<br> when\u6307\u591A\u5C11\u79D2\u540E\u518D\u4E00\u6B21\u540C\u6B65<br> poll\u6307\u4E0B\u4E00\u6B21\u540C\u6B65\u7684\u65F6\u95F4\u95F4\u9694 \u5355\u4F4D:\u79D2<br> reach \u4E0E\u4E0A\u5C42\u670D\u52A1\u5668\u5DF2\u6210\u529F\u8FDE\u63A5\u7684\u6B21\u6570<br> delay \u6307RRT \u5355\u4F4D: \u6BEB\u79D2<br> offset \u6307\u65F6\u95F4\u504F\u79FB\u503C \u5355\u4F4D: \u6BEB\u79D2</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ntpq -p</span></span>
<span class="line"><span style="color:#A6ACCD;">     remote           refid      st t when poll reach   delay   offset  jitter</span></span>
<span class="line"><span style="color:#A6ACCD;">==============================================================================</span></span>
<span class="line"><span style="color:#A6ACCD;">+time5.aliyun.co 10.137.38.86     2 u   11   64    1   25.353  -113.04  65.276</span></span>
<span class="line"><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">203.107.6.88    10.137.55.181    2 u    9   64    1   45.441  -148.44  89.070</span></span>
<span class="line"></span></code></pre></div><p><code>ntpdate -q XX.XX.XX.XX</code> \u67E5\u8BE2\u4E0E\u4E0A\u5C42ntp\u670D\u52A1\u5668\u7684\u65F6\u95F4\u504F\u79FB\u91CF. \u4E0D\u4F1A\u66F4\u65B0. <code>-d</code> \u6253\u5F00Debug\u6A21\u5F0F</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ ntpdate -q ntp3.aliyun.com</span></span>
<span class="line"><span style="color:#A6ACCD;">server 203.107.6.88, stratum 2, offset 0.797972, delay 0.06859</span></span>
<span class="line"><span style="color:#A6ACCD;">11 Feb 23:02:36 ntpdate</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">21763</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: step </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> server 203.107.6.88 offset 0.797972 sec</span></span>
<span class="line"></span></code></pre></div><p>ntp\u914D\u7F6E\u6700\u4F73\u5B9E\u8DF5:<br> \u5047\u8BBEntp\u670D\u52A1\u5668\u4E3A <a href="http://ntp1.aliyun.com" target="_blank" rel="noopener noreferrer">ntp1.aliyun.com</a>, \u914D\u7F6E\u5982\u4E0B:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># \u4E0A\u5C42\u670D\u52A1\u5668\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">server ntp1.aliyun.com iburst </span></span>
<span class="line"><span style="color:#A6ACCD;">restrict ntp1.aliyun.com nomodify notrap nopeer noquery</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default \u6307\u6240\u6709IP, \u9996\u5148\u9ED8\u8BA4\u663E\u793A\u8FDE\u63A5\u65E0\u6CD5\u6267\u884C\u4EFB\u4F55\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#A6ACCD;">restrict default kod nomodify notrap nopeer noquery</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u9488\u5BF9ipv6\u7684\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">restrict -6 default kod nomodify notrap nopeer noquery</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u914D\u7F6E\u5185\u7F51IP\u53EF\u67E5\u8BE2\u4E0D\u53EF\u4FEE\u6539\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;">restrict xx.xx.xx.xx mask xx.xx.xx.xx  nomodify notrap nopeer</span></span>
<span class="line"></span></code></pre></div><p><code>man ntp_acc</code> \u67E5\u770B restrict \u5404\u53C2\u6570\u542B\u4E49<br><code>man ntp_clock</code> \u67E5\u770B server \u5404\u53C2\u6570\u542B\u4E49</p><h2 id="\u53C2\u8003" tabindex="-1">\u53C2\u8003 <a class="header-anchor" href="#\u53C2\u8003" aria-hidden="true">#</a></h2><ul><li>NTP4 RFC: <a href="https://tools.ietf.org/html/rfc5905" target="_blank" rel="noopener noreferrer">https://tools.ietf.org/html/rfc5905</a></li><li>NTP Best Practice: <a href="https://tools.ietf.org/id/draft-reilly-ntp-bcp-01.html" target="_blank" rel="noopener noreferrer">https://tools.ietf.org/id/draft-reilly-ntp-bcp-01.html</a></li></ul>`,37),c=[o];function t(r,i,C,A,y,D){return a(),n("div",null,c)}var F=s(e,[["render",t]]);export{m as __pageData,F as default};
